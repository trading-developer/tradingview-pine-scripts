Script Name: Dual Fibonacci Zone & Ranged Vol DCA Strategy - R3c0nTrader
Author: R3c0nTrader
Description: What does this do?
This is for educational purposes and allows one to backtest two Fibonacci Zones simultaneously. This also includes an option for Ranged Volume as a parameter.

Pre-requisites:
First off, this is a Long only strategy as I wrote it with DCA in mind. It cannot be used for shorting. Shorting defeats the purpose of a DCA bot which has a goal that is...
PineScript code:

Pine Script‚Ñ¢ strategy
Dual Fibonacci Zone & Ranged Vol DCA Strategy - R3c0nTrader
//  ¬©  Dual  Fibonacci  Zone  &  Ranged  Vol  DCA  Strategy  -  R3c0nTrader  ver  2022-07-29
//  For  backtesting  with  3Commas  DCA  Bot  settings
//  Credits  to  "EvoCrypto"  for  granting  me  permission  to  use  "Ranged  Volume"  to  create  this  strategy
//  Credits  to  "eykpunter"  for  granting  me  permission  to  use  "Fibonacci  Zones"  to  create  this  strategy
//  Credits  to  "junyou0424"  for  granting  me  permission  to  use  "DCA  Bot  with  SuperTrend  Emulator"  which  I  used  for  adding  bot  inputs,  calculations,  and  strategy
//  Credits  to  "zendog123"  and  his  strategy  "Zendog  V3  backtest  DCA  bot  3commas"  which  I  used  for  adding  3Commas  input  and  alerts.
//  Credits  to  "tedwardd"    and  his  strategy  "3Commas  Bollinger  Strategy"  which  I  used  a  part  of  for  selecting  the  3Commas  bot  type
//@version=5
strategy('Dual  Fibonacci  Zones  &  Ranged  Vol  DCA  Strategy  -  R3c0nTrader',  shorttitle='Dual  Fib  Zones  RV  DCA  Strategy',
      overlay=true,  pyramiding=999,  default_qty_type=strategy.cash,  initial_capital=10000,  commission_value=0.0,  process_orders_on_close=true,  max_labels_count=500)
//  Declare  all  variables
var  current_so  =  0
var  initial_order  =  0.0
var  original_ttp_value  =  0.0
var  previous_high_value  =  0.0
var  stopValue  =  float(0.0)
var  strat  =  ""
var  take_profit_1  =  float(0.03)
var  take_profit_2  =  float(0.03)
var  trailing  =  0.0
var  trailing_price  =float(0.0)
varpnl_pct=0.0
varcurrent_sourceInput=0.0
fib_exit_level=float(0)
fib_exit_level_2=float(0)
fib_level=float(0)
fib_level_2=float(0)
so_qty=float(0.0)
take_profit=float(na)
take_profit_level=float(na)
buy=bool(false)
DIxUp_1=bool(false)
DIxDown_1=bool(false)
DIxUp_2=bool(false)
DIxDown_2=bool(false)
sell=bool(false)
e_trig_bool=bool(false)
e_trig_bool_2=bool(false)
exit_trig_bool=bool(false)
exit_trig_bool_2=bool(false)
use_labels=bool(false)
Close=0.0
Open=0.0
e_trig=0
e_trig_2=0
fib_exit=0
fib_exit_2=0
fib_tp=0
fib_tp_2=0
threshold=0.0
Volume_Color=color(na)
buy_message=""
sell_message=""
//StrategyInputs
//StartandEndDates----------------------------------------------------------
i_startTime=input.time(defval=timestamp('01Jan201500:00+0000'),title='StartTime',group="DateRange")
i_endTime=input.time(defval=timestamp('31Dec205023:59+0000'),title='EndTime',group="DateRange")
inDateRange=time>=i_startTimeandtime<=i_endTime
//------------------------------------------------------------------------------
//Start:Preventrepainting----------------------------------------------------
stop_repainting_choice=input.bool(false,title='Disablerepainting?',
tooltip='PerPinev5UserManual:Youcanverywelldecidetouserepaintingindicatorsifyouunderstandhowtheybehave,andthatbehaviormeetsyourtradingmethodology‚Äôsrequirements.'+
'Don‚Äôtbeoneofthosenewcomerstotradingwhoslap‚Äúrepaint‚Äùsentencesonpublishedscriptsasifitdiscreditsthem.Doingsoonlyrevealsyourincomprehensionofthesubject.'+
'What‚Äôsimportantisthatyouunderstandhowthetoolsyouusework,andiftheirbehavioriscompatiblewithyourobjectives,repaintingornot.Repaintingisacomplexmatter.Ithasmanyfacesandmanycauses.',
group='Repainting')
nonRepaintingSecurity(sym,tf,src)=>
request.security(sym,tf,src[barstate.isrealtime?1:0])[barstate.isrealtime?0:1]
//End:Preventrepainting------------------------------------------------------
//Start:Bull/SellIndicatorOptions-------------------------------------------
highlight_trades=input.bool(true,title='Highlightbackgroundcolorfortrades?',tooltip='Usedtoaddagreenorredbackgroundcolorwiththebuyandsellarrows.',group="Buy/SellIndicatorOptions")
buy_color=input.color(color.new(color.green,70),'Buybackgroundcolor',group="Buy/SellIndicatorOptions")
sell_color=input.color(color.new(color.red,70),'Sellbackgroundcolor',group="Buy/SellIndicatorOptions")
use_labels:=input.bool(false,title='UseLabels?',tooltip='Enabletoshowlabels.Toremovetheothertext,youmustopenthe"Style"menuanduncheck"Signallabels"and"Quantity".\n\nOnly500labelscanbedisplayedonthechart.',group="Buy/SellIndicatorOptions")
//End:Bull/SellIndicatorOptions---------------------------------------------
//Start:3CommasBot----------------------------------------------------------
boolcfg_enable_bot_control=input.bool(title='Enable3CommasWebhook?',defval=false,group='3commasBotSettings',
tooltip='IfthisisenabledthestrategycancontrolsomebotoperationsviaWebhookcalls.\n\nToenableWebhookcalls,checkthisoption,selectthebottype,'+
'entertheBotidandEmailToken.\n\nAfterthestrategyisconfigured,createanalertonthestrategy,select"alert()functioncallsonly",'+
'check"WebhookURL",enterthe3CommaswebhookURL,andenterthe"AlertName"')
bot_type=input.string("Simplebot",title="Selectthebottype",options=["Simplebot","Compositebot"],group='3commasBotSettings',
tooltip='Selectthebottype.If"Simplebot"isselectedthecurrencypair(e.g.BTCUSDorBTCUSDT)willnotbepassedinthealert.'+
'\nIf"Compositebot"isselectedthecurrencypairwillbepassedinthealert.')
stringcfg_bot_id=input.string(title='Botid',defval='bot_id',tooltip='Gotoyour3Commasbotsettings>Expand"Messagefordealstartsignal"',group='3commasBotSettings')
stringcfg_email_token=input.string(title='Emailtoken',defval='email_token',tooltip='Gotoyour3Commasbotsettings>Expand"Messagefordealstartsignal"',group='3commasBotSettings')
ifcfg_enable_bot_control
ifbot_type=="Simplebot"
buy_message:='{"message_type":"bot","bot_id":"'+cfg_bot_id+'","email_token":"'+cfg_email_token+'","delay_seconds":0}'
sell_message:='{"action":"close_at_market_price_all","message_type":"bot","bot_id":"'+cfg_bot_id+'","email_token":"'+cfg_email_token+'","delay_seconds":0}'
elseifbot_type=="Compositebot"
buy_message:='{"message_type":"bot","bot_id":"'+cfg_bot_id+'","email_token":"'+cfg_email_token+'","delay_seconds":0,"pair":"'+str.tostring(syminfo.currency)+'_'+str.tostring(syminfo.basecurrency)+'"}'
sell_message:='{"action":"close_at_market_price_all","message_type":"bot","bot_id":"'+cfg_bot_id+'","email_token":"'+cfg_email_token+'","delay_seconds":0,"pair":"'+str.tostring(syminfo.currency)+'_'+str.tostring(syminfo.basecurrency)+'"}'
//End:3CommasBot------------------------------------------------------------
//Start:TradeEntrySettings--------------------------------------------------
//Start:FibonacciEntry-1Settings--------------------------------------------
fib_enable=input.bool(true,title="ü•áUseFirstFibonacciZoneStrategy?üíé‚úãü§ö'",tooltip='EnablethisoptionifyouwanttofactorinthefirstsetofFibonacciZonesaspartofyourstrategy',group="1stFibonacciTradeEntrySettings")
sourceInput=input.source(close,"Source",group="1stFibonacciTradeEntrySettings")
sourceInput01_func()=>
sourceInput01_f=stop_repainting_choice?nonRepaintingSecurity(syminfo.tickerid,timeframe.period,sourceInput):sourceInput
per=input(14,title='Fibonaccilength',tooltip='Numberofbarstolookback.RecommendedforbeginnerstosetDILengthtothesamevalueasthis.',group="1stFibonacciTradeEntrySettings")
hl=stop_repainting_choice?ta.highest(high,per)[1]:ta.highest(high,per)//Top-HighFibBorder
ll=stop_repainting_choice?ta.lowest(low,per)[1]:ta.lowest(low,per)//Top-LowFibBorder
dist=hl-ll//Rangeofthechannel
hf=hl-dist*0.236//Bottom-HighFibBorder
cfh=hl-dist*0.382//Top-CenterFibBorder
cfl=hl-dist*0.618//Bottom-CenterFibBorder
lf=hl-dist*0.764//Top-LowFibBorder
//IfFibonacciEntry-1isnotenabled,thennulloutentrysoitcannotbeused
iffib_enable==false
hl:=na
hf:=na
cfh:=na
cfl:=na
lf:=na
ll:=na
//Start:ADXSettings----------------------------------------------------------
lensig=input.int(14,title="ADXSmoothing",tooltip='Fibonaccisignalsworkbestwhenmarketistrending.ADXisusedtomeasuretrendstrength.Defaultandrecommendedvalueis14.',minval=1,maxval=50,group="1stFibonacciTradeEntrySettings")
len=input.int(14,minval=1,title="DILength",tooltip='Fibonaccisignalsworkbestwhenmarketistrending.DILengthisusedtocalculateADXtomeasuretrendstrength.Defaultvalueis14.RecommendforbeginnerstomatchthiswithFibonaccilength.',group="1stFibonacciTradeEntrySettings")
adx_min=input.int(25,title='MinADXvaluetoopentrade',tooltip='UsethistosettheminimumADXvalue(trendstrength)toopentrade.25orhigherisrecommendedforbeginners.0to20isaweaktrend.25to35isastrongtrend.35to45isaverystrongtrend.45to100isanextremelystrongtrend.',group="1stFibonacciTradeEntrySettings")
adx_max=input.int(100,title='MaxADXvaluetoopentrade',tooltip='UsethistosetthemaximumADXvalue(trendstrength)toopentrade.100isrecommendedforbeginners.0to20isaweaktrend.25to35isastrongtrend.35to45isaverystrongtrend.45to100isanextremelystrongtrend.',group="1stFibonacciTradeEntrySettings")
up=stop_repainting_choice?ta.change(high)[1]:ta.change(high)
down=stop_repainting_choice?-ta.change(low)[1]:-ta.change(low)
plusDM=na(up)?na:(up>downandup>0?up:0)
minusDM=na(down)?na:(down>upanddown>0?down:0)
trur=ta.rma(ta.tr,len)
di_plus=fixnan(100*ta.rma(plusDM,len)/trur)
di_minus=fixnan(100*ta.rma(minusDM,len)/trur)
sum=di_plus+di_minus
adx=100*ta.rma(math.abs(di_plus-di_minus)/(sum==0?1:sum),lensig)
adx_inrange_1=adx>=adx_minandadx<=adx_max
//End:ADXSettings------------------------------------------------------------
//Start:InputtosetupBuysignalswhenthesourcecrossesafibborder-------
entry_trigger=input.string("1-Crosses",title="Buysignalswhenthesource:[cont.]",options=["1-Crosses","2-Crossesup","3-Crossesdown"],tooltip="'Crosses'includesupanddownmovements.'CrossesUp'onlyincludesupmovements.'CrossesDown'onlyincludesdownmovements",group="1stFibonacciTradeEntrySettings")
ifentry_trigger=="1-Crosses"
e_trig:=1
elseifentry_trigger=="2-Crossesup"
e_trig:=2
elseifentry_trigger=="3-Crossesdown"
e_trig:=3
entry_choice=input.string("6-Bottom-LowFibBorder",title="...TheFibline:",options=["1-Top-HighFibBorder","2-Bottom-HighFibBorder","3-Top-CenterFibBorder","4-Bottom-CenterFibBorder","5-Top-LowFibBorder","6-Bottom-LowFibBorder"],
tooltip='Therearethreefibzonesandeachzonehas2borders(Top&Bottom).Theoptionsarelistedfromthetopzonetothebottomzone.ThebottomzoneistheDowntrendzone;themiddlezoneistheRangingzone;ThetopfibzoneistheUptrendzone.',
group="1stFibonacciTradeEntrySettings")
ifentry_choice=="1-Top-HighFibBorder"
fib_level:=hl
elseifentry_choice=="2-Bottom-HighFibBorder"
fib_level:=hf
elseifentry_choice=="3-Top-CenterFibBorder"
fib_level:=cfh
elseifentry_choice=="4-Bottom-CenterFibBorder"
fib_level:=cfl
elseifentry_choice=="5-Top-LowFibBorder"
fib_level:=lf
elseifentry_choice=="6-Bottom-LowFibBorder"
fib_level:=ll
//End:InputtosetupBuysignalswhenthesourcecrossesafibborder---------
//Start:+DI/-DIoptions-------------------------------------------------------
di_choice=input.bool(false,title="Onlyopentradesonbullish+DI(PositiveDirectionalIndex)?",tooltip=
'Defaultisdisabled.Ifyouwanttobemoreselective(youwantabullishconfirmation),enablethisanditwillonlyopentradeswhenthe+DI(PositiveDirectionalIndex)ishigherthanthe-DI(NegativeDirectionalIndex).Contrariantraders(buythedip)shouldleavethisdisabled',
group="1stFibonacciTradeEntrySettings")
di_min=input.int(0,title='Min+DIvaluetoopentrade',
tooltip='Defaultiszero.Usethistosettheminium+DIvaluetoopenthetrade.Tryincrementingthisvalueifyouwanttobemoreselectiveandfilterformorebullishmoves(e.g.20-25).ForContrariantraders,uncheck"OnlyopentradesonbullishDI"optionandsetMin+DItozero',
group="1stFibonacciTradeEntrySettings")
di_max=input.int(100,title='Max+DIvaluetoopentrade',tooltip='Defaultis100.Usethistosetthemaximum+DIvaluetoopentrade.ForContrariantraders,uncheck"OnlyopentradesonbullishDI"optionandtryaMax+DIvaluenohigherthan20or25',group="1stFibonacciTradeEntrySettings")
di_neg_min=input.int(0,title='Min-DIvaluetoopentrade',
tooltip='Defaultiszero.Usethistosettheminium-DIvaluetoopenthetrade.Tryincrementingthisvalueifyouwanttobemoreselectiveandfilterformorebearishmoves(e.g.25orhigher).',
group="1stFibonacciTradeEntrySettings")
di_neg_max=input.int(100,title='Max-DIvaluetoopentrade',tooltip='Defaultis100.Usethistosetthemaximum-DIvaluetoopentrade.',group="1stFibonacciTradeEntrySettings")
di_inrange=di_plus>=di_minanddi_plus<=di_maxanddi_minus>=di_neg_minanddi_minus<=di_neg_max
//End:+DI/-DIoptions---------------------------------------------------------
//End:FibonacciEntry-1Settings----------------------------------------------
//Start:FibonacciEntry-2Settings--------------------------------------------
fib_enable_2=input.bool(false,title="ü•àUse2ndFibonacciZoneStrategy?üíé‚úãü§ö'",tooltip='Enablethisoptionifyouwanttofactorina2ndFibonacciZonesaspartofyourstrategy',group="2ndFibonacciTradeEntrySettings")
sourceInput_2=input.source(close,"Source",group="2ndFibonacciTradeEntrySettings")
sourceInput02_func()=>
sourceInput02_f=stop_repainting_choice?nonRepaintingSecurity(syminfo.tickerid,timeframe.period,sourceInput_2):sourceInput_2
per_2=input(14,title='Fibonaccilength',tooltip='Numberofbarstolookback.RecommendedforbeginnerstosetDILengthtothesamevalueasthis.',group="2ndFibonacciTradeEntrySettings")
hl_2=stop_repainting_choice?ta.highest(high,per_2)[1]:ta.highest(high,per_2)//Top-HighFibBorder
ll_2=stop_repainting_choice?ta.lowest(low,per_2)[1]:ta.lowest(low,per_2)//Top-LowFibBorder
dist_2=hl_2-ll_2//Rangeofthechannel
hf_2=hl_2-dist_2*0.236//Bottom-HighFibBorder
cfh_2=hl_2-dist_2*0.382//Top-CenterFibBorder
cfl_2=hl_2-dist_2*0.618//Bottom-CenterFibBorder
lf_2=hl_2-dist_2*0.764//Top-LowFibBorder
//IfFibonacciEntry-2isnotenable,thennulloutentrysoitcannotbeused
iffib_enable_2==false
hl_2:=na
hf_2:=na
cfh_2:=na
cfl_2:=na
lf_2:=na
ll_2:=na
//Start:+DI/-DIoptions-------------------------------------------------------
lensig_2=input.int(14,title="ADXSmoothing",tooltip='Fibonaccisignalsworkbestwhenmarketistrending.ADXisusedtomeasuretrendstrength.Defaultandrecommendedvalueis14.',minval=1,maxval=50,group="2ndFibonacciTradeEntrySettings")
len_2=input.int(14,minval=1,title="DILength",tooltip='Fibonaccisignalsworkbestwhenmarketistrending.DILengthisusedtocalculateADXtomeasuretrendstrength.Defaultvalueis14.RecommendforbeginnerstomatchthiswithFibonaccilength.',group="2ndFibonacciTradeEntrySettings")
adx_min_2=input.int(25,title='MinADXvaluetoopentrade',tooltip='UsethistosettheminiumADXvalue(trendstrength)toopentrade.25orhigherisrecommendedforbeginners.0to20isaweaktrend.25to35isastrongtrend.35to45isaverystrongtrend.45to100isanextremelystrongtrend.',group="2ndFibonacciTradeEntrySettings")
adx_max_2=input.int(100,title='MaxADXvaluetoopentrade',tooltip='UsethistosetthemaximumADXvalue(trendstrength)toopentrade.100isrecommendedforbeginners.0to20isaweaktrend.25to35isastrongtrend.35to45isaverystrongtrend.45to100isanextremelystrongtrend.',group="2ndFibonacciTradeEntrySettings")
up_2=stop_repainting_choice?ta.change(high)[1]:ta.change(high)
down_2=stop_repainting_choice?-ta.change(low)[1]:-ta.change(low)
plusDM_2=na(up_2)?na:(up_2>down_2andup_2>0?up_2:0)
minusDM_2=na(down_2)?na:(down_2>up_2anddown_2>0?down_2:0)
trur_2=ta.rma(ta.tr,len_2)
di_plus_2=fixnan(100*ta.rma(plusDM_2,len_2)/trur_2)
di_minus_2=fixnan(100*ta.rma(minusDM_2,len_2)/trur_2)
sum_2=di_plus_2+di_minus_2
adx_2=100*ta.rma(math.abs(di_plus_2-di_minus_2)/(sum_2==0?1:sum_2),lensig_2)
adx_inrange_2=adx_2>=adx_min_2andadx_2<=adx_max_2
//End:+DI/-DIoptions-------------------------------------------------------
//Start:InputtosetupBuysignalswhenthesourcecrossesafibborder-------
entry_trigger_2=input.string("1-Crosses",title="Buysignalswhenthesource:[cont.]",options=["1-Crosses","2-Crossesup","3-Crossesdown"],tooltip="'Crosses'includesupanddownmovements.'CrossesUp'onlyincludesupmovements.'CrossesDown'onlyincludesdownmovements",group="2ndFibonacciTradeEntrySettings")
ifentry_trigger_2=="1-Crosses"
e_trig_2:=1
elseifentry_trigger_2=="2-Crossesup"
e_trig_2:=2
elseifentry_trigger_2=="3-Crossesdown"
e_trig_2:=3
entry_choice_2=input.string("6-Bottom-LowFibBorder",title="...TheFibline:",options=["1-Top-HighFibBorder","2-Bottom-HighFibBorder","3-Top-CenterFibBorder","4-Bottom-CenterFibBorder","5-Top-LowFibBorder","6-Bottom-LowFibBorder"],
tooltip='Therearethreefibzonesandeachzonehas2borders(Top&Bottom).Theoptionsarelistedfromthetopzonetothebottomzone.ThebottomzoneistheDowntrendzone;themiddlezoneistheRangingzone;ThetopfibzoneistheUptrendzone.',
group="2ndFibonacciTradeEntrySettings")
ifentry_choice_2=="1-Top-HighFibBorder"
fib_level_2:=hl_2
elseifentry_choice_2=="2-Bottom-HighFibBorder"
fib_level_2:=hf_2
elseifentry_choice_2=="3-Top-CenterFibBorder"
fib_level_2:=cfh_2
elseifentry_choice_2=="4-Bottom-CenterFibBorder"
fib_level_2:=cfl_2
elseifentry_choice_2=="5-Top-LowFibBorder"
fib_level_2:=lf_2
elseifentry_choice_2=="6-Bottom-LowFibBorder"
fib_level_2:=ll
//End:InputtosetupBuysignalswhenthesourcecrossesafibborder---------
//Start:+DI/-DIoptions-------------------------------------------------------
di_choice_2=input.bool(false,title="Onlyopentradesonbullish+DI(PositiveDirectionalIndex)?",tooltip=
'Defaultisdisabled.Ifyouwanttobemoreselective(youwantabullishconfirmation),enablethisanditwillonlyopentradeswhenthe+DI(PositiveDirectionalIndex)ishigherthanthe-DI(NegativeDirectionalIndex).Contrariantraders(buythedip)shouldleavethisdisabled',
group="2ndFibonacciTradeEntrySettings")
di_min_2=input.int(0,title='Min+DIvaluetoopentrade',
tooltip='Defaultiszero.Usethistosettheminium+DIvaluetoopenthetrade.Tryincrementingthisvalueifyouwanttobemoreselectiveandfilterformorebullishmoves(e.g.20-25).ForContrariantraders,uncheck"OnlyopentradesonbullishDI"optionandsetMin+DItozero',
group="2ndFibonacciTradeEntrySettings")
di_max_2=input.int(100,title='Max+DIvaluetoopentrade',tooltip='Defaultis100.Usethistosetthemaximum+DIvaluetoopentrade.ForContrariantraders,uncheck"OnlyopentradesonbullishDI"optionandtryaMax+DIvaluenohigherthan20or25',group="2ndFibonacciTradeEntrySettings")
di_neg_min_2=input.int(0,title='Min-DIvaluetoopentrade',
tooltip='Defaultiszero.Usethistosettheminium-DIvaluetoopenthetrade.Tryincrementingthisvalueifyouwanttobemoreselectiveandfilterformorebearishmoves(e.g.25orhigher).',
group="2ndFibonacciTradeEntrySettings")
di_neg_max_2=input.int(100,title='Max-DIvaluetoopentrade',tooltip='Defaultis100.Usethistosetthemaximum-DIvaluetoopentrade.',group="2ndFibonacciTradeEntrySettings")
di_inrange_2=di_plus_2>=di_min_2anddi_plus_2<=di_max_2anddi_minus_2>=di_neg_min_2anddi_minus_2<=di_neg_max_2
//End:+DI/-DIoptions---------------------------------------------------------
//End:FibonacciEntry-2Settings----------------------------------------------
//Start:RangedVolumeSettings------------------------------------------------
rv_enable=input.bool(false,title="UseRangedVolume?",tooltip='Uses"Source-close"valuesonly.Otherwiseitcausessomecandlestonotappearinthestudy.EnablethisoptionifyouwanttofactorinRangedVolumeaspartofyourstrategy',group="RangedVolumeTradeEntrySettings")
Range_Length=input.int(1,title="VolumeRangeLength",minval=1,group="RangedVolumeTradeEntrySettings")
Heikin_Ashi=input(false,title="HeikinAshi",tooltip='Trytogglingfordifferentresults.UsedwithRangedVolumecalculation.',group="RangedVolumeTradeEntrySettings")
Display_Bars=input(true,title="ShowBarColors",tooltip='UsedwithRangedVolume.',group="RangedVolumeTradeEntrySettings")
Display_Break=input(true,title="ShowBreak-Out",tooltip='UsedwithRangedVolume.',group="RangedVolumeTradeEntrySettings")
//Repaintoption---------------------------------------------------------------
Close:=Heikin_Ashi?request.security(ticker.heikinashi(syminfo.tickerid),timeframe.period,sourceInput01_func()):sourceInput01_func()
Open:=Heikin_Ashi?request.security(ticker.heikinashi(syminfo.tickerid),timeframe.period,open):open
Highest_vol=stop_repainting_choice?ta.highest(volume,Range_Length)[1]:ta.highest(volume,Range_Length)
Lowest_vol=stop_repainting_choice?ta.lowest(-volume,Range_Length)[1]:ta.lowest(-volume,Range_Length)
rv_up=Highest_vol>Highest_vol[1]andClose>Open
rv_down=Highest_vol>Highest_vol[1]andClose<Open
//Repaintoption---------------------------------------------------------------
ifrv_enable
Volume_Color:=
Display_Breakandrv_up?color.new(#ffeb3b,20):
Display_Breakandrv_down?color.new(#f44336,20):
Close>Open?color.new(#00c0ff,20):
Close<Open?color.new(#0001f6,20):na
else
Volume_Color:=na
//End:RangedVolumeSettings--------------------------------------------------
//Start:3Commassettings,BaseOrderandSafetyOrder,etc--------------------
enable_order_asap_1=input.bool(false,title='Fib-1,Opentradesfaster?\nDonotwaitforcandleclose?',tooltip="EnablethisifyoudonotwanttowaitforaclosingcandletoopenatradeonyourFib-1FibZoneStrategy."+
"Thecandle'shighorlowvaluewillbeusedinstead(thewickwillbethetrigger).Willusetheappropriatehigh/lowsignalbasedwhatyouselectedforFibentry(Crosses,Crossesup,Crossesdown)"+
"\nCanbeusefulifabotisopeningtradesslowerthanyouwouldlike.",group="TradeEntrySettings")
enable_order_asap_2=input.bool(false,title='Fib-2,Opentradesfaster?\nDonotwaitforcandleclose?',tooltip="EnablethisifyoudonotwanttowaitforaclosingcandletoopenatradeonyourFib-2FibZoneStrategy."+
"Thecandle'shighorlowvaluewillbeusedinstead(thewickwillbethetrigger).Willusetheappropriatehigh/lowsignalbased(Crosses,Crossesup,Crossesdown)"+
"\nCanbeusefulifabotisopeningtradesslowerthanyouwouldlike.",group="TradeEntrySettings")
base_order=input.float(100.0,minval=0.0,title='Baseorder',group="TradeEntrySettings")
safe_order=input.float(200.0,minval=0.0,title='Safetyorder',group="TradeEntrySettings")
price_deviation=input.float(6.0,title='Pricedeviationtoopensafetyorders(%)',step=0.25,minval=0.0,group="TradeEntrySettings")/100
safe_order_volume_scale=input.float(2.0,step=0.5,minval=0.0,title='Safetyordervolumescale',group="TradeEntrySettings")
safe_order_step_scale=input.float(1,step=0.1,minval=0,title='Safetyorderstepscale',group="TradeEntrySettings")
max_safe_order=input.int(5,minval=0,title='Maxsafetyorders',group="TradeEntrySettings")
min_vol_choice=input.bool(false,title='RequireMinimumVolumetoEnterTrade?',tooltip='Enablethistoonlyentertradeswiththespecifiedminimumvolume',group="TradeEntrySettings")
min_vol=input.int(0,step=10000,minval=0,title='MinimumVolumetoEnterTrade',group="TradeEntrySettings")
ma_vol_choice=input.bool(false,title='RequireVolumeMAtoEnterTrade?',tooltip='EnablethistoonlyentertradeswhenvolumeisequaltoorgreaterthantheVolumeMovingAverage',group="TradeEntrySettings")
ma_vol=input.int(1,step=1,minval=1,title='VolumeMA',group="TradeEntrySettings")
//DetermineifMinimumvolumeoptionisenabledandiftheminimumvalue>=currentvolumeorvolumema
min_vol_bool=volume>=min_vol
use_min_vol=min_vol_choice?min_vol_bool:true
ma_vol_bool=volume>=ta.sma(volume,ma_vol)
use_ma_vol=ma_vol_choice?ma_vol_bool:true
rsi_choice=input.bool(false,title='UseMaxRSIleveltolimittradeentries?',tooltip='EnablethistoonlyentertradeswhentheRSIisbelowthelevelyouenter.CurrentlythesourcefortheRSIiswhatyouspecifiedforFib-1.Fib-2sourceisnotused.',group="TradeEntrySettings")
rsi_length=input.int(14,step=1,minval=1,title='RSILength',tooltip='CurrentlythesourcefortheRSIiswhatyouspecifiedforFib-1.Fib-2sourceisnotused.',group="TradeEntrySettings")
rsi_overbought=input.int(70,title="SpecifyMaxRSIleveltolimittradeentry",tooltip='IftheRSIisatthislevelorhigher,notradeentryisallowed',group="TradeEntrySettings")
rsi_value=ta.rsi(sourceInput01_func(),rsi_length)
rsi_overbought_bool=rsi_value>=rsi_overbought
use_rsi_ob=rsi_choice?rsi_overbought_bool:false
//End:3Commassettings,BaseOrderandSafetyOrder,etc----------------------
//End:TradeEntrySettings----------------------------------------------------
//Truncatefunction
truncate(number,decimals)=>
factor=math.pow(10,decimals)
int(number*factor)/factor
//Start:TradeExitSettings---------------------------------------------------
enable_exit_asap_1=input.bool(false,title='Fib-1,Exittradesfaster?\nDonotwaitforcandleclose?',tooltip="EnablethisifyoudonotwanttowaitforaclosingcandletoexitatradeonyourFib-1FibZoneStrategy."+
"Thecandle'shighorlowvaluewillbeusedinstead(thewickwillbethetrigger).Willusetheappropriatehigh/lowsignalbasedwhatyouselectedforFibentry(Crosses,Crossesup,Crossesdown)"+
"\nCanbeusefulifabotisexitingtradesslowerthanyouwouldlike.",group="TradeExitSettings")
enable_exit_asap_2=input.bool(false,title='Fib-2,Exittradesfaster?\nDonotwaitforcandleclose?',tooltip="EnablethisifyoudonotwanttowaitforaclosingcandletoexitatradeonyourFib-2FibZoneStrategy."+
"Thecandle'shighorlowvaluewillbeusedinstead(thewickwillbethetrigger).Willusetheappropriatehigh/lowsignalbasedwhatyouselectedforFibentry(Crosses,Crossesup,Crossesdown)"+
"\nCanbeusefulifabotisexitingtradesslowerthanyouwouldlike.",group="TradeExitSettings")
//Start:FibonacciExit-1------------------------------------------------------
fib_tp_trigger=input.string("1-Crosses",title="ü•áFib-1,üí∞TakeProfitwhenthesource:[cont.]",options=["1-Crosses","2-Crossesup","3-Crossesdown","4-ReachesTargetTakeProfit(%)"],tooltip=
"'Crosses'includesupanddownmovements.'CrossesUp'onlyincludesupmovements.'CrossesDown'onlyincludesdownmovements",
group="1stFibonacciTradeExitSettings")
iffib_tp_trigger=="1-Crosses"
fib_tp:=1
elseiffib_tp_trigger=="2-Crossesup"
fib_tp:=2
elseiffib_tp_trigger=="3-Crossesdown"
fib_tp:=3
elseiffib_tp_trigger=="4-ReachesTargetTakeProfit(%)"
fib_tp:=4
//TakeProfitDrop-downmenuoptionforFib-1
tp_choice=input.string("1-Top-HighFibBorder",title="...TheFibline:",options=["1-Top-HighFibBorder","2-Bottom-HighFibBorder","3-Top-CenterFibBorder","4-Bottom-CenterFibBorder"],tooltip=
'Selecthowtoexityourtradeandtakeprofit.Thenspecifybelowthisoptiontheconditiontoexit."Top-HighFibBorder"isthetop-mostFibonaccilineinthegreenuptrendzone."Bottom-HighFibBorder"isthebottomFibonaccilineinthegreenuptrendzone.Youcanfindtheselinesonthe"Style"tabandtogglethemoff/ontolocatetheselinesformoreclarity',
group="1stFibonacciTradeExitSettings")
iftp_choice=="1-Top-HighFibBorder"
take_profit_1:=float(hl)
elseiftp_choice=="2-Bottom-HighFibBorder"
take_profit_1:=float(hf)
elseiftp_choice=="3-Top-CenterFibBorder"
take_profit_1:=float(cfh)
elseiftp_choice=="4-Bottom-CenterFibBorder"
take_profit_1:=float(cfl)
//End:FibonacciExit-1--------------------------------------------------------
//Start:FibonacciExit-2------------------------------------------------------
fib_tp_trigger_2=input.string("1-Crosses",title="ü•àFib-2,Takeüí∞Profitwhenthesource:[cont.]",options=["1-Crosses","2-Crossesup","3-Crossesdown","4-ReachesTargetTakeProfit(%)"],tooltip=
"'Crosses'includesupanddownmovements.'CrossesUp'onlyincludesupmovements.'CrossesDown'onlyincludesdownmovements.",
group="2ndFibonacciTradeExitSettings")
iffib_tp_trigger_2=="1-Crosses"
fib_tp_2:=1
elseiffib_tp_trigger_2=="2-Crossesup"
fib_tp_2:=2
elseiffib_tp_trigger_2=="3-Crossesdown"
fib_tp_2:=3
elseiffib_tp_trigger_2=="4-ReachesTargetTakeProfit(%)"
fib_tp_2:=4
//TakeProfitDrop-downmenuoptionforFib-2
tp_choice_2=input.string("1-Top-HighFibBorder",title="...TheFibline:",options=["1-Top-HighFibBorder","2-Bottom-HighFibBorder","3-Top-CenterFibBorder","4-Bottom-CenterFibBorder"],tooltip=
'Selecthowtoexityourtradeandtakeprofit.Thenspecifybelowthisoptiontheconditiontoexit."Top-HighFibBorder"isthetop-mostFibonaccilineinthegreenuptrendzone."Bottom-HighFibBorder"isthebottomFibonaccilineinthegreenuptrendzone.Youcanfindtheselinesonthe"Style"tabandtogglethemoff/ontolocatetheselinesformoreclarity',
group="2ndFibonacciTradeExitSettings")
iftp_choice_2=="1-Top-HighFibBorder"
take_profit_2:=float(hl_2)
elseiftp_choice_2=="2-Bottom-HighFibBorder"
take_profit_2:=float(hf_2)
elseiftp_choice_2=="3-Top-CenterFibBorder"
take_profit_2:=float(cfh_2)
elseiftp_choice_2=="4-Bottom-CenterFibBorder"
take_profit_2:=float(cfl_2)
//End:FibonacciExit-2--------------------------------------------------------
//Start:InputforTTP%-------------------------------------------------------
iffib_tp==4
take_profit_1:=input.float(3.0,title='Fib-1TargetTakeProfit(%)',step=0.5,minval=0.0,tooltip='Onlyusedif"TargetTakeProfit(%)"isselectedabove.',group="1stFibonacciTradeExitSettings")/100
iffib_tp_2==4
take_profit_2:=input.float(3.0,title='Fib-2TargetTakeProfit(%)',step=0.5,minval=0.0,tooltip='Onlyusedif"TargetTakeProfit(%)"isselectedabove.',group="2ndFibonacciTradeExitSettings")/100
//End:InputforTTP%---------------------------------------------------------
//Start:Trailingsettings----------------------------------------------------
trailing_1=input.float(0.0,title='Fib-1,üö¶Trailingdeviation.',step=0.1,minval=0.0,group="1stFibonacciTradeExitSettings")/100
trailing_2=input.float(0.0,title='Fib-2,üö¶Trailingdeviation.',step=0.1,minval=0.0,group="2ndFibonacciTradeExitSettings")/100
//END:Trailingsettings------------------------------------------------------
//Fibonacci-1TPandFibonacci-2TP--------------------------------------------
fb_tp_condition=false
fb_tp_condition_2=false
ifenable_exit_asap_1
iffib_tp==1
fb_tp_condition:=stop_repainting_choice?ta.cross(sourceInput01_func(),take_profit_1)orta.cross(low,take_profit_1)orta.cross(high,take_profit_1):ta.cross(sourceInput,take_profit_1)orta.cross(low,take_profit_1)orta.cross(high,take_profit_1)
elseiffib_tp==2
fb_tp_condition:=stop_repainting_choice?ta.crossover(sourceInput01_func(),take_profit_1)orta.crossover(high,take_profit_1):ta.crossover(sourceInput,take_profit_1)orta.crossover(high,take_profit_1)
elseiffib_tp==3
fb_tp_condition:=stop_repainting_choice?ta.crossunder(sourceInput01_func(),take_profit_1)orta.crossunder(low,take_profit_1):ta.crossunder(sourceInput,take_profit_1)orta.crossunder(low,take_profit_1)
else
iffib_tp==1
fb_tp_condition:=stop_repainting_choice?ta.cross(sourceInput01_func(),take_profit_1):ta.cross(sourceInput,take_profit_1)
elseiffib_tp==2
fb_tp_condition:=stop_repainting_choice?ta.crossover(sourceInput01_func(),take_profit_1):ta.crossover(sourceInput,take_profit_1)
elseiffib_tp==3
fb_tp_condition:=stop_repainting_choice?ta.crossunder(sourceInput01_func(),take_profit_1):ta.crossunder(sourceInput,take_profit_1)

ifenable_exit_asap_2
iffib_tp_2==1
fb_tp_condition_2:=stop_repainting_choice?ta.cross(sourceInput02_func(),take_profit_2)orta.cross(low,take_profit_2)orta.cross(high,take_profit_2):ta.cross(sourceInput_2,take_profit_2)orta.cross(low,take_profit_2)orta.cross(high,take_profit_2)
elseiffib_tp_2==2
fb_tp_condition_2:=stop_repainting_choice?ta.crossover(sourceInput02_func(),take_profit_2)orta.crossover(high,take_profit_2):ta.crossover(sourceInput_2,take_profit_2)orta.crossover(high,take_profit_2)
elseiffib_tp_2==3
fb_tp_condition_2:=stop_repainting_choice?ta.crossunder(sourceInput02_func(),take_profit_2)orta.crossunder(low,take_profit_2):ta.crossunder(sourceInput_2,take_profit_2)orta.crossunder(low,take_profit_2)
else
iffib_tp_2==1
fb_tp_condition_2:=stop_repainting_choice?ta.cross(sourceInput02_func(),take_profit_2):ta.cross(sourceInput_2,take_profit_2)
elseiffib_tp_2==2
fb_tp_condition_2:=stop_repainting_choice?ta.crossover(sourceInput02_func(),take_profit_2):ta.crossover(sourceInput_2,take_profit_2)
elseiffib_tp_2==3
fb_tp_condition_2:=stop_repainting_choice?ta.crossunder(sourceInput02_func(),take_profit_2):ta.crossunder(sourceInput_2,take_profit_2)
//End:TradeExitSettings-----------------------------------------------------
//Start:WHENTOBUYLOGIC-----------------------------------------------------
//DetermineifFibEntryTriggerwasmet
//FirstFibEntryCalculationforwhentobuy
ifenable_order_asap_1
ife_trig==1
e_trig_bool:=stop_repainting_choice?ta.cross(sourceInput01_func(),fib_level)orta.cross(low,fib_level)orta.cross(high,fib_level):ta.cross(sourceInput,fib_level)orta.cross(low,fib_level)orta.cross(high,fib_level)
elseife_trig==2
e_trig_bool:=stop_repainting_choice?ta.crossover(sourceInput01_func(),fib_level)orta.crossover(high,fib_level):ta.crossover(sourceInput,fib_level)orta.crossover(high,fib_level)
elseife_trig==3
e_trig_bool:=stop_repainting_choice?ta.crossunder(sourceInput01_func(),fib_level)orta.crossunder(low,fib_level):ta.crossunder(sourceInput,fib_level)orta.crossunder(low,fib_level)
else
e_trig_bool:=false
else
ife_trig==1
e_trig_bool:=stop_repainting_choice?ta.cross(sourceInput01_func(),fib_level):ta.cross(sourceInput,fib_level)
elseife_trig==2
e_trig_bool:=stop_repainting_choice?ta.crossover(sourceInput01_func(),fib_level):ta.crossover(sourceInput,fib_level)
elseife_trig==3
e_trig_bool:=stop_repainting_choice?ta.crossunder(sourceInput01_func(),fib_level):ta.crossunder(sourceInput,fib_level)
else
e_trig_bool:=false
//SecondFibEntryCalculationforwhentobuy
ifenable_order_asap_2
ife_trig_2==1
e_trig_bool_2:=stop_repainting_choice?ta.cross(sourceInput02_func(),fib_level_2)orlow<=fib_level_2orhigh>=fib_level_2:ta.cross(sourceInput_2,fib_level_2)orlow<=fib_level_2orhigh>=fib_level_2
elseife_trig_2==2
e_trig_bool_2:=stop_repainting_choice?ta.crossover(sourceInput02_func(),fib_level_2)orhigh>=fib_level_2:ta.crossover(sourceInput_2,fib_level_2)orhigh>=fib_level_2
elseife_trig_2==3
e_trig_bool_2:=stop_repainting_choice?ta.crossunder(sourceInput02_func(),fib_level_2)orlow<=fib_level_2:ta.crossunder(sourceInput_2,fib_level_2)orlow<=fib_level_2
else
e_trig_bool_2:=false
else
ife_trig_2==1
e_trig_bool_2:=stop_repainting_choice?ta.cross(sourceInput02_func(),fib_level_2):ta.cross(sourceInput_2,fib_level_2)
elseife_trig_2==2
e_trig_bool_2:=stop_repainting_choice?ta.crossover(sourceInput02_func(),fib_level_2):ta.crossover(sourceInput_2,fib_level_2)
elseife_trig_2==3
e_trig_bool_2:=stop_repainting_choice?ta.crossunder(sourceInput02_func(),fib_level_2):ta.crossunder(sourceInput_2,fib_level_2)
else
e_trig_bool_2:=false
use_rv=rv_enable?rv_up:true
use_fib=true
use_fib_2=true
fib_1_strat_active=false
fib_2_strat_active=false
//FirstFibEntryCalculationforwhentobuy
iffib_enable
use_fib:=e_trig_boolandadx_inrange_1
else
use_fib:=false
//SecondFibEntryCalculationforwhentobuy
iffib_enable_2
use_fib_2:=e_trig_bool_2andadx_inrange_2
else
use_fib_2:=false
//CheckforBullish+DIentryonFib-1zonestrategy
//'di_entry'checksforBullish+DIentry(di_plus>diminus)onbothFibstrategies
di_entry=false
ifdi_choice
di_entry:=(di_plus>di_minus)?true:false
else
di_entry:=true
//CheckforBullish+DIentryonFib-2zonestrategy
di_entry_2=false
ifdi_choice_2
di_entry_2:=(di_plus_2>di_minus_2)?true:false
else
di_entry_2:=true
//If-elseconditionorderstructure
//Useminimumvolime->DateRange->EnabledStrategy(fib_enable/fib_enable_2)->Fibentry(use_fib/use_fib_2)->
//DIRange->Bullish+DIoption(di_choice/di_choice_2)->Bullish+DIentry(di_entry)->RVenabled(rv_enable->use_rv)
//Onlycheckforbuysignal,ifconditionexiststocheckfortradeentryandweareintheDateRangespecified,elsebuyisfalse
ifstrategy.position_size==0andinDateRangeanduse_min_volanduse_ma_volanduse_rsi_ob==false
//IfFib-1isenabled,checkforpossibletradeentries
iffib_enable
//BuyifFibentryisfound(use_fib)andDIisinrangeandBullish+DIenabled(di_choice)andRVenabled(rv_enable->use_rv)
ifuse_fibanddi_inrangeanddi_choiceanddi_entryanduse_rv
buy:=true
//ElsebuyifFib-1'sBullish+DIisdisabled(di_choice==false)andRVisenabledand+DIisinrange
elseifuse_fibanddi_inrangeanddi_choice==falseanduse_rv
buy:=true
//ElseifFib-2isenabledandbuyisstillfalse(aftercheckingforentrieswithFib-1strategy),checkforpossibletradeentries
iffib_enable_2andbuy==false
//BuyifFibentryisfound(use_fib_2)andDIisinrange(di_inrange_2)andBullish+DIenabled(di_choice_2)andDIBullishifenabled(di_entry)andRVenabled(rv_enable->use_rv)
ifuse_fib_2anddi_inrange_2anddi_choice_2anddi_entry_2anduse_rv
buy:=true
//ElsebuyifFib-2'sBullish+DIisdisabled(di_choice==false)andRVisenabledand+DIisinrange
elseifuse_fib_2anddi_inrange_2anddi_choice_2==falseanduse_rv
buy:=true
//If"buy"isTrue,thenopentradebasedonusersettingsandtracktheactivestrategyvia"strat"
ifbuyandstrategy.position_size==0andsourceInput>0andfib_enableanduse_fib
strat:="Fib-1"
ifuse_labels
label.new(bar_index,sourceInput,text=strat+'Long@'+str.tostring(math.round(sourceInput,5)),style=label.style_label_up,color=color.green)
strategy.entry('ü•á'+strat+'Long@'+str.tostring(math.round(sourceInput,5))+'üíé‚úãü§ö',strategy.long,qty=base_order/sourceInput)
else
strategy.entry('ü•á'+strat+'Long@'+str.tostring(math.round(sourceInput,5))+'üíé‚úãü§ö',strategy.long,qty=base_order/sourceInput)
initial_order:=sourceInput
current_so:=1
previous_high_value:=0.0
original_ttp_value:=0
fib_1_strat_active:=true
fib_2_strat_active:=false
current_sourceInput:=sourceInput

elseifbuyandstrategy.position_size==0andsourceInput_2>0andfib_enable_2anduse_fib_2
strat:="Fib-2"
ifuse_labels
label.new(bar_index,sourceInput_2,text=strat+'Long@'+str.tostring(math.round(sourceInput_2,5)),style=label.style_label_up,color=color.lime)
strategy.entry('ü•à'+strat+'Long@'+str.tostring(math.round(sourceInput_2,5))+'üíé‚úãü§ö',strategy.long,qty=base_order/sourceInput_2)
else
strategy.entry('ü•à'+strat+'Long@'+str.tostring(math.round(sourceInput_2,5))+'üíé‚úãü§ö',strategy.long,qty=base_order/sourceInput_2)
initial_order:=sourceInput_2
current_so:=1
previous_high_value:=0.0
original_ttp_value:=0
fib_2_strat_active:=true
fib_1_strat_active:=false
current_sourceInput:=sourceInput_2
//End:WHENTOBUY-------------------------------------------------------------
//Start:Fib-1,FibBasedStopLoss--------------------------------------------
tp_choice_fibstoploss=input.bool(false,title='UseFib-basedüõëStopLossonFib-1strategy?',tooltip='EnabletoexitFib-1tradewhensourcecrossesaFibBorder',group="1stFibonacciTradeExitSettings")
fib_exit_trigger=input.string("1-Crosses",title="FibStopLosssignalswhenthesource:[cont.]",options=["1-Crosses","2-Crossesup","3-Crossesdown"],
tooltip="IgnoredifaboveoptionforFib-basedStopLossisnotenabled.'Crosses'includesupanddownmovements.'CrossesUp'onlyincludesupmovements.'CrossesDown'onlyincludesdownmovements",group="1stFibonacciTradeExitSettings")
iffib_exit_trigger=="1-Crosses"
fib_exit:=1
elseiffib_exit_trigger=="2-Crossesup"
fib_exit:=2
elseiffib_exit_trigger=="3-Crossesdown"
fib_exit:=3
fib_exit_choice=input.string("6-Bottom-LowFibBorder",title="...TheFibline:",options=["1-Top-HighFibBorder","2-Bottom-HighFibBorder","3-Top-CenterFibBorder","4-Bottom-CenterFibBorder","5-Top-LowFibBorder","6-Bottom-LowFibBorder"],
tooltip='Therearethreefibzonesandeachzonehas2borders(Top&Bottom).Theoptionsarelistedfromthetopzonetothebottomzone.ThebottomzoneistheDowntrendzone;themiddlezoneistheRangingzone;ThetopfibzoneistheUptrendzone.',
group="1stFibonacciTradeExitSettings")
iffib_exit_choice=="1-Top-HighFibBorder"
fib_exit_level:=hl
elseiffib_exit_choice=="2-Bottom-HighFibBorder"
fib_exit_level:=hf
elseiffib_exit_choice=="3-Top-CenterFibBorder"
fib_exit_level:=cfh
elseiffib_exit_choice=="4-Bottom-CenterFibBorder"
fib_exit_level:=cfl
elseiffib_exit_choice=="5-Top-LowFibBorder"
fib_exit_level:=lf
elseiffib_exit_choice=="6-Bottom-LowFibBorder"
fib_exit_level:=ll
//End:Fib-1,FibBasedStopLoss----------------------------------------------
//Start:Fib-2,FibBasedStopLoss-------------------------------------------
tp_choice_fibstoploss_2=input.bool(false,title='UseFib-basedüõëStopLossonFib-2strategy?',tooltip='EnabletoexitFib-2tradewhensourcecrossesaFibBorder',group="2ndFibonacciTradeExitSettings")
fib_exit_trigger_2=input.string("1-Crosses",title="FibStopLosssignalswhenthesource:[cont.]",options=["1-Crosses","2-Crossesup","3-Crossesdown"],
tooltip="IgnoredifaboveoptionforFib-basedStopLossisnotenabled.'Crosses'includesupanddownmovements.'CrossesUp'onlyincludesupmovements.'CrossesDown'onlyincludesdownmovements",group="2ndFibonacciTradeExitSettings")
iffib_exit_trigger_2=="1-Crosses"
fib_exit_2:=1
elseiffib_exit_trigger_2=="2-Crossesup"
fib_exit_2:=2
elseiffib_exit_trigger_2=="3-Crossesdown"
fib_exit_2:=3
fib_exit_choice_2=input.string("6-Bottom-LowFibBorder",title="...TheFibline:",options=["1-Top-HighFibBorder","2-Bottom-HighFibBorder","3-Top-CenterFibBorder","4-Bottom-CenterFibBorder","5-Top-LowFibBorder","6-Bottom-LowFibBorder"],
tooltip='Therearethreefibzonesandeachzonehas2borders(Top&Bottom).Theoptionsarelistedfromthetopzonetothebottomzone.ThebottomzoneistheDowntrendzone;themiddlezoneistheRangingzone;ThetopfibzoneistheUptrendzone.',
group="2ndFibonacciTradeExitSettings")
iffib_exit_choice_2=="1-Top-HighFibBorder"
fib_exit_level_2:=hl_2
elseiffib_exit_choice_2=="2-Bottom-HighFibBorder"
fib_exit_level_2:=hf_2
elseiffib_exit_choice_2=="3-Top-CenterFibBorder"
fib_exit_level_2:=cfh_2
elseiffib_exit_choice_2=="4-Bottom-CenterFibBorder"
fib_exit_level_2:=cfl_2
elseiffib_exit_choice_2=="5-Top-LowFibBorder"
fib_exit_level_2:=lf_2
elseiffib_exit_choice_2=="6-Bottom-LowFibBorder"
fib_exit_level_2:=ll_2
//End:Fib-2,FibBasedStopLoss----------------------------------------------
//Start:InputtoexittradeoneitherBullishorBearishDICrossovers--------
di_bull_choice_1=input.bool(false,title='üêÆExittradeonbulltraps?',tooltip='Enabletoexittradewhenthe+DIcrossesoverthe-DIandthepreviousclosewasaredcandle.',group="1stFibonacciTradeExitSettings")
di_bear_choice_1=input.bool(false,title='üêªExittradeonbeartraps?',tooltip='Enabletoexittradewhenthe-DIcrossesoverthe+DIandthepreviousclosewasagreencandle.',group="1stFibonacciTradeExitSettings")
di_bull_choice_2=input.bool(false,title='üêÆExittradeonbulltrap?',tooltip='Enabletoexittradewhenthe+DIcrossesoverthe-DIandthepreviousclosewasaredcandle.',group="2ndFibonacciTradeExitSettings")
di_bear_choice_2=input.bool(false,title='üêªExittradeonbeartrap?',tooltip='Enabletoexittradewhenthe-DIcrossesoverthe+DIandthepreviousclosewasagreencandle.',group="2ndFibonacciTradeExitSettings")
//Start:InputtoexittradeoneitherBullishorBearishDICrossovers--------
//Start:CheckforDICrossovers-----------------------------------------------
//DetectBulltrapwhenthe+DIx-over-DIandthepreviousclosewasaredcandle
DIxUp_1:=ta.crossover(di_plus,di_minus)andclose[1]<open[1]?true:na
//DetectBeartrapwhenthe+DIx-under-DIandthepreviousclosewasagreencandle
DIxDown_1:=ta.crossunder(di_plus,di_minus)andclose[1]>open[1]?true:na
//DetectBulltrapwhenthe+DIx-over-DIandthepreviousclosewasaredcandle
DIxUp_2:=ta.crossover(di_plus_2,di_minus_2)andclose[1]<open[1]?true:na
//DetectBeartrapwhenthe+DIx-under-DIandthepreviousclosewasagreencandle
DIxDown_2:=ta.crossunder(di_plus_2,di_minus_2)andclose[1]>open[1]?true:na
//End:CheckforDICrossovers-------------------------------------------------
//Start:DeterminewhichFibBasedStopLosswasselectedforFib-1------------
ifenable_exit_asap_1
iffib_exit==1
exit_trig_bool:=stop_repainting_choice?ta.cross(sourceInput01_func(),fib_exit_level)orta.cross(high,fib_exit_level):ta.cross(sourceInput,fib_exit_level)orta.cross(high,fib_exit_level)
elseiffib_exit==2
exit_trig_bool:=stop_repainting_choice?ta.crossover(sourceInput01_func(),fib_exit_level)orta.crossover(high,fib_exit_level):ta.crossover(sourceInput,fib_exit_level)orta.crossover(high,fib_exit_level)
elseiffib_exit==3
exit_trig_bool:=stop_repainting_choice?ta.crossunder(sourceInput01_func(),fib_exit_level)orta.crossunder(low,fib_exit_level):ta.crossunder(sourceInput,fib_exit_level)orta.crossunder(low,fib_exit_level)
else
exit_trig_bool:=false
else
iffib_exit==1
exit_trig_bool:=stop_repainting_choice?ta.cross(sourceInput01_func(),fib_exit_level):ta.cross(sourceInput,fib_exit_level)
elseiffib_exit==2
exit_trig_bool:=stop_repainting_choice?ta.crossover(sourceInput01_func(),fib_exit_level):ta.crossover(sourceInput,fib_exit_level)
elseiffib_exit==3
exit_trig_bool:=stop_repainting_choice?ta.crossunder(sourceInput01_func(),fib_exit_level):ta.crossunder(sourceInput,fib_exit_level)
else
exit_trig_bool:=false
//End:DeterminewhichFibBasedStopLosswasselectedforFib-1--------------
//Start:DeterminewhichFibBasedStopLosswasselectedforFib-2-----------
ifenable_exit_asap_2
iffib_exit_2==1
exit_trig_bool_2:=stop_repainting_choice?ta.cross(sourceInput02_func(),fib_exit_level_2)orta.cross(high,fib_exit_level_2):ta.cross(sourceInput,fib_exit_level_2)orta.cross(high,fib_exit_level_2)
elseiffib_exit_2==2
exit_trig_bool_2:=stop_repainting_choice?ta.crossover(sourceInput02_func(),fib_exit_level_2)orta.crossover(high,fib_exit_level_2):ta.crossover(sourceInput,fib_exit_level_2)orta.crossover(high,fib_exit_level_2)
elseiffib_exit_2==3
exit_trig_bool_2:=stop_repainting_choice?ta.crossunder(sourceInput02_func(),fib_exit_level_2)orta.crossunder(low,fib_exit_level_2):ta.crossunder(sourceInput,fib_exit_level_2)orta.crossunder(low,fib_exit_level_2)
else
exit_trig_bool_2:=false
else
iffib_exit_2==1
exit_trig_bool_2:=stop_repainting_choice?ta.cross(sourceInput02_func(),fib_exit_level_2):ta.cross(sourceInput,fib_exit_level_2)
elseiffib_exit_2==2
exit_trig_bool_2:=stop_repainting_choice?ta.crossover(sourceInput02_func(),fib_exit_level_2):ta.crossover(sourceInput,fib_exit_level_2)
elseiffib_exit_2==3
exit_trig_bool_2:=stop_repainting_choice?ta.crossunder(sourceInput02_func(),fib_exit_level_2):ta.crossunder(sourceInput,fib_exit_level_2)
else
exit_trig_bool_2:=false
//End:DeterminewhichFibBasedStopLosswasselectedforFib-2-------------
//Start:DetermineifFibStopLossconditionismetforFib-1----------------
ifstrategy.position_size>0
pnl_pct:=truncate((close-strategy.position_avg_price)/strategy.position_avg_price*100,3)
ifstrat=="Fib-1"
iftp_choice_fibstoplossandexit_trig_bool
ifuse_labels
label.new(bar_index,current_sourceInput,text="Fib-1StopLoss"+str.tostring(math.round(current_sourceInput,5))+','+str.tostring(pnl_pct)+'%',style=label.style_label_down,color=color.red,textcolor=color.white)
strategy.close_all(comment='ü•áüõë'+strat+'Stop-Loss@'+str.tostring(math.round(current_sourceInput,5))+','+str.tostring(pnl_pct)+'%')
else
strategy.close_all(comment='ü•áüõë'+strat+'Stop-Loss@'+str.tostring(math.round(current_sourceInput,5))+','+str.tostring(pnl_pct)+'%')
current_so:=0
previous_high_value:=0
original_ttp_value:=0
fib_1_strat_active:=false
fib_2_strat_active:=false
stopValue:=0
trailing:=0
trailing_price:=0
original_ttp_value:=0
stopValue:=0
sell:=true
//SendSellAlertto3Commasbot
alert(sell_message,alert.freq_once_per_bar_close)
//End:DetermineifFibStopLossconditionismetforFib-1------------------
elseifstrat=="Fib-2"
//Start:DetermineifFibStopLossconditionismetforFib-2----------------
iftp_choice_fibstoploss_2andexit_trig_bool_2
ifuse_labels
label.new(bar_index,current_sourceInput,text="Fib-2StopLoss"+str.tostring(math.round(current_sourceInput,5))+','+str.tostring(pnl_pct)+'%',style=label.style_label_down,color=color.red,textcolor=color.white)
strategy.close_all(comment='ü•àüõë'+strat+'Stop-Loss@'+str.tostring(math.round(current_sourceInput,5))+','+str.tostring(pnl_pct)+'%')
else
strategy.close_all(comment='ü•àüõë'+strat+'Stop-Loss@'+str.tostring(math.round(current_sourceInput,5))+','+str.tostring(pnl_pct)+'%')
current_so:=0
previous_high_value:=0
original_ttp_value:=0
fib_1_strat_active:=false
fib_2_strat_active:=false
trailing_price:=0
stopValue:=0
trailing:=0
trailing_price:=0
original_ttp_value:=0
stopValue:=0
sell:=true
//SendSellAlertto3Commasbot
alert(sell_message,alert.freq_once_per_bar_close)
//End:DetermineifFibStopLossconditionismetforFib-2------------------
//End:FibBasedStopLoss-----------------------------------------------------
//Start:TakeProfitLevel-----------------------------------------------------
//ConditionswhentotakeprofitandwhichFibstrategyistheactivestrategy
//ConditiontotakeprofitifactivestrategyisFib-1
ifstrategy.position_size>0
ifstrat=="Fib-1"
iffib_tp==4
take_profit_level:=strategy.position_avg_price*(1+take_profit_1)
fib_1_strat_active:=true
fib_2_strat_active:=false
elseiftake_profit_1>0andfib_tp!=4
take_profit:=take_profit_1
fib_1_strat_active:=true
fib_2_strat_active:=false
trailing:=trailing_1
//ConditiontotakeprofitifactivestrategyisFib-2
ifstrat=="Fib-2"
iftake_profit_2>0andfib_tp_2==4
take_profit_level:=strategy.position_avg_price*(1+take_profit_2)
fib_1_strat_active:=false
fib_2_strat_active:=true
elseiftake_profit_2>0andfib_tp_2!=4
take_profit:=take_profit_2
fib_1_strat_active:=false
fib_2_strat_active:=true
trailing:=trailing_2
//If1stFibstratisenabled(fib_enableistrue)andtakeprofitisnotTTP%(fib_tpnot4)andthereisanactiveorderoriginatedfrom1stFibstrat(fib_1_strat_activeistrue)
iffib_enableandfib_tp!=4andfib_1_strat_activeandstrategy.position_size>0andstrat=="Fib-1"
take_profit_level:=take_profit_1
fib_1_strat_active:=true
fib_2_strat_active:=false
//Elseif2ndFibstratisenabled(fib_enable_2istrue)andtakeprofitisnotTTP%(fib_tpnot4)andthereisanactiveorderoriginatedfrom2ndFibstrat(fib_2_strat_activeistrue)
elseiffib_enable_2andfib_tp_2!=4andfib_2_strat_activeandstrategy.position_size>0andstrat=="Fib-2"
take_profit_level:=take_profit_2
fib_1_strat_active:=false
fib_2_strat_active:=true
//End:TakeProfitLevel-------------------------------------------------------
//Start:SafetyOrderthresholdlogic------------------------------------------
ifsafe_order_step_scale==1.0
threshold:=initial_order-initial_order*price_deviation*safe_order_step_scale*current_so
elseifcurrent_so<=max_safe_order
threshold:=initial_order-initial_order*((price_deviation*math.pow(safe_order_step_scale,current_so)-price_deviation)/(safe_order_step_scale-1))
elseifcurrent_so>max_safe_order
threshold:=initial_order-initial_order*((price_deviation*math.pow(safe_order_step_scale,max_safe_order)-price_deviation)/(safe_order_step_scale-1))
//StartTakeProfit------------------------------------------------------------
//Start:TakeprofitifBull/BearTrapwasselected-----------------------------
ifstrategy.position_size>0
ifdi_bull_choice_1andDIxUp_1andstrat=="Fib-1"
pnl_pct:=truncate((sourceInput01_func()-strategy.position_avg_price)/strategy.position_avg_price*100,3)
ifuse_labels
label.new(bar_index,sourceInput01_func(),text=strat+'BullTrapClose@'+str.tostring(math.round(sourceInput01_func(),5))+','+str.tostring(pnl_pct)+'%',style=label.style_label_down,color=color.purple,textcolor=color.white)
strategy.close_all(comment='üí∞'+strat+'BullTrapClose@'+str.tostring(sourceInput01_func())+','+str.tostring(pnl_pct)+'%')
else
strategy.close_all(comment='üí∞'+strat+'BullTrapClose@'+str.tostring(sourceInput01_func())+','+str.tostring(pnl_pct)+'%')
alert(sell_message,alert.freq_once_per_bar_close)
sell:=true
ifdi_bear_choice_1andDIxDown_1andstrat=="Fib-1"
ifuse_labels
label.new(bar_index,sourceInput01_func(),text=strat+'BearTrapClose@'+str.tostring(math.round(sourceInput01_func(),5))+','+str.tostring(pnl_pct)+'%',style=label.style_label_down,color=color.purple,textcolor=color.white)
strategy.close_all(comment='üí∞'+strat+'BearTrapClose@'+str.tostring(sourceInput01_func())+','+str.tostring(pnl_pct)+'%')
else
strategy.close_all(comment='üí∞'+strat+'BearTrapClose@'+str.tostring(sourceInput01_func())+','+str.tostring(pnl_pct)+'%')
alert(sell_message,alert.freq_once_per_bar_close)
sell:=true
ifdi_bull_choice_2andDIxUp_2andstrat=="Fib-2"
pnl_pct:=truncate((sourceInput01_func()-strategy.position_avg_price)/strategy.position_avg_price*100,3)
ifuse_labels
label.new(bar_index,sourceInput02_func(),text=strat+'BullTrapClose@'+str.tostring(math.round(sourceInput02_func(),5))+','+str.tostring(pnl_pct)+'%',style=label.style_label_down,color=color.purple,textcolor=color.white)
strategy.close_all(comment='üí∞'+strat+'BullTrapClose@'+str.tostring(sourceInput02_func())+','+str.tostring(pnl_pct)+'%')
else
strategy.close_all(comment='üí∞'+strat+'BullTrapClose@'+str.tostring(sourceInput02_func())+','+str.tostring(pnl_pct)+'%')
alert(sell_message,alert.freq_once_per_bar_close)
sell:=true
ifdi_bear_choice_2andDIxDown_2andstrat=="Fib-2"
ifuse_labels
label.new(bar_index,sourceInput02_func(),text=strat+'BearTrapClose@'+str.tostring(math.round(sourceInput02_func(),5))+','+str.tostring(pnl_pct)+'%',style=label.style_label_down,color=color.purple,textcolor=color.white)
strategy.close_all(comment='üí∞'+strat+'BearTrapClose@'+str.tostring(sourceInput02_func())+','+str.tostring(pnl_pct)+'%')
else
strategy.close_all(comment='üí∞'+strat+'BearTrapClose@'+str.tostring(sourceInput02_func())+','+str.tostring(pnl_pct)+'%')
alert(sell_message,alert.freq_once_per_bar_close)
sell:=true
ifsell
current_so:=0
previous_high_value:=0
original_ttp_value:=0
fib_1_strat_active:=false
fib_2_strat_active:=false
stopValue:=0
trailing:=0
trailing_price:=0
original_ttp_value:=0
stopValue:=0
sell:=true
//End:TakeprofitifDIcrossoverswasselected-------------------------------
//IfFib-1strategyisactiveandatakeprofitconditionisfoundORIfFib-2strategyisactiveandatakeprofitconditionisfound
//Takeprofitwhentakeprofitlevelisequaltoorhigherthanthehighofthecandle
iftake_profit_level<=highandstrategy.position_size>0orprevious_high_value>0.0or(fib_enableandfb_tp_condition)or(fib_enable_2andfb_tp_condition_2)
pnl_pct:=truncate((close-strategy.position_avg_price)/strategy.position_avg_price*100,3)
iftrailing>0.0
//'trailing_price'willcontainthelargestpercentage-basedstopvalue
trailing_price:=if(strategy.position_size>0)
//'stopValue'willupdateeverycandlecloseandcontainapercentage-basedstopvalue
if(enable_exit_asap_1andfb_tp_condition)or(enable_exit_asap_2andfb_tp_condition_2)
stopValue:=high*(1-trailing)
else
stopValue:=close*(1-trailing)
//The'max'functioniswhatallowsthepercentage-basedstopto'Trail'.
//IfthestopValueishigherthantheprevioustrailing_price(whichwastheoldstopValue)thenwekeepthehighervalue
//Thetrailing_pricecanonlyincreaseorremainthesame.
math.max(stopValue,trailing_price[1])
else
0
ifprevious_high_value>0.0
ifhigh>=previous_high_value
previous_high_value:=strat=="Fib-1"?sourceInput01_func():sourceInput02_func()
ifenable_exit_asap_1orenable_exit_asap_2
ifhigh<=trailing_price
ifstrat=="Fib-1"
ifuse_labels
label.new(bar_index,sourceInput01_func(),text=strat+'Close(trailing)@'+str.tostring(math.round(close,5))+','+str.tostring(pnl_pct)+'%',style=label.style_label_down,color=color.yellow)
strategy.close_all(comment='ü•áüö¶'+strat+'Close(trailing)@'+str.tostring(math.round(close,5))+','+str.tostring(pnl_pct)+'%')
else
strategy.close_all(comment='ü•áüö¶'+strat+'Close(trailing)@'+str.tostring(math.round(close,5))+','+str.tostring(pnl_pct)+'%')
elseifstrat=="Fib-2"
ifuse_labels
label.new(bar_index,sourceInput02_func(),text=strat+'Close(trailing)@'+str.tostring(math.round(close,5))+','+str.tostring(pnl_pct)+'%',style=label.style_label_down,color=color.white)
strategy.close_all(comment='ü•àüö¶'+strat+'Close(trailing)@'+str.tostring(math.round(close,5))+','+str.tostring(pnl_pct)+'%')
else
strategy.close_all(comment='ü•àüö¶'+strat+'Close(trailing)@'+str.tostring(math.round(close,5))+','+str.tostring(pnl_pct)+'%')
sell:=true
strat:=na
//SendSellAlertto3Commasbot
alert(sell_message,alert.freq_once_per_bar_close)
else
ifclose<=trailing_price
ifstrat=="Fib-1"
ifuse_labels
label.new(bar_index,sourceInput01_func(),text=strat+'Close(trailing)@'+str.tostring(math.round(close,5))+','+str.tostring(pnl_pct)+'%',style=label.style_label_down,color=color.yellow)
strategy.close_all(comment='ü•áüö¶'+strat+'Close(trailing)@'+str.tostring(math.round(close,5))+','+str.tostring(pnl_pct)+'%')
else
strategy.close_all(comment='ü•áüö¶'+strat+'Close(trailing)@'+str.tostring(math.round(close,5))+','+str.tostring(pnl_pct)+'%')
elseifstrat=="Fib-2"
ifuse_labels
label.new(bar_index,sourceInput02_func(),text=strat+'Close(trailing)@'+str.tostring(math.round(close,5))+','+str.tostring(pnl_pct)+'%',style=label.style_label_down,color=color.white)
strategy.close_all(comment='ü•àüö¶'+strat+'Close(trailing)@'+str.tostring(math.round(close,5))+','+str.tostring(pnl_pct)+'%')
else
strategy.close_all(comment='ü•àüö¶'+strat+'Close(trailing)@'+str.tostring(math.round(close,5))+','+str.tostring(pnl_pct)+'%')
sell:=true
strat:=na
//SendSellAlertto3Commasbot
alert(sell_message,alert.freq_once_per_bar_close)
else
previous_high_value:=high
original_ttp_value:=high
else
ifuse_labelsandstrategy.position_size>0andsell==false
label.new(bar_index,current_sourceInput,text=strat+'Close@'+str.tostring(math.round(high,5))+','+str.tostring(pnl_pct)+'%',style=label.style_label_down,color=color.yellow)
strategy.close_all(comment='üí∞'+strat+'Close@'+str.tostring(math.round(high,5))+','+str.tostring(pnl_pct)+'%')
sell:=true
strat:=na
alert(sell_message,alert.freq_once_per_bar_close)
else
strategy.close_all(comment='üí∞'+strat+'Close@'+str.tostring(math.round(high,5))+','+str.tostring(pnl_pct)+'%')
sell:=true
strat:=na
alert(sell_message,alert.freq_once_per_bar_close)

//Zerooutvaluesaftertradeisclosed
ifna(strat)
current_so:=0
previous_high_value:=0
original_ttp_value:=0
fib_1_strat_active:=false
fib_2_strat_active:=false
stopValue:=0
trailing:=0
trailing_price:=0
//EndTakeProfit--------------------------------------------------------------
//Averagedownwhenlowestcandlevaluecrossesbelowthreshold
ifcurrent_so>0andlow<=thresholdandcurrent_so<=max_safe_orderandprevious_high_value==0.0andstrategy.position_size>0
//CalculateqtytobuyifSOistriggered
so_qty:=safe_order*math.pow(safe_order_volume_scale,current_so-1)/threshold
ifuse_labels
label.new(bar_index,current_sourceInput,text=strat+'SO-'+str.tostring(current_so)+'@'+str.tostring(math.round(threshold,5))+''+str.tostring(math.round(so_qty,2)),style=label.style_label_up,color=color.new(#3d85c6,0),textcolor=color.white)
strategy.entry('üò®üôè'+strat+'SO-'+str.tostring(current_so)+'@'+str.tostring(math.round(threshold,5)),direction=strategy.long,qty=so_qty)
current_so+=1
//End:SafetyOrderthresholdlogic--------------------------------------------
//Clearthetrailingvaluesifnoopentrades
ifstrategy.opentrades==0
original_ttp_value:=0
stopValue:=0
//Start:Plots-----------------------------------------------------------------
//Plotbarcolorforvolumerangeindicator
barcolor(Volume_Color,title="RangedVolumeBarColoring:(Disablebarcoloringinanystudiesaddedorthisbarcoloringwon'twork.)",editable=false)
//PlotTrailingStopLossandassociatedoriginalTTPvalue
plot(original_ttp_value>0?original_ttp_value:na,style=plot.style_linebr,color=color.white,linewidth=4,title="OriginalTTPValue",editable=true)
plot(stopValue>0?stopValue:na,style=plot.style_linebr,color=color.red,linewidth=4,title="StopValue",editable=true)
plot(trailing_price>0?trailing_price:na,style=plot.style_linebr,color=color.yellow,linewidth=4,title="Trailingstoploss",editable=true)
//PlotFibonacciAreas
fill(plot(hl,title='1stTop-HighFibBorder',color=color.new(#00FFFF,50),linewidth=1),plot(hf,title='1stBottom-HighFibBorder',color=color.new(#38761d,50),linewidth=1),color=color.new(#00FFFF,80),title='1stUptrendFibonacciZone@23.6%')//uptrendzone
fill(plot(cfh,title='1stTop-CenterFibBorder',color=color.new(#0589f4,50),linewidth=1),plot(cfl,title='1stBottom-CenterFibBorder',color=color.new(#2018ff,50),linewidth=1),color=color.new(color.blue,80),title='1stRangingFibonacciZone@61.8%')//rangingzone
fill(plot(lf,title='1stTop-LowFibBorder',color=color.new(color.yellow,50),linewidth=1),plot(ll,title='1stBottom-LowFibBorder',color=color.new(#bf00ff,50),linewidth=1),color=color.new(color.orange,80),title='1stDowntrendFibonacciZone@76.4%')//downtrendzone
//PlotFibonacci-2Areas
fill(plot(hl_2,title='2ndTop-HighFibBorder',color=color.new(#BCBCBC,50),linewidth=1),plot(hf_2,title='2ndBottom-HighFibBorder',color=color.new(#BCBCBC,50),linewidth=1),color=color.new(#BCBCBC,80),title='2ndUptrendFibonacciZone@23.6%')//uptrendzone
fill(plot(cfh_2,title='2ndTop-CenterFibBorder',color=color.new(#BCBCBC,50),linewidth=1),plot(cfl_2,title='2ndBottom-CenterFibBorder',color=color.new(#BCBCBC,50),linewidth=1),color=color.new(#BCBCBC,80),title='2ndRangingFibonacciZone@61.8%')//rangingzone
fill(plot(lf_2,title='2ndTop-LowFibBorder',color=color.new(#BCBCBC,50),linewidth=1),plot(ll_2,title='2ndBottom-LowFibBorder',color=color.new(#BCBCBC,50),linewidth=1),color=color.new(#BCBCBC,80),title='2ndDowntrendFibonacciZone@76.4%')//downtrendzone
//PlotTP
plot(strategy.position_size>0?take_profit_level:na,style=plot.style_linebr,color=color.green,linewidth=3,title="TakeProfitLevel")
//PlotAllSafetyOrderlinesexceptforlastoneasbrightblue
plot(strategy.position_size>0andcurrent_so<=max_safe_orderandcurrent_so>0?threshold:na,style=plot.style_linebr,color=color.new(#00ffff,0),linewidth=3,title="SafetyOrderline")
//PlotLastSafetyOrderLineasRed
plot(strategy.position_size>0andcurrent_so>max_safe_order?threshold:na,style=plot.style_linebr,color=color.red,linewidth=3,title="ZeroSafetyOrdersremainingline")
//PlotAveragePositionPriceLineasOrange
plot(strategy.position_size>0?strategy.position_avg_price:na,style=plot.style_linebr,color=color.orange,linewidth=3,title="AvgPositionPrice")
//FillTPAreaandSOArea
h1=plot(strategy.position_avg_price,color=color.new(#000000,100),title="AvgPricePlotArea",display=display.none,editable=false)
h2=plot(take_profit_level,color=color.new(#000000,100),title="TakeProfitPlotArea",display=display.none,editable=false)
h3=plot(threshold,color=color.new(#000000,100),title="SOPlotArea",display=display.none,editable=false)
//FillTPAreaandSOArea
fill(h1,h2,color=color.new(#38761d,80),title="TakeProfitPlotArea")
//CurrentSOArea
fill(h1,h3,color=color.new(#3d85c6,80),title="SOPlotArea")
//Thiswillremovetheextraneoussellsignalsbeforeweusethemtoplotwith
sell:=strategy.position_size>0?sell:false
//PlotHighlightforBuy/SellArrows
sessioncolor=ifhighlight_trades
switch
buy=>buy_color
sell=>sell_color
=>color(na)
bgcolor(sessioncolor,editable=false)
//SendBuyAlertto3Commasbot
ifbuy
alert(buy_message,alert.freq_once_per_bar_close)
buy:=false
//End:Plots-------------------------------------------------------------------
Expand (1006 lines)
