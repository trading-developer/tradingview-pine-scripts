Script Name: Nifty & BN 2 Candle Theory Back Testing and Alert Notification
Author: abdullabashaa
Description: How To Initiate Long Trade-in Index Future/ Buy Call Options – 3 Min TF

▪ If The Index Futures Trades Above The VWAP, the Following Parameters are Checked For 2 Candle Theory on the long side
▪ RSI Trades Above 50 & Between 50-75/80
▪ Volume Of 2 Consecutive Bars Is Above 50 K for BN & 125 K For Nifty
▪ All the indicators (Parabolic SAR, Super Trend, VMA, VWAP)...
PineScript code:

Pine Script™ strategy
Nifty & BN 2 Candle Theory Back Testing and Alert Notification
//  This  source  code  is  subject  to  the  terms  of  the  Mozilla  Public  License  2.0  at  https://mozilla.org/MPL/2.0/
//@version=5
//---------------------------//2  Candle  Theorey  +  Golden  Crossover\\------------------------------\\
strategy('2  Candle  Theorey  V2',  process_orders_on_close=true,  overlay  =  true)
//---------------------------------//Options\\---------------------------------\\
showsession  =  input.bool(defval=false,  title='',  inline='Session',  group='Timefilter')
session2  =  input.session(defval='1430-1000',  title='Session  Timings(to  avoid  trades)',inline='Session',group='Timefilter')
profitMultiplier=input.float(defval=2.0,minval=0.1,step=0.1,maxval=10.0,title='RisktoReward',group='MainSettings',tooltip='ModifyRisktoRewardforTakeProfit')
volumecutoff=input.float(defval=50000,minval=10000,step=1000,maxval=1000000,title='VolumeCutoff',tooltip='ModifyVolumeCutoffex:2CandleswithVolumeabove50kforEntryCondition',group='MainSettings')
showVolumeColor=input.bool(defval=true,title='',group='MainSettings',inline='Color')
colorvolumeColorInput=input.color(color.new(color.yellow,20),"ShowHighVolumeCandles",group='MainSettings',tooltip='ChangeCanldeColorforCandlesaboveVolumeCutoff',inline='Color')
varg_filter='FilterSettings'
emaFilter=input.int(title='EMAFilter',defval=0,group=g_filter,tooltip='EMAlengthtofiltertrades-settozerotodisable')
i_startTime=input.time(title='StartDateFilter',defval=timestamp('01Jan200013:30+0000'),group=g_filter,tooltip='Date&timetobegintradingfrom')
i_endTime=input.time(title='EndDateFilter',defval=timestamp('1Jan209919:30+0000'),group=g_filter,tooltip='Date&timetostoptrading')
//BacktesterSettings
varg_tester='BacktesterSettings'
startBalance=input.float(title='StartingBalance',defval=10000.0,group=g_tester,tooltip='Yourstartingbalanceforthecustominbuilttestersystem')
riskPerTrade=input.float(title='RiskPerTrade',defval=1.0,group=g_tester,tooltip='Yourdesired%riskpertrade(asawholenumber)')
drawTester=input.bool(title='DrawBacktester',defval=true,group=g_tester,tooltip='Turnon/offinbuiltbacktesterdisplay')
//-----------------------------//CustomFunctions\\---------------------------------\\

//Customfunctiontotruncate(cut)excessdecimalplaces
truncate(_number,_decimalPlaces)=>
_factor=math.pow(10,_decimalPlaces)
int(_number*_factor)/_factor
//---------------------------------//EMAFilter\\---------------------------------\\
ema=ta.ema(close,emaFilter==0?1:emaFilter)
//---------------------------------//RSICode\\---------------------------------\\
marsi(sourcersi,lengthrsi,typersi)=>
switchtypersi
"SMA"=>ta.sma(sourcersi,lengthrsi)
"BollingerBands"=>ta.sma(sourcersi,lengthrsi)
"EMA"=>ta.ema(sourcersi,lengthrsi)
"SMMA(RMA)"=>ta.rma(sourcersi,lengthrsi)
"WMA"=>ta.wma(sourcersi,lengthrsi)
"VWMA"=>ta.vwma(sourcersi,lengthrsi)
rsiLengthInput=input.int(14,minval=1,title="RSILength",group="RSISettings")
rsiSourceInput=input.source(close,"Source",group="RSISettings")
maTypeInput=input.string("SMA",title="MAType",options=["SMA","BollingerBands","EMA","SMMA(RMA)","WMA","VWMA"],group="RSISettings")
maLengthInput=input.int(14,title="MALength",group="RSISettings")
bbMultInput=input.float(2.0,minval=0.001,maxval=50,title="BBStdDev",group="RSISettings")
up0=ta.rma(math.max(ta.change(rsiSourceInput),0),rsiLengthInput)
down0=ta.rma(-math.min(ta.change(rsiSourceInput),0),rsiLengthInput)
rsi=down0==0?100:up0==0?0:100-(100/(1+up0/down0))
rsiMA=marsi(rsi,maLengthInput,maTypeInput)
isBB=maTypeInput=="BollingerBands"
//---------------------------------//PSARCode\\---------------------------------\\
start0=input(0.02)
increment0=input(0.02)
maximum0=input(0.2,"MaxValue")
out=ta.sar(start0,increment0,maximum0)
plot(out,"ParabolicSAR",style=plot.style_cross,color=#2962FF)
//---------------------------------//SupertrendCode\\---------------------------------\\
length=input(title='ATRPeriod',defval=10,group="SupertrendSettings")
mult=input.float(title='ATRMultiplier',step=0.1,defval=2,group="SupertrendSettings")
src=input(title='Source',defval=close,group="SupertrendSettings")
wicks=input(title='TakeWicksintoAccount?',defval=true,group="SupertrendSettings")
showLabels=input(title='ShowBuy/SellLabels?',defval=true,group="SupertrendSettings")
highlightState=input(title='HighlightState?',defval=true,group="SupertrendSettings")
atr=mult*ta.atr(length)
highPrice=wicks?high:close
lowPrice=wicks?low:close
doji4price=open==closeandopen==lowandopen==high
longStop=src-atr
longStopPrev=nz(longStop[1],longStop)
iflongStop>0
ifdoji4price
longStop:=longStopPrev
longStop
else
longStop:=lowPrice[1]>longStopPrev?math.max(longStop,longStopPrev):longStop
longStop
else
longStop:=longStopPrev
longStop
shortStop=src+atr
shortStopPrev=nz(shortStop[1],shortStop)
ifshortStop>0
ifdoji4price
shortStop:=shortStopPrev
shortStop
else
shortStop:=highPrice[1]<shortStopPrev?math.min(shortStop,shortStopPrev):shortStop
shortStop
else
shortStop:=shortStopPrev
shortStop
varintdir=1
dir:=dir==-1andhighPrice>shortStopPrev?1:dir==1andlowPrice<longStopPrev?-1:dir
varcolorlongColor=color.green
varcolorshortColor=color.red
longStopPlot=plot(dir==1?longStop:na,title='LongStop',style=plot.style_linebr,linewidth=2,color=color.new(longColor,0))
buySignal=dir==1anddir[1]==-1
plotshape(buySignal?longStop:na,title='LongStopStart',location=location.absolute,style=shape.circle,size=size.tiny,color=color.new(longColor,0))
//plotshape(buySignalandshowLabels?longStop:na,title='BuyLabel',text='Buy',location=location.absolute,style=shape.labelup,size=size.tiny,color=color.new(longColor,0),textcolor=color.new(color.white,0))
shortStopPlot=plot(dir==1?na:shortStop,title='ShortStop',style=plot.style_linebr,linewidth=2,color=color.new(shortColor,0))
sellSignal=dir==-1anddir[1]==1
//plotshape(sellSignal?shortStop:na,title='ShortStopStart',location=location.absolute,style=shape.circle,size=size.tiny,color=color.new(shortColor,0))
//plotshape(sellSignalandshowLabels?shortStop:na,title='SellLabel',text='Sell',location=location.absolute,style=shape.labeldown,size=size.tiny,color=color.new(shortColor,0),textcolor=color.new(color.white,0))
midPricePlot=plot(ohlc4,title='',style=plot.style_circles,linewidth=0,display=display.none,editable=false)
longFillColor=highlightState?dir==1?longColor:na:na
shortFillColor=highlightState?dir==-1?shortColor:na:na
//fill(midPricePlot,longStopPlot,title='LongStateFilling',color=longFillColor,transp=90)
//fill(midPricePlot,shortStopPlot,title='ShortStateFilling',color=shortFillColor,transp=90)
changeCond=dir!=dir[1]
//---------------------------------//VMACode\\---------------------------------\\
lenvma=input.int(20,"Length",minval=1,group="VMASettings")
srcvma=input(close,"Source",group="VMASettings")
mavma=ta.vwma(srcvma,lenvma)
offsetvma=input.int(0,"Offset",minval=-500,maxval=500,group="VMASettings")
plot(mavma,title="VWMA",color=#2962FF,offset=offsetvma)
//---------------------------------//VWAPCode\\---------------------------------\\
//Inputs
vwap_show=input(true,title='ShowVWAP',group="VWAPSettings")
vwapOffset=input(title='VWAPoffset',defval=0,group="VWAPSettings")
start=request.security(syminfo.tickerid,'D',time)
newSession=start>start[1]?1:0
vwapsum=0.0
volumesum=0.0
vwapsum:=newSession[1]?hlc3*volume:vwapsum[1]+hlc3*volume
volumesum:=newSession[1]?volume:volumesum[1]+volume
vwap_now=vwapsum/volumesum
plot(vwap_now,color=color.new(color.white,0),title='VWAP')
//---------------------------------//Logic\\---------------------------------\\
//CheckSessionstoavoidtrades
session=time('1',session2+string(':1234567'),str.tostring(syminfo.timezone))//'GMT+5:30')
sessioncond=showsession?notsession:true
//Seeifthisbar'stimehappenedwithindatefilter
dateFilter=time>=i_startTimeandtime<=i_endTime
//CheckEMAFilter
emaFilterLong=emaFilter==0orclose>ema
emaFilterShort=emaFilter==0orclose<ema
//CheckRSI
rsiFilterLong=rsi>50andrsi<=80
rsiFilterShort=rsi<40andrsi>=20
//CheckVWAP
vwapFilterLong=close>vwap_now
vwapFilterShort=close<vwap_now
//CheckSupertrend
supertrendFilterLong=close>longStop
supertrendFilterShort=close<shortStop
//CheckVMA
vmaFilterLong=close>mavma
vmaFilterShort=close<mavma
//CheckPSAR
psarFilterLong=close>out
psarFilterShort=close<out
//CheckVolume
volumeFilter=volume[1]>volumecutoffandvolume>volumecutoff//andbarColor==barColor[1]
volumeLongCond=close>openandclose[1]>open[1]
volumeShortCond=close<openandclose[1]<open[1]
volumeLongEntry=volumeFilterandvolumeLongCond
volumeShortEntry=volumeFilterandvolumeShortCond
//Determineifwehaveavalidsetup
validLongSetup=rsiFilterLongandvwapFilterLongandsupertrendFilterLongandvmaFilterLongandpsarFilterLongandvolumeFilterandvolumeLongCondandemaFilterLongandsessioncond
validShortSetup=rsiFilterShortandvwapFilterShortandsupertrendFilterShortandvmaFilterShortandpsarFilterShortandvolumeFilterandvolumeShortCondandemaFilterShortandsessioncond
//Checkifwehaveconfirmationforoursetup
validLongEntry=validLongSetupandstrategy.position_size==0anddateFilterandbarstate.isconfirmed
validShortEntry=validShortSetupandstrategy.position_size==0anddateFilterandbarstate.isconfirmed
//HighlightcandlesaboveVolumeCutoffiftrue
barcolor(showVolumeColor?volume>volumecutoff?volumeColorInput:na:na,title='BigVolumeCandles')

//---------------------------------//GoldenCrossCode\\---------------------------\\
//GoldenCrossConditions
supertrendCrossBull=ta.crossover(longStop,vwap_now)
supertrendCrossBear=ta.crossunder(shortStop,vwap_now)
vmaCrossBull=ta.crossover(mavma,vwap_now)
vmaCrossBear=ta.crossunder(mavma,vwap_now)
//GoldenCross
validGoldenCrossBullSetup=supertrendCrossBullandvmaCrossBullandvolumeLongEntryandrsiFilterLong//andvalidLongEntry
validGoldenCrossBearSetup=supertrendCrossBearandvmaCrossBearandvolumeShortEntryandrsiFilterShort//andvalidShortEntry
//---------------------------------//StrategyExecution\\-------------------------\\
floatsl=na
floattp=na
sl:=nz(sl[1],0.0)
tp:=nz(tp[1],0.0)
ifvalidLongEntryandstrategy.position_size<=0
strategy.entry('LongEntry',strategy.long,when=validLongEntry)
sl:=low[1]
sl
alert(message="2CandleTheoreyLongEntry",freq=alert.freq_once_per_bar_close)

ifvalidShortEntryandstrategy.position_size>=0
strategy.entry('ShortEntry',strategy.short,when=validShortEntry)
sl:=high[1]
sl
alert(message="2CandleTheoreyShortEntry",freq=alert.freq_once_per_bar_close)
ifvalidGoldenCrossBullSetupandstrategy.position_size<=0
strategy.entry('GoldenCrossLongEntry',strategy.long,when=validGoldenCrossBullSetup)
sl:=low[1]
sl
alert(message="GoldenCrossLongEntry",freq=alert.freq_once_per_bar_close)

ifvalidGoldenCrossBearSetupandstrategy.position_size>=0
strategy.entry('GoldenCrossShortEntry',strategy.short,when=validGoldenCrossBearSetup)
sl:=high[1]
sl
alert(message="GoldenCrossShortEntry",freq=alert.freq_once_per_bar_close)
ifsl!=0.0
ifstrategy.position_size>0
tp:=strategy.position_avg_price+(strategy.position_avg_price-sl)*profitMultiplier
strategy.exit(id='Exit',limit=tp,stop=sl)
ifstrategy.position_size<0
tp:=strategy.position_avg_price-(sl-strategy.position_avg_price)*profitMultiplier
strategy.exit(id='Exit',limit=tp,stop=sl)
//---------------------------------//Plots\\---------------------------------\\
//Drawtradedata
plot(validLongEntryorvalidShortEntry?sl:na,title='TradeStopPrice',color=color.new(color.red,0),style=plot.style_linebr)
plot(validLongEntryorvalidShortEntry?tp:na,title='TradeTargetPrice',color=color.new(color.green,0),style=plot.style_linebr)
//DrawEMAifit'senabled
plot(emaFilter==0?na:ema,color=emaFilterLong?color.green:color.red,linewidth=2,title='EMA')
//DrawGoldenCrossSetups
plotchar(validGoldenCrossBullSetup,"BullGoldenCross",'🚀',location.abovebar,offset=0,size=size.small)
plotchar(validGoldenCrossBearSetup,"BearGoldenCross",'🚀',location.belowbar,offset=0,size=size.small)
//---------------------------------//Dashbaord\\---------------------------------\\
//---BEGINTESTERCODE---//
//Declareperformancetrackingvariables
varbalance=startBalance
vardrawdown=0.0
varmaxDrawdown=0.0
varmaxBalance=0.0
vartotalPips=0.0
vartotalWins=0
vartotalLoss=0
//Detectwinningtrades
ifstrategy.wintrades!=strategy.wintrades[1]
balance+=riskPerTrade/100*balance*profitMultiplier
//totalPips+=math.abs(t_entry-t_target)
totalWins+=1
ifbalance>maxBalance
maxBalance:=balance
maxBalance
//Detectlosingtrades
ifstrategy.losstrades!=strategy.losstrades[1]
balance-=riskPerTrade/100*balance
//totalPips-=math.abs(t_entry-t_stop)
totalLoss+=1
//Updatedrawdown
drawdown:=balance/maxBalance-1
ifdrawdown<maxDrawdown
maxDrawdown:=drawdown
maxDrawdown

//ProfitFactorreturnsthestrategy'scurrentprofitfactor,
ProfitFactor=strategy.grossprofit/strategy.grossloss
maxloss=math.round(maxDrawdown*(-100))
winrate=(strategy.wintrades/strategy.closedtrades)*100
initbalance=startBalance
//Preparestatstable
vartabletestTable=table.new(position.bottom_right,5,3,border_width=1)
f_fillCell(_table,_column,_row,_title,_value,_bgcolor,_txtcolor)=>
_cellText=_title+'\n'+_value
table.cell(_table,_column,_row,_cellText,bgcolor=_bgcolor,text_color=_txtcolor)
//Drawstatstable
varbgcolor=color.new(color.black,0)
ifdrawTester
ifbarstate.islastconfirmedhistory
//Updatetable
dollarReturn=balance-startBalance
f_fillCell(testTable,0,0,'BacktesterbyEtherMatt',str.tostring(syminfo.tickerid),color.blue,color.white)
f_fillCell(testTable,0,1,'2CandleTheoryV2',str.tostring(timeframe.period)+'M',color.blue,color.white)
f_fillCell(testTable,1,0,'TotalTrades:',str.tostring(strategy.closedtrades),bgcolor,color.white)
f_fillCell(testTable,1,1,'WinRate:',str.tostring(truncate(winrate,2))+'%',winrate>40?color.green:color.red,color.white)//bgcolor,color.white)
f_fillCell(testTable,2,0,'Starting:','$'+str.tostring(startBalance),bgcolor,color.white)
f_fillCell(testTable,2,1,'Ending:','$'+str.tostring(truncate(balance,2)),balance>initbalance?color.green:color.red,color.white)
f_fillCell(testTable,3,0,'ProfitFactor:',str.tostring(truncate(ProfitFactor,2)),ProfitFactor>0?color.green:color.red,color.white)
f_fillCell(testTable,3,1,'Consec.Loss:',str.tostring(maxloss),maxloss<=5?color.green:color.red,color.white)//color.new(color.red,50),bgcolor,color.white)
f_fillCell(testTable,4,0,'Return:',(dollarReturn>0?'+':'')+str.tostring(truncate(dollarReturn/startBalance*100,2))+'%',dollarReturn>0?color.green:color.red,color.white)
f_fillCell(testTable,4,1,'MaxDD:',str.tostring(truncate(maxDrawdown*100,2))+'%',color.red,color.white)
Expand (343 lines)
