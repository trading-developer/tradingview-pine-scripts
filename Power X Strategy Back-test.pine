Script Name: Power X Strategy Back-test
Author: therealhaolu
Description: This script back-test the Power X Strategy developed by Markus Heitkoetter and Rockwell Trading. For more detail about the strategy, please refer to "The PowerX Strategy: How to Trade Stocks and Options in Only 15 Minutes a Day" written by Markus Heitkoetter. Note that this script is not publish, develop or maintain by Rockwell Trading, and may have different...
PineScript code:

Pine Scriptâ„¢ strategy
Power X Strategy Back-test
//  @version=4
//  Backtest  the  power  x  strategy.  The  power  x  strategy  is  develop  by  Markus  Heitkoetter  and  Rockwell  Trading.
//  This  scriptshowsthereturnforagivenstockforwiththedefineddaterangewithafixedcaptialof$10,000
strategy("PowerXTest",overlay=true,initial_capital=10000)
//#######################StartofUserInputs#######################
//FromDateInputs
fromDay=input(defval=30,title="FromDay",minval=1,maxval=31)
fromMonth=input(defval=8,title="FromMonth",minval=1,maxval=12)
fromYear=input(defval=2019,title="FromYear",minval=1970)

//ToDateInputs
toDay=input(defval=1,title="ToDay",minval=1,maxval=31)
toMonth=input(defval=1,title="ToMonth",minval=1,maxval=12)
toYear=input(defval=2021,title="ToYear",minval=1970)
//Calculatestart/enddateandtimecondition
startDate=timestamp(fromYear,fromMonth,fromDay,00,00)
finishDate=timestamp(toYear,toMonth,toDay,00,00)
time_cond=time>=startDateandtime<=finishDate
//Risk/RewardInputs
riskFactor=input(defval=1.5,title="risk",minval=0.1)
rewardFactor=input(defval=3.0,title="reward",minval=0.1)
risk=input(defval=100,title="acountrisk",minval=1,maxval=100)
//Daystoignoreduetospecailmarketconditon(ie.covid-19marketcrash)
//Calculatestart/endskipdateandtimecondition
ignore_skip=input(defval=true,title="Skip2020Crash")
startSkipDate=timestamp(2020,2,20,00,00)
finishSkipDate=timestamp(2020,3,26,00,00)
time_cond_skip=ignore_skip?time>=startSkipDateandtime<=finishSkipDate:false
//Gap-up2%rule
skip_gapup=input(defval=false,title="Skipstockthatopensx%higherthanopenprice")
gapPercent=input(defval=2,title="Maxopengap%",minval=0,maxval=10)/100+1

//#######################EndofUserInputs#######################
//#######################StartofIndicators#######################
[macdLine,signalLine,histLine]=macd(close,12,26,9)
rsiLine=rsi(close,7)
stochLine=sma(sma(stoch(close,high,low,14),3),3)
signal=macdLine>signalLineandrsiLine>50andstochLine>50?"buy":macdLine<=signalLineandrsiLine<=50andstochLine<=50?"sell":"none"
//Averagedailyrangefor7days
thishigh=security(syminfo.tickerid,'',high)
thislow=security(syminfo.tickerid,'',low)
length=7
adr=(sma(thishigh,length)-sma(thislow,length))
plotchar(adr,"ADR","")
//#######################EndofIndicators#######################
//Firstdaythestockchangedmomentum.
long=signal=="buy"andsignal[1]!="buy"
short=signal=="sell"andsignal[1]!="sell"
sideway=signal=="none"andsignal[1]!="none"
if(time_condandnottime_cond_skip)
//#######################StartofLongEntry#######################
//Calculatehowmanysharestobuybasedoncaptial
qty=round(strategy.initial_capital*risk/100/high)
//Note:TradingViewusesabrokeremulatorwhenrunningstrategies.Orderareonlyfilledonthenextbar.
//Enterlongonthedayafterfirstgreenbar
if(skip_gapup)
strategy.entry("Longentry",strategy.long,qty=qty,stop=high,limit=high*gapPercent,when=long)
else
strategy.entry("Longentry",strategy.long,qty=qty,stop=high,when=long)
strategy.cancel("Longentry",when=notlong)

//TODO:Improvethecrazyifstatments...
//Handlethecasewherefirstgreenhgihisreachedafter2ndgreen,upto5daysafter
if(notlongandsignal=="buy"andstrategy.opentrades==0)
//reachfirstgreenhigh5daysafterfirstgreen
if(signal[5]!="buy"andsignal[4]=="buy"andsignal[3]=="buy"andsignal[2]=="buy"andsignal[1]=="buy"andhigh[1]<high[4]andhigh[2]<high[4]andhigh[3]<high[4])
if(skip_gapup)
strategy.entry("Longentry",strategy.long,qty=strategy.initial_capital/high[4],stop=high[4],limit=high[4]*gapPercent)
else
strategy.entry("Longentry",strategy.long,qty=strategy.initial_capital/high[4],stop=high[4])
//reachfirstgreenhigh4daysafterfirstgreen
elseif(signal[4]!="buy"andsignal[3]=="buy"andsignal[2]=="buy"andsignal[1]=="buy"andhigh[1]<high[3]andhigh[2]<high[3])
if(skip_gapup)
strategy.entry("Longentry",strategy.long,qty=strategy.initial_capital/high[3],stop=high[3],limit=high[3]*gapPercent)
else
strategy.entry("Longentry",strategy.long,qty=strategy.initial_capital/high[3],stop=high[3])
//reachfirstgreenhigh3daysafterfirstgreen
elseif(signal[3]!="buy"andsignal[2]=="buy"andsignal[1]=="buy"andhigh[1]<high[2])
if(skip_gapup)
strategy.entry("Longentry",strategy.long,qty=strategy.initial_capital/high[2],stop=high[2],limit=high[2]*gapPercent)
else
strategy.entry("Longentry",strategy.long,qty=strategy.initial_capital/high[2],stop=high[2])
//reachfirstgreenhigh2daysafterfirstgreen
elseif(signal[2]!="buy"andsignal[1]=="buy")
if(skip_gapup)
strategy.entry("Longentry",strategy.long,qty=strategy.initial_capital/high[1],stop=high[1],limit=high[1]*gapPercent)
else
strategy.entry("Longentry",strategy.long,qty=strategy.initial_capital/high[1],stop=high[1])

//Exitwhenstoppedoutorhittedprofittarget
//Bracketorderforentry1dayafter1stgreen
if(signal=="buy"andsignal[1]=="buy"andsignal[2]!="buy")
long_stop_level=strategy.position_avg_price-(adr[1]*riskFactor)
long_profit_level=strategy.position_avg_price+(adr[1]*rewardFactor)
strategy.exit("TP/SL","Longentry",stop=long_stop_level,limit=long_profit_level)
//Bracketorderforentry2dayafter1stgreen
if(signal=="buy"andsignal[1]=="buy"andsignal[2]=="buy"andsignal[3]!="buy")
long_stop_level=strategy.position_avg_price-(adr[2]*riskFactor)
long_profit_level=strategy.position_avg_price+(adr[2]*rewardFactor)
strategy.exit("TP/SL","Longentry",stop=long_stop_level,limit=long_profit_level)
//Bracketorderforentry3dayafter1stgreen
if(signal=="buy"andsignal[1]=="buy"andsignal[2]=="buy"andsignal[3]=="buy"andsignal[4]!="buy")
long_stop_level=strategy.position_avg_price-(adr[3]*riskFactor)
long_profit_level=strategy.position_avg_price+(adr[3]*rewardFactor)
strategy.exit("TP/SL","Longentry",stop=long_stop_level,limit=long_profit_level)
//Bracketorderforentry4dayafter1stgreen
if(signal=="buy"andsignal[1]=="buy"andsignal[2]=="buy"andsignal[3]=="buy"andsignal[4]=="buy"andsignal[5]!="buy")
long_stop_level=strategy.position_avg_price-(adr[4]*riskFactor)
long_profit_level=strategy.position_avg_price+(adr[4]*rewardFactor)
strategy.exit("TP/SL","Longentry",stop=long_stop_level,limit=long_profit_level)
//Bracketorderforentry5dayafter1stgreen
if(signal=="buy"andsignal[1]=="buy"andsignal[2]=="buy"andsignal[3]=="buy"andsignal[4]=="buy"andsignal[5]=="buy"andsignal[6]!="buy")
long_stop_level=strategy.position_avg_price-(adr[5]*riskFactor)
long_profit_level=strategy.position_avg_price+(adr[5]*rewardFactor)
strategy.exit("TP/SL","Longentry",stop=long_stop_level,limit=long_profit_level)
//#######################EndofLongEntry#######################
//#######################StartofShortEntry#######################
//Entershortonthedayafterfirstredbar
qty_short=strategy.initial_capital/low
if(skip_gapup)
strategy.entry("Shortentry",strategy.short,qty=qty_short,stop=low,limit=low*(2-gapPercent),when=short)
else
strategy.entry("Shortentry",strategy.short,qty=qty_short,stop=low,when=short)
strategy.cancel("Shortentry",when=notshort)

//TODO:Improvethecrazyifstatments...
//Handlethecasewherefirstredlowisreachedafter2ndred,upto5daysafter
if(notshortandsignal=="sell"andstrategy.opentrades==0)
//reachfirstredlow5daysafter
if(signal[5]!="sell"andsignal[4]=="sell"andsignal[3]=="sell"andsignal[2]=="sell"andsignal[1]=="sell"andlow[1]>low[4]andlow[2]>low[4]andlow[3]>low[4])
if(skip_gapup)
strategy.entry("Shortentry",strategy.short,qty=strategy.initial_capital/low[4],stop=low[4],limit=low[4]*(2-gapPercent))
else
strategy.entry("Shortentry",strategy.short,qty=strategy.initial_capital/low[4],stop=low[4])
//reachfirstredlow4daysafter
if(signal[4]!="sell"andsignal[3]=="sell"andsignal[2]=="sell"andsignal[1]=="sell"andlow[1]>low[3]andlow[2]>low[3])
if(skip_gapup)
strategy.entry("Shortentry",strategy.short,qty=strategy.initial_capital/low[3],stop=low[3],limit=low[3]*(2-gapPercent))
else
strategy.entry("Shortentry",strategy.short,qty=strategy.initial_capital/low[3],stop=low[3])
//reachfirstredlow3daysafter
if(signal[3]!="sell"andsignal[2]=="sell"andsignal[1]=="sell"andlow[1]>low[2])
if(skip_gapup)
strategy.entry("Shortentry",strategy.short,qty=strategy.initial_capital/low[2],stop=low[2],limit=low[2]*(2-gapPercent))
else
strategy.entry("Shortentry",strategy.short,qty=strategy.initial_capital/low[2],stop=low[2])
//reachfirstredlow2daysafter
if(signal[2]!="sell"andsignal[1]=="sell")
if(skip_gapup)
strategy.entry("Shortentry",strategy.short,qty=strategy.initial_capital/low[1],stop=low[1],limit=low[1]*(2-gapPercent))
else
strategy.entry("Shortentry",strategy.short,qty=strategy.initial_capital/low[1],stop=low[1])

//Exitwhenstopoutorprofittargetishit
//Bracketorderforentry1dayafter1stred
if(signal=="sell"andsignal[1]=="sell"andsignal[2]!="sell")
long_stop_level=strategy.position_avg_price+(adr[1]*riskFactor)
long_profit_level=strategy.position_avg_price-(adr[1]*rewardFactor)
strategy.exit("TP/SL","Shortentry",stop=long_stop_level,limit=long_profit_level)
//Bracketorderforentry2dayafter1stred
if(signal=="sell"andsignal[1]=="sell"andsignal[2]=="sell"andsignal[3]!="sell")
long_stop_level=strategy.position_avg_price+(adr[2]*riskFactor)
long_profit_level=strategy.position_avg_price-(adr[2]*rewardFactor)
strategy.exit("TP/SL","Shortentry",stop=long_stop_level,limit=long_profit_level)
//Bracketorderforentry3dayafter1stred
if(signal=="sell"andsignal[1]=="sell"andsignal[2]=="sell"andsignal[3]=="sell"andsignal[4]!="sell")
long_stop_level=strategy.position_avg_price+(adr[3]*riskFactor)
long_profit_level=strategy.position_avg_price-(adr[3]*rewardFactor)
strategy.exit("TP/SL","Shortentry",stop=long_stop_level,limit=long_profit_level)
//Bracketorderforentry4dayafter1stred
if(signal=="sell"andsignal[1]=="sell"andsignal[2]=="sell"andsignal[3]=="sell"andsignal[4]=="sell"andsignal[5]!="sell")
long_stop_level=strategy.position_avg_price+(adr[4]*riskFactor)
long_profit_level=strategy.position_avg_price-(adr[4]*rewardFactor)
strategy.exit("TP/SL","Shortentry",stop=long_stop_level,limit=long_profit_level)
//Bracketorderforentry5dayafter1stred
if(signal=="sell"andsignal[1]=="sell"andsignal[2]=="sell"andsignal[3]=="sell"andsignal[4]=="sell"andsignal[5]=="sell"andsignal[6]!="sell")
long_stop_level=strategy.position_avg_price+(adr[5]*riskFactor)
long_profit_level=strategy.position_avg_price-(adr[5]*rewardFactor)
strategy.exit("TP/SL","Shortentry",stop=long_stop_level,limit=long_profit_level)
//#######################EndofShortEntry#######################
//Enxitthedayafterthetrendislost
if(time_condandsideway)
strategy.close("Longentry")
strategy.close("Shortentry")
//Closeanyopenorderoutsideofdaterange
if(nottime_cond)
strategy.close_all()
if(time_cond_skip)
strategy.close_all()
Expand (202 lines)
