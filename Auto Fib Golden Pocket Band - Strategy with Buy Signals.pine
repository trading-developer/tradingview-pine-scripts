Script Name: Auto Fib Golden Pocket Band - Strategy with Buy Signals
Author: imal_max
Description: this strategy is based on the Indicator "Auto Fib Golden Pocket Band - "Autofib Moving Average"
it's the same as the indicator but with:
- the strategy tester included
- several entry Signal filter
- Dynamic SL
PineScript code:

Pine Scriptâ„¢ strategy
Auto Fib Golden Pocket Band - Strategy with Buy Signals
//  This  source  code  is  subject  to  the  terms  of  the  Mozilla  Public  License  2.0  at  https://mozilla.org/MPL/2.0/
//  Â©  imal_max  reeee
//@version=5
strategy(title="Auto  Fib  Golden  Pocket  Band  -  Autofib  Moving  Average",  shorttitle="Auto  Fib  Golden  Pocket  Band",  overlay=true,  pyramiding=15,  process_orders_on_close=true,  calc_on_every_tick=true,  initial_capital=10000,  currency  =  currency.USD,  default_qty_value=100,  default_qty_type=strategy.percent_of_equity,  commission_type=strategy.commission.percent,  commission_value=0.05,  slippage=2)
//indicator("Auto  Fib  Golden  Pocket  Band  -  Autofib  Moving  Average",  overlay=true,  shorttitle="Auto  Fib  Golden  Pocket  Band",  timeframe""")
//  Fibs
//  auto  fib  ranges
//  fib  band  Strong  Trend
enable_StrongBand_Bull=input.bool(title='enableUpperBullishBand...FibLevel',defval=true,group='â•â•â•â•â•â•StrongTrendLevelsâ•â•â•â•â•â•',inline="0")
select_StrongBand_Fib_Bull=input.float(0.236,title="",options=[-0.272,0,0.236,0.382,0.5,0.618,0.702,0.71,0.786,0.83,0.886,1,1.272],group='â•â•â•â•â•â•StrongTrendLevelsâ•â•â•â•â•â•',inline="0")
enable_StrongBand_Bear=input.bool(title='enableLowerBearishBand...FibLevel',defval=false,group='â•â•â•â•â•â•StrongTrendLevelsâ•â•â•â•â•â•',inline="1")
select_StrongBand_Fib_Bear=input.float(0.382,'',options=[-0.272,0,0.236,0.382,0.5,0.618,0.702,0.71,0.786,0.83,0.886,1,1.272],group='â•â•â•â•â•â•StrongTrendLevelsâ•â•â•â•â•â•',inline="1")
StrongBand_Lookback=input.int(title='PivotLookBack',minval=1,defval=400,group='â•â•â•â•â•â•StrongTrendLevelsâ•â•â•â•â•â•',inline="2")
StrongBand_EmaLen=input.int(title='FibEMALength',minval=1,defval=120,group='â•â•â•â•â•â•StrongTrendLevelsâ•â•â•â•â•â•',inline="2")
//fibmiddleBandregularTrend
enable_MiddleBand_Bull=input.bool(title='enableMiddleBullishBand...FibLevel',defval=true,group='â•â•â•â•â•â•RegularTrendLevelsâ•â•â•â•â•â•',inline="0")
select_MiddleBand_Fib_Bull=input.float(0.618,'',options=[-0.272,0,0.236,0.382,0.5,0.6,0.618,0.702,0.71,0.786,0.83,0.886,1,1.272],group='â•â•â•â•â•â•RegularTrendLevelsâ•â•â•â•â•â•',inline="0")
enable_MiddleBand_Bear=input.bool(title='enableMiddleBearishBand...FibLevel',defval=true,group='â•â•â•â•â•â•RegularTrendLevelsâ•â•â•â•â•â•',inline="1")
select_MiddleBand_Fib_Bear=input.float(0.382,'',options=[-0.272,0,0.236,0.382,0.5,0.618,0.702,0.71,0.786,0.83,0.886,1,1.272],group='â•â•â•â•â•â•RegularTrendLevelsâ•â•â•â•â•â•',inline="1")
MiddleBand_Lookback=input.int(title='PivotLookBack',minval=1,defval=900,group='â•â•â•â•â•â•RegularTrendLevelsâ•â•â•â•â•â•',inline="2")
MiddleBand_EmaLen=input.int(title='FibEMALength',minval=1,defval=400,group='â•â•â•â•â•â•RegularTrendLevelsâ•â•â•â•â•â•',inline="2")
//fibSidewaysBand
enable_SidewaysBand_Bull=input.bool(title='enableLowerBullishBand...FibLevel',defval=true,group='â•â•â•â•â•â•SidewaysTrendLevelsâ•â•â•â•â•â•',inline="0")
select_SidewaysBand_Fib_Bull=input.float(0.6,'',options=[-0.272,0,0.236,0.382,0.5,0.6,0.618,0.702,0.71,0.786,0.83,0.886,1,1.272],group='â•â•â•â•â•â•SidewaysTrendLevelsâ•â•â•â•â•â•',inline="0")
enable_SidewaysBand_Bear=input.bool(title='enableUpperBearishBand...FibLevel',defval=true,group='â•â•â•â•â•â•SidewaysTrendLevelsâ•â•â•â•â•â•',inline="1")
select_SidewaysBand_Fib_Bear=input.float(0.5,'',options=[-0.272,0,0.236,0.382,0.5,0.618,0.702,0.71,0.786,0.83,0.886,1,1.272],group='â•â•â•â•â•â•SidewaysTrendLevelsâ•â•â•â•â•â•',inline="1")
SidewaysBand_Lookback=input.int(title='PivotLookBack',minval=1,defval=4000,group='â•â•â•â•â•â•SidewaysTrendLevelsâ•â•â•â•â•â•',inline="2")
SidewaysBand_EmaLen=input.int(title='FibEMALength',minval=1,defval=150,group='â•â•â•â•â•â•SidewaysTrendLevelsâ•â•â•â•â•â•',inline="2")
//StrongBand
isBelow_StrongBand_Bull=true
isBelow_StrongBand_Bear=true
StrongBand_Price_of_Low=float(na)
StrongBand_Price_of_High=float(na)
StrongBand_Bear_Fib_Price=float(na)
StrongBand_Bull_Fib_Price=float(na)
///MiddleBand
isBelow_MiddleBand_Bull=true
isBelow_MiddleBand_Bear=true
MiddleBand_Price_of_Low=float(na)
MiddleBand_Price_of_High=float(na)
MiddleBand_Bear_Fib_Price=float(na)
MiddleBand_Bull_Fib_Price=float(na)
//SidewaysBand
isBelow_SidewaysBand_Bull=true
isBelow_SidewaysBand_Bear=true
SidewaysBand_Price_of_Low=float(na)
SidewaysBand_Price_of_High=float(na)
SidewaysBand_Bear_Fib_Price=float(na)
SidewaysBand_Bull_Fib_Price=float(na)
//getFibLevels
ifenable_StrongBand_Bull
StrongBand_Price_of_High:=ta.highest(high,StrongBand_Lookback)
StrongBand_Price_of_Low:=ta.lowest(low,StrongBand_Lookback)
StrongBand_Bull_Fib_Price:=(StrongBand_Price_of_High-StrongBand_Price_of_Low)*(1-select_StrongBand_Fib_Bull)+StrongBand_Price_of_Low//+fibbullHighDivi
isBelow_StrongBand_Bull:=StrongBand_Bull_Fib_Price>ta.lowest(low,2)ornotenable_StrongBand_Bull
ifenable_StrongBand_Bear
StrongBand_Price_of_High:=ta.highest(high,StrongBand_Lookback)
StrongBand_Price_of_Low:=ta.lowest(low,StrongBand_Lookback)
StrongBand_Bear_Fib_Price:=(StrongBand_Price_of_High-StrongBand_Price_of_Low)*(1-select_StrongBand_Fib_Bear)+StrongBand_Price_of_Low//+fibbullLowhDivi
isBelow_StrongBand_Bear:=StrongBand_Bear_Fib_Price<ta.highest(low,2)ornotenable_StrongBand_Bear
ifenable_MiddleBand_Bull
MiddleBand_Price_of_High:=ta.highest(high,MiddleBand_Lookback)
MiddleBand_Price_of_Low:=ta.lowest(low,MiddleBand_Lookback)
MiddleBand_Bull_Fib_Price:=(MiddleBand_Price_of_High-MiddleBand_Price_of_Low)*(1-select_MiddleBand_Fib_Bull)+MiddleBand_Price_of_Low//+fibbullHighDivi
isBelow_MiddleBand_Bull:=MiddleBand_Bull_Fib_Price>ta.lowest(low,2)ornotenable_MiddleBand_Bull
ifenable_MiddleBand_Bear
MiddleBand_Price_of_High:=ta.highest(high,MiddleBand_Lookback)
MiddleBand_Price_of_Low:=ta.lowest(low,MiddleBand_Lookback)
MiddleBand_Bear_Fib_Price:=(MiddleBand_Price_of_High-MiddleBand_Price_of_Low)*(1-select_MiddleBand_Fib_Bear)+MiddleBand_Price_of_Low//+fibbullLowhDivi
isBelow_MiddleBand_Bear:=MiddleBand_Bear_Fib_Price<ta.highest(low,2)ornotenable_MiddleBand_Bear
ifenable_SidewaysBand_Bull
SidewaysBand_Price_of_High:=ta.highest(high,SidewaysBand_Lookback)
SidewaysBand_Price_of_Low:=ta.lowest(low,SidewaysBand_Lookback)
SidewaysBand_Bull_Fib_Price:=(SidewaysBand_Price_of_High-SidewaysBand_Price_of_Low)*(1-select_SidewaysBand_Fib_Bull)+SidewaysBand_Price_of_Low//+fibbullHighDivi
isBelow_SidewaysBand_Bull:=SidewaysBand_Bull_Fib_Price>ta.lowest(low,2)ornotenable_SidewaysBand_Bull
ifenable_SidewaysBand_Bear
SidewaysBand_Price_of_High:=ta.highest(high,SidewaysBand_Lookback)
SidewaysBand_Price_of_Low:=ta.lowest(low,SidewaysBand_Lookback)
SidewaysBand_Bear_Fib_Price:=(SidewaysBand_Price_of_High-SidewaysBand_Price_of_Low)*(1-select_SidewaysBand_Fib_Bear)+SidewaysBand_Price_of_Low//+fibbullLowhDivi
isBelow_SidewaysBand_Bear:=SidewaysBand_Bear_Fib_Price<ta.highest(low,2)ornotenable_SidewaysBand_Bear
//FibEMAs
//fibemaStrongTrend
StrongBand_current_Trend_EMA=float(na)
StrongBand_Bull_EMA=ta.ema(StrongBand_Bull_Fib_Price,StrongBand_EmaLen)
StrongBand_Bear_EMA=ta.ema(StrongBand_Bear_Fib_Price,StrongBand_EmaLen)
StrongBand_Ema_in_Uptrend=ta.change(StrongBand_Bull_EMA)>0orta.change(StrongBand_Bear_EMA)>0
StrongBand_Ema_Sideways=ta.change(StrongBand_Bull_EMA)==0orta.change(StrongBand_Bear_EMA)==0
StrongBand_Ema_in_Downtrend=ta.change(StrongBand_Bull_EMA)<0orta.change(StrongBand_Bear_EMA)<0
ifStrongBand_Ema_in_UptrendorStrongBand_Ema_Sideways
StrongBand_current_Trend_EMA:=StrongBand_Bull_EMA
ifStrongBand_Ema_in_Downtrend
StrongBand_current_Trend_EMA:=StrongBand_Bear_EMA
//fibemaNormalTrend
MiddleBand_current_Trend_EMA=float(na)
MiddleBand_Bull_EMA=ta.ema(MiddleBand_Bull_Fib_Price,MiddleBand_EmaLen)
MiddleBand_Bear_EMA=ta.ema(MiddleBand_Bear_Fib_Price,MiddleBand_EmaLen)
MiddleBand_Ema_in_Uptrend=ta.change(MiddleBand_Bull_EMA)>0orta.change(MiddleBand_Bear_EMA)>0
MiddleBand_Ema_Sideways=ta.change(MiddleBand_Bull_EMA)==0orta.change(MiddleBand_Bear_EMA)==0
MiddleBand_Ema_in_Downtrend=ta.change(MiddleBand_Bull_EMA)<0orta.change(MiddleBand_Bear_EMA)<0
ifMiddleBand_Ema_in_UptrendorMiddleBand_Ema_Sideways
MiddleBand_current_Trend_EMA:=MiddleBand_Bull_EMA
ifMiddleBand_Ema_in_Downtrend
MiddleBand_current_Trend_EMA:=MiddleBand_Bear_EMA
//fibemaSidewaysTrend
SidewaysBand_current_Trend_EMA=float(na)
SidewaysBand_Bull_EMA=ta.ema(SidewaysBand_Bull_Fib_Price,SidewaysBand_EmaLen)
SidewaysBand_Bear_EMA=ta.ema(SidewaysBand_Bear_Fib_Price,SidewaysBand_EmaLen)
SidewaysBand_Ema_in_Uptrend=ta.change(SidewaysBand_Bull_EMA)>0orta.change(SidewaysBand_Bear_EMA)>0
SidewaysBand_Ema_Sideways=ta.change(SidewaysBand_Bull_EMA)==0orta.change(SidewaysBand_Bear_EMA)==0
SidewaysBand_Ema_in_Downtrend=ta.change(SidewaysBand_Bull_EMA)<0orta.change(SidewaysBand_Bear_EMA)<0
ifSidewaysBand_Ema_in_UptrendorSidewaysBand_Ema_Sideways
SidewaysBand_current_Trend_EMA:=SidewaysBand_Bull_EMA
ifSidewaysBand_Ema_in_Downtrend
SidewaysBand_current_Trend_EMA:=SidewaysBand_Bear_EMA
//trendstatesandcolors
all_Fib_Emas_Trending=StrongBand_Ema_in_UptrendandMiddleBand_Ema_in_UptrendandSidewaysBand_Ema_in_Uptrend
all_Fib_Emas_Downtrend=MiddleBand_Ema_in_DowntrendandStrongBand_Ema_in_DowntrendandSidewaysBand_Ema_in_Downtrend
all_Fib_Emas_Sideways=MiddleBand_Ema_SidewaysandStrongBand_Ema_SidewaysandSidewaysBand_Ema_Sideways
all_Fib_Emas_Trend_or_Sideways=(MiddleBand_Ema_SidewaysorStrongBand_Ema_SidewaysorSidewaysBand_Ema_Sideways)or(StrongBand_Ema_in_UptrendorMiddleBand_Ema_in_UptrendorSidewaysBand_Ema_in_Uptrend)andnot(MiddleBand_Ema_in_DowntrendorStrongBand_Ema_in_DowntrendorSidewaysBand_Ema_in_Downtrend)
allFibsUpAndDownTrend=(MiddleBand_Ema_in_DowntrendorStrongBand_Ema_in_DowntrendorSidewaysBand_Ema_in_Downtrend)and(MiddleBand_Ema_SidewaysorSidewaysBand_Ema_SidewaysorStrongBand_Ema_SidewaysorStrongBand_Ema_in_UptrendorMiddleBand_Ema_in_UptrendorSidewaysBand_Ema_in_Uptrend)
Middle_and_Sideways_Emas_Trending=MiddleBand_Ema_in_UptrendandSidewaysBand_Ema_in_Uptrend
Middle_and_Sideways_Fib_Emas_Downtrend=MiddleBand_Ema_in_DowntrendandSidewaysBand_Ema_in_Downtrend
Middle_and_Sideways_Fib_Emas_Sideways=MiddleBand_Ema_SidewaysandSidewaysBand_Ema_Sideways
Middle_and_Sideways_Fib_Emas_Trend_or_Sideways=(MiddleBand_Ema_SidewaysorSidewaysBand_Ema_Sideways)or(MiddleBand_Ema_in_UptrendorSidewaysBand_Ema_in_Uptrend)andnot(MiddleBand_Ema_in_DowntrendorSidewaysBand_Ema_in_Downtrend)
Middle_and_Sideways_UpAndDownTrend=(MiddleBand_Ema_in_DowntrendorSidewaysBand_Ema_in_Downtrend)and(MiddleBand_Ema_SidewaysorSidewaysBand_Ema_SidewaysorMiddleBand_Ema_in_UptrendorSidewaysBand_Ema_in_Uptrend)
UpperBand_Ema_Color=all_Fib_Emas_Trend_or_Sideways?color.lime:all_Fib_Emas_Downtrend?color.red:allFibsUpAndDownTrend?color.white:na
MiddleBand_Ema_Color=Middle_and_Sideways_Fib_Emas_Trend_or_Sideways?color.lime:Middle_and_Sideways_Fib_Emas_Downtrend?color.red:Middle_and_Sideways_UpAndDownTrend?color.white:na
SidewaysBand_Ema_Color=SidewaysBand_Ema_in_Uptrend?color.lime:SidewaysBand_Ema_in_Downtrend?color.red:(SidewaysBand_Ema_in_Downtrendand(SidewaysBand_Ema_SidewaysorSidewaysBand_Ema_in_Uptrend))?color.white:na
plotStrong_Ema=plot(StrongBand_current_Trend_EMA,color=UpperBand_Ema_Color,title="StrongTrend")
plotMiddle_Ema=plot(MiddleBand_current_Trend_EMA,color=MiddleBand_Ema_Color,title="NormalTrend")
plotSideways_Ema=plot(SidewaysBand_current_Trend_EMA,color=SidewaysBand_Ema_Color,title="Sidewaysd")
Strong_Middle_fillcolor=color.new(color.green,90)
ifall_Fib_Emas_Trend_or_Sideways
Strong_Middle_fillcolor:=color.new(color.green,90)
ifall_Fib_Emas_Downtrend
Strong_Middle_fillcolor:=color.new(color.red,90)

ifallFibsUpAndDownTrend
Strong_Middle_fillcolor:=color.new(color.white,90)
Middle_Sideways_fillcolor=color.new(color.green,90)
ifMiddle_and_Sideways_Fib_Emas_Trend_or_Sideways
Middle_Sideways_fillcolor:=color.new(color.green,90)
ifMiddle_and_Sideways_Fib_Emas_Downtrend
Middle_Sideways_fillcolor:=color.new(color.red,90)

ifMiddle_and_Sideways_UpAndDownTrend
Middle_Sideways_fillcolor:=color.new(color.white,90)
fill(plotStrong_Ema,plotMiddle_Ema,color=Strong_Middle_fillcolor,title="fibbandbackground")
fill(plotMiddle_Ema,plotSideways_Ema,color=Middle_Sideways_fillcolor,title="fibbandbackground")
//buycondition
StrongBand_Price_was_below_Bull_level=ta.lowest(low,1)<StrongBand_current_Trend_EMA
StrongBand_Price_is_above_Bull_level=close>StrongBand_current_Trend_EMA
StronBand_Price_Average_above_Bull_Level=ta.ema(low,10)>StrongBand_current_Trend_EMA
StrongBand_Low_isnt_toLow=(ta.lowest(StrongBand_current_Trend_EMA,15)-ta.lowest(low,15))<close*0.005
StronBand_Trend_isnt_fresh=ta.barssince(StrongBand_Ema_in_Downtrend)>50orna(ta.barssince(StrongBand_Ema_in_Downtrend))
MiddleBand_Price_was_below_Bull_level=ta.lowest(low,1)<MiddleBand_current_Trend_EMA
MiddleBand_Price_is_above_Bull_level=close>MiddleBand_current_Trend_EMA
MiddleBand_Price_Average_above_Bull_Level=ta.ema(close,20)>MiddleBand_current_Trend_EMA
MiddleBand_Low_isnt_toLow=(ta.lowest(MiddleBand_current_Trend_EMA,10)-ta.lowest(low,10))<close*0.0065
MiddleBand_Trend_isnt_fresh=ta.barssince(MiddleBand_Ema_in_Downtrend)>50orna(ta.barssince(MiddleBand_Ema_in_Downtrend))
SidewaysBand_Price_was_below_Bull_level=ta.lowest(low,1)<SidewaysBand_current_Trend_EMA
SidewaysBand_Price_is_above_Bull_level=close>SidewaysBand_current_Trend_EMA
SidewaysBand_Price_Average_above_Bull_Level=ta.ema(low,80)>SidewaysBand_current_Trend_EMA
SidewaysBand_Low_isnt_toLow=(ta.lowest(SidewaysBand_current_Trend_EMA,150)-ta.lowest(low,150))<close*0.0065
SidewaysBand_Trend_isnt_fresh=ta.barssince(SidewaysBand_Ema_in_Downtrend)>50orna(ta.barssince(SidewaysBand_Ema_in_Downtrend))
StrongBand_Buy_Alert=StronBand_Trend_isnt_freshandStrongBand_Low_isnt_toLowandStronBand_Price_Average_above_Bull_LevelandStrongBand_Price_was_below_Bull_levelandStrongBand_Price_is_above_Bull_levelandall_Fib_Emas_Trend_or_Sideways
MiddleBand_Buy_Alert=MiddleBand_Trend_isnt_freshandMiddleBand_Low_isnt_toLowandMiddleBand_Price_Average_above_Bull_LevelandMiddleBand_Price_was_below_Bull_levelandMiddleBand_Price_is_above_Bull_levelandMiddle_and_Sideways_Fib_Emas_Trend_or_Sideways
SidewaysBand_Buy_Alert=SidewaysBand_Trend_isnt_freshandSidewaysBand_Low_isnt_toLowandSidewaysBand_Price_Average_above_Bull_LevelandSidewaysBand_Price_was_below_Bull_levelandSidewaysBand_Price_is_above_Bull_leveland(SidewaysBand_Ema_SidewaysorSidewaysBand_Ema_in_Uptrendand(notSidewaysBand_Ema_in_Downtrend))
//Sellcondition
StrongBand_Price_was_above_Bear_level=ta.highest(high,1)>StrongBand_current_Trend_EMA
StrongBand_Price_is_below_Bear_level=close<StrongBand_current_Trend_EMA
StronBand_Price_Average_below_Bear_Level=ta.sma(high,10)<StrongBand_current_Trend_EMA
StrongBand_High_isnt_to_High=(ta.highest(high,15)-ta.highest(StrongBand_current_Trend_EMA,15))<close*0.005
StrongBand_Bear_Trend_isnt_fresh=ta.barssince(StrongBand_Ema_in_Uptrend)>50
MiddleBand_Price_was_above_Bear_level=ta.highest(high,1)>MiddleBand_current_Trend_EMA
MiddleBand_Price_is_below_Bear_level=close<MiddleBand_current_Trend_EMA
MiddleBand_Price_Average_below_Bear_Level=ta.sma(high,9)<MiddleBand_current_Trend_EMA
MiddleBand_High_isnt_to_High=(ta.highest(high,10)-ta.highest(MiddleBand_current_Trend_EMA,10))<close*0.0065
MiddleBand_Bear_Trend_isnt_fresh=ta.barssince(MiddleBand_Ema_in_Uptrend)>50
SidewaysBand_Price_was_above_Bear_level=ta.highest(high,1)>SidewaysBand_current_Trend_EMA
SidewaysBand_Price_is_below_Bear_level=close<SidewaysBand_current_Trend_EMA
SidewaysBand_Price_Average_below_Bear_Level=ta.sma(high,20)<SidewaysBand_current_Trend_EMA
SidewaysBand_High_isnt_to_High=(ta.highest(high,20)-ta.highest(SidewaysBand_current_Trend_EMA,15))<close*0.0065
SidewaysBand_Bear_Trend_isnt_fresh=ta.barssince(SidewaysBand_Ema_in_Uptrend)>50
StrongBand_Sell_Alert=StronBand_Price_Average_below_Bear_LevelandStrongBand_High_isnt_to_HighandStrongBand_Bear_Trend_isnt_freshandStrongBand_Price_was_above_Bear_levelandStrongBand_Price_is_below_Bear_levelandall_Fib_Emas_Downtrendandnotall_Fib_Emas_Trend_or_Sideways
MiddleBand_Sell_Alert=MiddleBand_Price_Average_below_Bear_LevelandMiddleBand_High_isnt_to_HighandMiddleBand_Bear_Trend_isnt_freshandMiddleBand_Price_was_above_Bear_levelandMiddleBand_Price_is_below_Bear_levelandMiddle_and_Sideways_Fib_Emas_DowntrendandnotMiddle_and_Sideways_Fib_Emas_Trend_or_Sideways
SidewaysBand_Sell_Alert=SidewaysBand_Price_Average_below_Bear_LevelandSidewaysBand_High_isnt_to_HighandSidewaysBand_Bear_Trend_isnt_freshandSidewaysBand_Price_was_above_Bear_levelandSidewaysBand_Price_is_below_Bear_levelandSidewaysBand_Ema_in_Downtrendandnot(SidewaysBand_Ema_SidewaysorSidewaysBand_Ema_in_Uptrendand(notSidewaysBand_Ema_in_Downtrend))
//Backtester
//////////////////StopLoss
//Stoploss
enableSL=input.bool(true,title='enableStopLoss',group='â•â•â•â•â•â•â•â•â•â•StopLossSettingsâ•â•â•â•â•â•â•â•â•â•')
whichSL=input.string(defval='low/highasSL',title='SLbasedonstatic%orbasedonthelow/high',options=['low/highasSL','static%asSL'],group='â•â•â•â•â•â•â•â•â•â•StopLossSettingsâ•â•â•â•â•â•â•â•â•â•')
whichOffset=input.string(defval='%asoffset',title='chooseoffsetfromthelow/high',options=['$asoffset','%asoffset'],group='StopLossatthelow/high')
lowPBuffer=input.float(1.4,title='SLOffsetfromtheLow/highin%',group='StopLossatthelow/high')/100
lowDBuffer=input.float(100,title='SLOffsetfromtheLow/highin$',group='StopLossatthelow/high')
SlLowLookback=input.int(title='SLlookbackforLow/high',defval=5,minval=1,maxval=50,group='StopLossatthelow/high')
longSlLow=float(na)
shortSlLow=float(na)
ifwhichOffset=="%asoffset"andwhichSL=="low/highasSL"andenableSL
longSlLow:=ta.lowest(low,SlLowLookback)*(1-lowPBuffer)
shortSlLow:=ta.highest(high,SlLowLookback)*(1+lowPBuffer)
ifwhichOffset=="$asoffset"andwhichSL=="low/highasSL"andenableSL
longSlLow:=ta.lowest(low,SlLowLookback)-lowDBuffer
shortSlLow:=ta.highest(high,SlLowLookback)+lowDBuffer
//plot(shortSlLow,title="stoploss",color=color.new(#00bcd4,0))
//longsettings-ðŸ”¥uncommentthe6linesbelowtodisablethealertsandenablethebacktester
longStopLoss=input.float(0.5,title='LongStopLossin%',group='static%StopLoss',inline='Input1')/100
//shortsettings-ðŸ”¥uncommentthe6linesbelowtodisablethealertsandenablethebacktester
shortStopLoss=input.float(0.5,title='ShortStopLossin%',group='static%StopLoss',inline='Input1')/100
///////Takeprofit
longTakeProfit1=input.float(4,title='LongTakeProfitin%',group='TakeProfit',inline='Input1')/100
///////Takeprofit
shortTakeProfit1=input.float(1.6,title='ShortTakeProfitin%',group='TakeProfit',inline='Input1')/100
//////////////////SLTPEND
///////////////////alerts
selectalertFreq=input.string(defval='onceperbarclose',title='AlertOptions',options=['onceperbar','onceperbarclose','all'],group='â•â•â•â•â•â•â•â•â•â•â•alertsettingsâ•â•â•â•â•â•â•â•â•â•â•')
BuyAlertMessage=input.string(defval="BullishDivergencedetected,putyourSL@",title='BuyAlertMessage',group='â•â•â•â•â•â•â•â•â•â•â•alertsettingsâ•â•â•â•â•â•â•â•â•â•â•')
enableSlMessage=input.bool(true,title='enableStopLossValueattheendof"buyAlertmessage"',group='â•â•â•â•â•â•â•â•â•â•â•alertsettingsâ•â•â•â•â•â•â•â•â•â•â•')
AfterSLMessage=input.string(defval="",title='BuyAlertmessageafterSLValue',group='â•â•â•â•â•â•â•â•â•â•â•alertsettingsâ•â•â•â•â•â•â•â•â•â•â•')

//////////////////Backtester
//ðŸ”¥uncommentthealllinesbelowforthebacktesterandrevertforalerts
shortTrading=enable_MiddleBand_Bearorenable_StrongBand_Bearorenable_SidewaysBand_Bear
longTrading=enable_StrongBand_Bullorenable_MiddleBand_Bullorenable_SidewaysBand_Bull
longTP1=strategy.position_size>0?strategy.position_avg_price*(1+longTakeProfit1):strategy.position_size<0?strategy.position_avg_price*(1-longTakeProfit1):na
longSL=strategy.position_size>0?strategy.position_avg_price*(1-longStopLoss):strategy.position_size<0?strategy.position_avg_price*(1+longStopLoss):na
shortTP=strategy.position_size>0?strategy.position_avg_price*(1+shortTakeProfit1):strategy.position_size<0?strategy.position_avg_price*(1-shortTakeProfit1):na
shortSL=strategy.position_size>0?strategy.position_avg_price*(1-shortStopLoss):strategy.position_size<0?strategy.position_avg_price*(1+shortStopLoss):na
strategy.risk.allow_entry_in(longTrading==trueandshortTrading==true?strategy.direction.all:longTrading==true?strategy.direction.long:shortTrading==true?strategy.direction.short:na)
strategy.entry('Bull',strategy.long,comment='UpperBandLong',when=StrongBand_Buy_Alert)
strategy.entry('Bull',strategy.long,comment='LowerBandLong',when=MiddleBand_Buy_Alert)
strategy.entry('Bull',strategy.long,comment='LowerBandLong',when=SidewaysBand_Buy_Alert)
strategy.entry('Bear',strategy.short,comment='UpperBandShort',when=StrongBand_Sell_Alert)
strategy.entry('Bear',strategy.short,comment='LowerBandShort',when=MiddleBand_Sell_Alert)
strategy.entry('Bear',strategy.short,comment='LowerBandShort',when=SidewaysBand_Sell_Alert)
//checkwhichSLtouse
ifenableSLandwhichSL=='static%asSL'
strategy.exit(id='longTP-SL',from_entry='Bull',limit=longTP1,stop=longSL)
strategy.exit(id='shortTP-SL',from_entry='Bear',limit=shortTP,stop=shortSL)
//getbarssincelastentryfortheSLatlowtowork
barsSinceLastEntry()=>
strategy.opentrades>0?(bar_index-strategy.opentrades.entry_bar_index(strategy.opentrades-1)):na

ifenableSLandwhichSL=='low/highasSL'andta.barssince(StrongBand_Buy_AlertorMiddleBand_Buy_AlertorSidewaysBand_Buy_Alert)<2andbarsSinceLastEntry()<2
strategy.exit(id='longTP-SL',from_entry='Bull',limit=longTP1,stop=longSlLow)
ifenableSLandwhichSL=='low/highasSL'andta.barssince(StrongBand_Sell_AlertorMiddleBand_Sell_AlertorSidewaysBand_Sell_Alert)<2andbarsSinceLastEntry()<2
strategy.exit(id='shortTP-SL',from_entry='Bear',limit=shortTP,stop=shortSlLow)
ifnotenableSL
strategy.exit(id='longTP-SL',from_entry='Bull',limit=longTP1)
strategy.exit(id='shortTP-SL',from_entry='Bear',limit=shortTP)
Expand (382 lines)
