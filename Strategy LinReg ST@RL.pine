Script Name: Strategy LinReg ST@RL
Author: RegisL76
Description: Strategy LinReg ST@RL

Strategy LinReg ST@RL is a visual trend following indicator.
 It is compiled in PINE Script Version V5 language.

This indicator/strategy, based on Linear Regression Calculation, is intended to help beginners (and also the more experienced ones) to trade in the right direction of the market trend and test strategy. It allows you to avoid...
PineScript code:

Pine Script™ strategy
Strategy LinReg ST@RL
//  This  Source  code  is  subject  to  the  terms  of  the  Mozilla  Public  License  2.0  at  https://mozilla.org/MPL/2.0/
//  ©  RegisL76
//  strategy  based  on  an  original  idea  of  @KivancOzbilgic  (SuperTrend)  and  DevLucem  (@LucemAnb)  (Lin  Reg  ++)                                                                    //
//  TradingView  version  :  a  special  credit  goes  to  -  KivancOzbilgic  and  @LucemAnb  which  inspired  me  a  lot  to  improve  this  indicator/Strategy.  //
//  ********************  //
//  ©  RegisL76  //
//  V  1780.0
//  ********************  //
//  V1.0  publiée  27/03/2022  (v845)
//  V2.0  publiée  03/04/2022  (v921)
//  V3.0  publiée  06/04/2022  (v927)
//  V4.0  publiée  04/05/2022  (v938)
//  V5.0  publiée  20/04/2023  (v1574)
//  V6.0  publiée  28/06/2023  (v1780)
//  TradingView  Pine  V5  //
//@version=5
//  TradingView  Pine  V5  //

//  ***********************************************************************************************************************************************************************************************************  //
//  *********************************************  Parametres  Par  Defaut  Optimisés  Pour  BTC/USDT  Perp  Binance  TF=  1m  3m  5m  15m  30m  H1  H2  H3  H4  Daily  Weekly    ***************************************************  //
//  ***********************************************************************************************************************************************************************************************************  //
strategy('Strategy  LinReg  ST@RL',shorttitle='LinRegST@RL',  overlay=true,  margin_long=70,margin_short=70,commission_value=0.04,
  default_qty_value=80,initial_capital=1000,default_qty_type=  strategy.percent_of_equity,  currency=currency.USD,pyramiding=0,
  calc_on_order_fills=false,calc_on_every_tick=false,process_orders_on_close=false,max_labels_count=500,max_lines_count=500,max_bars_back=0)
//  ******************************************************************************************************************************************  //
//                                                                              Parametres  par  defaut  pour  BTC/USDT  Perp  Binance  TF=H1                                                                                              //
//  ***************************************************  LINEAR  REGRESSION  INPUTS  *************************************************************  //
THANKS                    =  input.string('THANKS  i  -->>',  tooltip=
  'If  you  use  this  strategy  and  you  are  satisfied  with  the  trading  results,\n  you  may  donate  to  me  via  paypal  to  lebourg.regis@free.fr\n  Thanks  in  advance  !!!\n  Have  good  winning  trades  and  enjoy  !'
  ,                                                                                                                                                                                                                              confirm=true,  group='CONFIRMATION  NEEDED')
CONFIG  =  input.string('CONFIG-->>',tooltip='MEMO  -->>'
  +'\nDef  BTCUSDT  Perp  :  Low  -    ??    -    ??  -  ??  -    ??  -  REGULAR  :  ALL  TF  !'
  +'\n---------------------------------------------------------------'
  +'\n1m    BTCUSDT  Perp  :  Low  -  115  -  3  -  3.3    -  1  -  REGULAR'
  +'\n3m    BTCUSDT  Perp  :  Low  -  142  -  0  -  3.9    -  1  -  REGULAR'
  +'\n5m    BTCUSDT  Perp  :  Low  -  169  -  1  -  2.3    -  1  -  REGULAR'
  +'\n15m  BTCUSDT  Perp  :  Low  -  167  -  0  -  0.6    -  6  -  REGULAR'
  +'\n30m  BTCUSDT  Perp  :  Low  -  115  -  2  -  0.9    -  7  -  REGULAR'
  +'\nH1    BTCUSDT  Perp  :  Low  -  196  -  3  -  2.2    -  1  -  REGULAR'
  +'\nH2    BTCUSDT  Perp  :  Low  -    70  -  7  -  2.2    -  3  -  REGULAR'
  +'\nH3    BTCUSDT  Perp  :  Low  -    75  -  2  -  2.0    -  3  -  REGULAR'
  +'\nH4    BTCUSDT  Perp  :  Low  -    23  -  2  -  1.6    -  4  -  REGULAR'
  +'\nD      BTCUSDT  Perp  :  Low  -    52  -  2  -  1.7    -  9  -  REGULAR'
  +'\nW      BTCUSDT  Perp  :  Low  -    14  -  0  -  0.7    -  5  -  REGULAR'
  +'\nONLY  FOR  :  '
  +'\n1m  3m  5m  15m  30m  H2  H3  H4  DAILY  WEEKLY'
  +'\nIF  "CONF  AUTO"',                                                                                                                                                                                          confirm=true,  group='CONFIRMATION  NEEDED')
NOTA                        =  input.string('READ  i  -->>',tooltip='Inputs  Marked  With  *  Influence  The  Result  Of  The  Stategy  !',confirm=true,  group='CONFIRMATION  NEEDED')
//  ***********************************************************************************************************************  //
buy_only                =  input              (false,  'BUY  ONLY*',                                                                                                            tooltip  ='[Buy  only]  &  [Sell  only]  both  checked  or  both  unchecked  =  [BUY  +  SELL]'
  ,                                                                                                                                                                                                            group='For  All  TF',                                                                                                      inline='ALLTF')

sell_only              =  input              (false,  'SELL  ONLY*',                                                                                                          tooltip  ='[Buy  only]  &  [Sell  only]  both  checked  or  both  unchecked  =  [BUY  +  SELL]'
  ,                                                                                                                                                                                                            group='For  All  TF',                                                                                                      inline='ALLTF')
//  ****************************************************  STOP  LOSS  Inputs  *************************************************  //
sl1                          =  input.float  (1.5,  'STOP  LOSS*    %  '                              ,  minval=0.2,maxval=10,step=0.05,        tooltip='Stop  Loss  :  0  to  10  %  of  Position  Size,  100%  with  X10  [Default  Value  For  All  TimeFrame]'
  ,                                                                                                                                                                                                            group='For  All  TF')

slX10                      =  input.bool    (true,'STOP  LOSS*    X  10',                                                                                                  tooltip='Stop  Loss  X10  Multiplier'
  ,                                                                                                                                                                                                            group='For  All  TF',                                                                                                        inline='SL')

no_sl                      =  input.bool    (false,'DISABLE*  STOP  LOSS',                                                                                            tooltip='Checked=Disable  Exit  by  Stop  Loss'
  ,                                                                                                                                                                                                            group='For  All  TF')
//  ****************************************************  TAKE  PROFIT  Inputs  ***********************************************  //
tp1                          =  input.float  (4.35,  'TAKE  PROFIT*    %  '                          ,minval=0.2,maxval=10,step=0.05,        tooltip='Take  Profit  :  0  to  10  %  of  Position  Size,  100%  with  X10  [Default  Value  For  All  TimeFrame]'
  ,                                                                                                                                                                                                            group='For  All  TF')

tpX10                      =  input.bool    (true,'TAKE  PROFIT*    X  10',                                                                                              tooltip='Take  Profit  X10  Multiplier'
  ,                                                                                                                                                                                                            group='For  All  TF',                                                                                                          inline='TP')

no_tp                      =  input.bool    (false,'DISABLE*  TAKE  PROFIT',                                                                                        tooltip='Checked=Disable  Exit  by  Take  Profit'
  ,                                                                                                                                                                                                            group='For  All  TF')
//  ****************************************************  DISPLAY  Inputs  ***************************************************  //
line_thick            =  input.int      (2,          'Line  LR  Thickness',                                        minval=1,  maxval=4,              group='COMMON  INPUTS  DISPLAY',                                                                                    inline='LR')
signals                  =  input.string('All',  'Line  LR  Signals  Display',  options=['All','Last  500  Bars'],              group='COMMON  INPUTS  DISPLAY',                                                                                    inline='LR')
color_up                =  input.color  (color.new(#82fc00,0),'Up  Color'    ,                                                                          group='COMMON  INPUTS  DISPLAY',                                                                                    inline='COLOR')
color_down            =  input.color  (color.new(#ff0000,0),'Down  Color',                                  group='COMMONINPUTSDISPLAY',inline='COLOR')
y_Pos_factor=input.float(3.0,'LabelYPositionFactor',minval=0.0,maxval=20.0,step=0.25,group='COMMONINPUTSDISPLAY')
show_trade_info=input(true,'ShowTradeInfos',
tooltip='DisplayOrNotTheTradeInfosLabel',group='COMMONINPUTSDISPLAY',inline='INFO')
show_full_info=input(false,'ShowFullInfosLabel',
tooltip='DisplayFullOrSimpleTradeInfosLabel',group='COMMONINPUTSDISPLAY',inline='INFO')

barscolors=input(true,'TrendBarsColors',
tooltip='DisplaysOrNotTheColorOfTheCandlesAccordingToTheTrendOfTheStrategy,InsteadOfTheStandardColors'
,group='COMMONINPUTSDISPLAY',inline='INFO')

trans_Col_bg=input.float(88,'TrendBackgroundTransparency',minval=86,maxval=90,step=1,group='COMMONINPUTSDISPLAY')
show_sl_line=input.bool(true,'ShowSLLine',group='COMMONINPUTSDISPLAY',inline='SL-TP')
show_tp_line=input.bool(true,'ShowTPLine',tooltip='ShowTP/SLLines&Backgrounds',group='COMMONINPUTSDISPLAY',inline='SL-TP')
showIntermedSignal=input.bool(true,'ShowintermediateSignals',tooltip='ShowintermediateSignals',group='ALERTMESSAGES')
showBuySignal=input.bool(true,'ShowBuySignals',tooltip='ShowBuySignals',group='ALERTMESSAGES')
showSellSignal=input.bool(true,'ShowSellSignals',tooltip='ShowSellSignals',group='ALERTMESSAGES')
showTpSignal=input.bool(true,'ShowExitTPSignals',tooltip='ShowExitTPSignals',group='ALERTMESSAGES')
showSlSignal=input.bool(true,'ShowExitSLSignals',tooltip='ShowExitSLSignals',group='ALERTMESSAGES')
showExitSignal=input.bool(true,'ShowExitSignals',tooltip='ShowExitSignals',group='ALERTMESSAGES')
source=input(low,'COMMONSOURCE*',tooltip='(Defaultis"LOW")',group='DEFAULTFORALLTF')
conf_auto=input.bool(true,'CONFAUTO1m3m5m15m30mH1H2H3H4DAILYWEEKLY*',
tooltip='CONFAUTOOnlyForTimeframe1m3m5m15m30mH1H2H3H4DAILYWEEKLY,ELSEALLOTHERTF=DEFCONF!',
confirm=true,group='DEFAULTFORALLTF')
//-------------------------------------------------------------------------------------------------//
//ParametresdefautpourALLTimeFrame=DEFAUTFuturesBTC/USDTPerp:Low-??-??-??-??-REGULAR//Default//
//-------------------------------------------------------------------------------------------------//
length_Def=input.int(75,'DEFAULTLENGTH*--',minval=1,group='COMMONDEFAULTCONFIGFORALLTF,EXCEPTIFCONFAUTO',inline='DEFAULTCONF')
offset_Def=input.int(2,'DEFAULTOFFSET*--',minval=0,group='COMMONDEFAULTCONFIGFORALLTF,EXCEPTIFCONFAUTO',inline='DEFAULTCONF')
dev_Def=input.float(2.0,'DEFAULTDEVIATION*',minval=0.1,step=0.1,group='COMMONDEFAULTCONFIGFORALLTF,EXCEPTIFCONFAUTO',inline='DEFAULTCONF')
smoothing_Def=input.int(3,'DEFAULTSMOOTHING*',minval=1,group='COMMONDEFAULTCONFIGFORALLTF,EXCEPTIFCONFAUTO',inline='DEFAULTCONF')
reversal_Def=input(false,'DEFAULTREVERSAL*',group='COMMONDEFAULTCONFIGFORALLTF,EXCEPTIFCONFAUTO',inline='DEFAULTCONF',
tooltip='Reversal=ReversalStrategyMethod(Buy=Sell&Sell=Buy)!MayBeBetter(OrNot!)ThanTheRegularStrategy!')
//-------------------------------------------------------------------------------------------------//
//***********************************************************************************************************************//
//ParametresdebasepourTimeFrame=1mFuturesBTC/USDTPerp:Low-115-3-3.3-1-REGULAR-CONFAUTO1m!-//
//***********************************************************************************************************************//
length_1m=input.int(115,'LENGTH1m*--',minval=1,group='CONFIGONLYFOR1m,IFCONFAUTO',inline='1m')
offset_1m=input.int(3,'OFFSET1m*-----',minval=0,group='CONFIGONLYFOR1m,IFCONFAUTO',inline='1m')
dev_1m=input.float(3.3,'DEVIATION1m*',minval=0.1,step=0.1,group='CONFIGONLYFOR1m,IFCONFAUTO',inline='1m')
smoothing_1m=input.int(1,'SMOOTHING1m*',minval=1,group='CONFIGONLYFOR1m,IFCONFAUTO',inline='1m')
reversal_1m=input(false,'REVERSAL1m*',group='CONFIGONLYFOR1m,IFCONFAUTO',inline='1m',
tooltip='Reversal=ReversalStrategyMethod(Buy=Sell&Sell=Buy)!MayBeBetter(OrNot!)ThanTheRegularStrategy!')
//***********************************************************************************************************************//
//ParametresdebasepourTimeFrame=3mFuturesBTC/USDTPerp:Low-142-0-3.9-1-REGULAR-CONFAUTO3m!-//
//***********************************************************************************************************************//
length_3m=input.int(142,'LENGTH3m*--',minval=1,group='CONFIGONLYFOR3m,IFCONFAUTO',inline='3m')
offset_3m=input.int(0,'OFFSET3m*-----',minval=0,group='CONFIGONLYFOR3m,IFCONFAUTO',inline='3m')
dev_3m=input.float(3.9,'DEVIATION3m*',minval=0.1,step=0.1,group='CONFIGONLYFOR3m,IFCONFAUTO',inline='3m')
smoothing_3m=input.int(1,'SMOOTHING3m*',minval=1,group='CONFIGONLYFOR3m,IFCONFAUTO',inline='3m')
reversal_3m=input(false,'REVERSAL3m*',group='CONFIGONLYFOR3m,IFCONFAUTO',inline='3m',
tooltip='Reversal=ReversalStrategyMethod(Buy=Sell&Sell=Buy)!MayBeBetter(OrNot!)ThanTheRegularStrategy!')
//***********************************************************************************************************************//
//ParametresdebasepourTimeFrame=5mFuturesBTC/USDTPerp:Low-169-1-2.3-1-REGULAR-CONFAUTO5m!-//
//***********************************************************************************************************************//
length_5m=input.int(169,'LENGTH5m*--',minval=1,group='CONFIGONLYFOR5m,IFCONFAUTO',inline='5m')
offset_5m=input.int(1,'OFFSET5m*-----',minval=0,group='CONFIGONLYFOR5m,IFCONFAUTO',inline='5m')
dev_5m=input.float(2.3,'DEVIATION5m*',minval=0.1,step=0.1,group='CONFIGONLYFOR5m,IFCONFAUTO',inline='5m')
smoothing_5m=input.int(1,'SMOOTHING5m*',minval=1,group='CONFIGONLYFOR5m,IFCONFAUTO',inline='5m')
reversal_5m=input(false,'REVERSAL5m*',group='CONFIGONLYFOR5m,IFCONFAUTO',inline='5m',
tooltip='Reversal=ReversalStrategyMethod(Buy=Sell&Sell=Buy)!MayBeBetter(OrNot!)ThanTheRegularStrategy!')
//***********************************************************************************************************************//
//ParametresdebasepourTimeFrame=15mFuturesBTC/USDTPerp:Low-167-0-0.6-6-REGULAR-CONFAUTO15m!-//
//***********************************************************************************************************************//
length_15m=input.int(167,'LENGTH15m*--',minval=1,group='CONFIGONLYFOR15m,IFCONFAUTO',inline='15m')
offset_15m=input.int(0,'OFFSET15m*-----',minval=0,group='CONFIGONLYFOR15m,IFCONFAUTO',inline='15m')
dev_15m=input.float(0.6,'DEVIATION15m*',minval=0.1,step=0.1,group='CONFIGONLYFOR15m,IFCONFAUTO',inline='15m')
smoothing_15m=input.int(6,'SMOOTHING15m*',minval=1,group='CONFIGONLYFOR15m,IFCONFAUTO',inline='15m')
reversal_15m=input(false,'REVERSAL15m*',group='CONFIGONLYFOR15m,IFCONFAUTO',inline='15m',
tooltip='Reversal=ReversalStrategyMethod(Buy=Sell&Sell=Buy)!MayBeBetter(OrNot!)ThanTheRegularStrategy!')
//***********************************************************************************************************************//
//ParametresdebasepourTimeFrame=30mFuturesBTC/USDTPerp:Low-115-2-0.9-7-REGULAR-CONFAUTO30m!-//
//***********************************************************************************************************************//
length_30m=input.int(115,'LENGTH30m*--',minval=1,group='CONFIGONLYFOR30m,IFCONFAUTO',inline='30m')
offset_30m=input.int(2,'OFFSET30m*-----',minval=0,group='CONFIGONLYFOR30m,IFCONFAUTO',inline='30m')
dev_30m=input.float(0.9,'DEVIATION30m*',minval=0.1,step=0.1,group='CONFIGONLYFOR30m,IFCONFAUTO',inline='30m')
smoothing_30m=input.int(7,'SMOOTHING30m*',minval=1,group='CONFIGONLYFOR30m,IFCONFAUTO',inline='30m')
reversal_30m=input(false,'REVERSAL30m*',group='CONFIGONLYFOR30m,IFCONFAUTO',inline='30m',
tooltip='Reversal=ReversalStrategyMethod(Buy=Sell&Sell=Buy)!MayBeBetter(OrNot!)ThanTheRegularStrategy!')
//-------------------------------------------------------------------------------------------------//
//ParametresdebasepourTimeFrame=H1FuturesBTC/USDTPerp:Low-196-3-2.2-1-REGULAR-CONFAUTOH1!-//
//-------------------------------------------------------------------------------------------------//
length_H1=input.int(196,'LENGTHH1*--',minval=1,group='CONFIGONLYFORH1,IFCONFAUTO',inline='H1')
offset_H1=input.int(3,'OFFSETH1*-----',minval=0,group='CONFIGONLYFORH1,IFCONFAUTO',inline='H1')
dev_H1=input.float(2.2,'DEVIATIONH1*',minval=0.1,step=0.1,group='CONFIGONLYFORH1,IFCONFAUTO',inline='H1')
smoothing_H1=input.int(1,'SMOOTHINGH1*',minval=1,group='CONFIGONLYFORH1,IFCONFAUTO',inline='H1')
reversal_H1=input(false,'REVERSALH1*',group='CONFIGONLYFORH1,IFCONFAUTO',inline='H1',
tooltip='Reversal=ReversalStrategyMethod(Buy=Sell&Sell=Buy)!MayBeBetter(OrNot!)ThanTheRegularStrategy!')
//***********************************************************************************************************************//
//ParametresdebasepourTimeFrame=H2FuturesBTC/USDTPerp:Low-70-7-2.2-3-REGULAR-CONFAUTOH2!-//
//***********************************************************************************************************************//
length_H2=input.int(70,'LENGTHH2*--',minval=1,group='CONFIGONLYFORH2,IFCONFAUTO',inline='H2')
offset_H2=input.int(7,'OFFSETH2*-----',minval=0,group='CONFIGONLYFORH2,IFCONFAUTO',inline='H2')
dev_H2=input.float(2.2,'DEVIATIONH2*',minval=0.1,step=0.1,group='CONFIGONLYFORH2,IFCONFAUTO',inline='H2')
smoothing_H2=input.int(3,'SMOOTHINGH2*',minval=1,group='CONFIGONLYFORH2,IFCONFAUTO',inline='H2')
reversal_H2=input(false,'REVERSAL_H2*',group='CONFIGONLYFORH2,IFCONFAUTO',inline='H2',
tooltip='Reversal=ReversalStrategyMethod(Buy=Sell&Sell=Buy)!MayBeBetter(OrNot!)ThanTheRegularStrategy!')
//***********************************************************************************************************************//
//ParametresdebasepourTimeFrame=H3FuturesBTC/USDTPerp:Low-75-2-2.0-3-REGULAR-CONFAUTOH3!-//
//***********************************************************************************************************************//
length_H3=input.int(75,'LENGTHH3*--',minval=1,group='CONFIGONLYFORH3,IFCONFAUTO',inline='H3')
offset_H3=input.int(2,'OFFSETH3*-----',minval=0,group='CONFIGONLYFORH3,IFCONFAUTO',inline='H3')
dev_H3=input.float(2.0,'DEVIATIONH3*',minval=0.1,step=0.1,group='CONFIGONLYFORH3,IFCONFAUTO',inline='H3')
smoothing_H3=input.int(3,'SMOOTHINGH3*',minval=1,group='CONFIGONLYFORH3,IFCONFAUTO',inline='H3')
reversal_H3=input(false,'REVERSALH3*',group='CONFIGONLYFORH3,IFCONFAUTO',inline='H2',
tooltip='Reversal=ReversalStrategyMethod(Buy=Sell&Sell=Buy)!MayBeBetter(OrNot!)ThanTheRegularStrategy!')
//***********************************************************************************************************************//
//ParametresdebasepourTimeFrame=H4FuturesBTC/USDTPerp:Low-23-2-1.6-4-REGULAR-CONFAUTOH4!-//
//***********************************************************************************************************************//
length_H4=input.int(23,'LENGTHH4*--',minval=1,group='CONFIGONLYFORH4,IFCONFAUTO',inline='H4')
offset_H4=input.int(2,'OFFSETH4*-----',minval=0,group='CONFIGONLYFORH4,IFCONFAUTO',inline='H4')
dev_H4=input.float(1.6,'DEVIATIONH4*',minval=0.1,step=0.1,group='CONFIGONLYFORH4,IFCONFAUTO',inline='H4')
smoothing_H4=input.int(4,'SMOOTHINGH4*',minval=1,group='CONFIGONLYFORH4,IFCONFAUTO',inline='H4')
reversal_H4=input(false,'REVERSALH4*',group='CONFIGONLYFORH4,IFCONFAUTO',inline='H4',
tooltip='Reversal=ReversalStrategyMethod(Buy=Sell&Sell=Buy)!MayBeBetter(OrNot!)ThanTheRegularStrategy!')
//***********************************************************************************************************************//
//ParametresdebasepourTimeFrame=DFuturesBTC/USDTPerp:Low-52-2-1.7-9-REGULAR-CONFAUTOD!-//
//***********************************************************************************************************************//
length_D=input.int(52,'LENGTHDaily*--',minval=1,group='CONFIGONLYFORDAILY,IFCONFAUTO',inline='DAILY')
offset_D=input.int(2,'OFFSETDaily*-----',minval=0,group='CONFIGONLYFORDAILY,IFCONFAUTO',inline='DAILY')
dev_D=input.float(1.7,'DEVIATIONDaily*',minval=0.1,step=0.1,group='CONFIGONLYFORDAILY,IFCONFAUTO',inline='DAILY')
smoothing_D=input.int(9,'SMOOTHINGDaily*',minval=1,group='CONFIGONLYFORDAILY,IFCONFAUTO',inline='DAILY')
reversal_D=input(false,'REVERSALDaily*',group='CONFIGONLYFORDAILY,IFCONFAUTO',inline='DAILY',
tooltip='Reversal=ReversalStrategyMethod(Buy=Sell&Sell=Buy)!MayBeBetter(OrNot!)ThanTheRegularStrategy!')
//***********************************************************************************************************************//
//ParametresdebasepourTimeFrame=WFuturesBTC/USDTPerp:Low-14-0-0.7-5-REGULAR-CONFAUTOW!-//
//***********************************************************************************************************************//
length_W=input.int(14,'LENGTHWeekly*--',minval=1,group='CONFIGONLYFORWEEKLY,IFCONFAUTO',inline='WEEKLY')
offset_W=input.int(0,'OFFSETWeekly*-----',minval=0,group='CONFIGONLYFORWEEKLY,IFCONFAUTO',inline='WEEKLY')
dev_W=input.float(0.7,'DEVIATIONWeekly*',minval=0.1,step=0.1,group='CONFIGONLYFORWEEKLY,IFCONFAUTO',inline='WEEKLY')
smoothing_W=input.int(5,'SMOOTHINGWeekly*',minval=1,group='CONFIGONLYFORWEEKLY,IFCONFAUTO',inline='WEEKLY')
reversal_W=input(false,'REVERSALWeekly*',group='CONFIGONLYFORWEEKLY,IFCONFAUTO',inline='WEEKLY',
tooltip='Reversal=ReversalStrategyMethod(Buy=Sell&Sell=Buy)!MayBeBetter(OrNot!)ThanTheRegularStrategy!')
//*********************************************************************************************************************************************//
//DefaultConf//
smoothing=smoothing_Def
loop=length_Def
dev=dev_Def
conf='[CONFDEF]'//DefaultConf//
reversal=reversal_Def
if(timeframe.period=='1')andconf_auto
smoothing:=smoothing_1m
loop:=length_1m
dev:=dev_1m
conf:='[CONF1m]'
reversal:=reversal_1m
if(timeframe.period=='3')andconf_auto
smoothing:=smoothing_3m
loop:=length_3m
dev:=dev_3m
conf:='[CONF3m]'
reversal:=reversal_3m
if(timeframe.period=='5')andconf_auto
smoothing:=smoothing_5m
loop:=length_5m
dev:=dev_5m
conf:='[CONF5m]'
reversal:=reversal_5m
if(timeframe.period=='15')andconf_auto
smoothing:=smoothing_15m
loop:=length_15m
dev:=dev_15m
conf:='[CONF15m]'
reversal:=reversal_15m
if(timeframe.period=='30')andconf_auto
smoothing:=smoothing_30m
loop:=length_30m
dev:=dev_30m
conf:='[CONF30m]'
reversal:=reversal_30m
iftimeframe.period=='60'andconf_auto
smoothing:=smoothing_H1
loop:=length_H1
dev:=dev_H1
conf:='[CONFH1]'
reversal:=reversal_H1
iftimeframe.period=='120'andconf_auto
smoothing:=smoothing_H2
loop:=length_H2
dev:=dev_H2
conf:='[CONFH2]'
reversal:=reversal_H2
iftimeframe.period=='180'andconf_auto
smoothing:=smoothing_H3
loop:=length_H3
dev:=dev_H3
conf:='[CONFH3]'
reversal:=reversal_H3
iftimeframe.period=='240'andconf_auto
smoothing:=smoothing_H4
loop:=length_H4
dev:=dev_H4
conf:='[CONFH4]'
reversal:=reversal_H4
iftimeframe.period=='D'andconf_auto
smoothing:=smoothing_D
loop:=length_D
dev:=dev_D
conf:='[CONFD]'
reversal:=reversal_D
iftimeframe.period=='W'andconf_auto
smoothing:=smoothing_W
loop:=length_W
dev:=dev_W
conf:='[CONFW]'
reversal:=reversal_W
data(x)=>
ta.sma(request.security(syminfo.tickerid,timeframe.period,x),smoothing)

//*********************************************************************************************************************************************//
//DefaultConf//
linreg=data(ta.linreg(source,length_Def,offset_Def))
linreg_p=data(ta.linreg(source,length_Def,offset_Def+1))
if(timeframe.period=='1')andconf_auto
linreg:=data(ta.linreg(source,length_1m,offset_1m))
linreg_p:=data(ta.linreg(source,length_1m,offset_1m+1))
if(timeframe.period=='3')andconf_auto
linreg:=data(ta.linreg(source,length_3m,offset_3m))
linreg_p:=data(ta.linreg(source,length_3m,offset_3m+1))
iftimeframe.period=='5'andconf_auto
linreg:=data(ta.linreg(source,length_5m,offset_5m))
linreg_p:=data(ta.linreg(source,length_5m,offset_5m+1))
iftimeframe.period=='15'andconf_auto
linreg:=data(ta.linreg(source,length_15m,offset_15m))
linreg_p:=data(ta.linreg(source,length_15m,offset_15m+1))
iftimeframe.period=='30'andconf_auto
linreg:=data(ta.linreg(source,length_30m,offset_30m))
linreg_p:=data(ta.linreg(source,length_30m,offset_30m+1))
iftimeframe.period=='60'andconf_auto
linreg:=data(ta.linreg(source,length_H1,offset_H1))
linreg_p:=data(ta.linreg(source,length_H1,offset_H1+1))
iftimeframe.period=='120'andconf_auto
linreg:=data(ta.linreg(source,length_H2,offset_H2))
linreg_p:=data(ta.linreg(source,length_H2,offset_H2+1))
iftimeframe.period=='180'andconf_auto
linreg:=data(ta.linreg(source,length_H3,offset_H3))
linreg_p:=data(ta.linreg(source,length_H3,offset_H3+1))
iftimeframe.period=='240'andconf_auto
linreg:=data(ta.linreg(source,length_H4,offset_H4))
linreg_p:=data(ta.linreg(source,length_H4,offset_H4+1))
iftimeframe.period=='D'andconf_auto
linreg:=data(ta.linreg(source,length_D,offset_D))
linreg_p:=data(ta.linreg(source,length_D,offset_D+1))
iftimeframe.period=='W'andconf_auto
linreg:=data(ta.linreg(source,length_W,offset_W))
linreg_p:=data(ta.linreg(source,length_W,offset_W+1))

//*********************************************************************************************************************************************//
x=bar_index
slope=linreg-linreg_p
intercept=linreg-x*slope
deviationSum=0.0
fori=0toloop-1by1
deviationSum+=math.pow(source[i]-(slope*(x-i)+intercept),2)
deviationSum
//DefaultConf//
deviation=math.sqrt(deviationSum/length_Def)
x1=x-length_Def
y1=slope*(x-length_Def)+intercept
lengthHist=length_Def
if(timeframe.period=='1')andconf_auto
deviation:=math.sqrt(deviationSum/length_1m)
x1:=x-length_1m
y1:=slope*(x-length_1m)+intercept
lengthHist:=length_1m
if(timeframe.period=='3')andconf_auto
deviation:=math.sqrt(deviationSum/length_3m)
x1:=x-length_3m
y1:=slope*(x-length_3m)+intercept
lengthHist:=length_3m
if(timeframe.period=='5')andconf_auto
deviation:=math.sqrt(deviationSum/length_5m)
x1:=x-length_5m
y1:=slope*(x-length_5m)+intercept
lengthHist:=length_5m
if(timeframe.period=='15')andconf_auto
deviation:=math.sqrt(deviationSum/length_15m)
x1:=x-length_15m
y1:=slope*(x-length_15m)+intercept
lengthHist:=length_15m
if(timeframe.period=='30')andconf_auto
deviation:=math.sqrt(deviationSum/length_30m)
x1:=x-length_30m
y1:=slope*(x-length_30m)+intercept
lengthHist:=length_30m
iftimeframe.period=='60'andconf_auto
deviation:=math.sqrt(deviationSum/length_H1)
x1:=x-length_H1
y1:=slope*(x-length_H1)+intercept
lengthHist:=length_H1
iftimeframe.period=='120'andconf_auto
deviation:=math.sqrt(deviationSum/length_H2)
x1:=x-length_H2
y1:=slope*(x-length_H2)+intercept
lengthHist:=length_H2
iftimeframe.period=='180'andconf_auto
deviation:=math.sqrt(deviationSum/length_H3)
x1:=x-length_H3
y1:=slope*(x-length_H3)+intercept
lengthHist:=length_H3
iftimeframe.period=='240'andconf_auto
deviation:=math.sqrt(deviationSum/length_H4)
x1:=x-length_H4
y1:=slope*(x-length_H4)+intercept
lengthHist:=length_H4
iftimeframe.period=='D'andconf_auto
deviation:=math.sqrt(deviationSum/length_D)
x1:=x-length_D
y1:=slope*(x-length_D)+intercept
lengthHist:=length_D
iftimeframe.period=='W'andconf_auto
deviation:=math.sqrt(deviationSum/length_W)
x1:=x-length_W
y1:=slope*(x-length_W)+intercept
lengthHist:=length_W
x2=x
y2=linreg
//*********************************************************************************************************************************************//
b=line(na)
dp=line(na)
dm=line(na)
bHist=line(na)
dpHist=line(na)
dmHist=line(na)
bHist1=line(na)
dpHist1=line(na)
dmHist1=line(na)
b:=line.new(x1,y1,x2,y2,xloc.bar_index,extend.right,color.white,style=line.style_dashed,width=line_thick)
line.delete(b[1])
bHist:=line.new(x1[lengthHist],y1[lengthHist],x2[lengthHist],y2[lengthHist],xloc.bar_index,extend.none,
color.white,style=line.style_dashed,width=line_thick)
line.delete(bHist[1])
bHist1:=line.new(x1[lengthHist*2],y1[lengthHist*2],x2[lengthHist*2],y2[lengthHist*2],xloc.bar_index,extend.none,
color.white,style=line.style_dashed,width=line_thick)
line.delete(bHist1[1])
dp:=line.new(x1,deviation*dev+y1,x2,deviation*dev+y2,xloc.bar_index,extend.right,
color_up,style=line.style_dashed,width=line_thick)
line.delete(dp[1])
dpHist:=line.new(x1[lengthHist],deviation*dev+y1[lengthHist],x2[lengthHist],deviation*dev+y2[lengthHist],
xloc.bar_index,extend.none,color_up,style=line.style_dashed,width=line_thick)
line.delete(dpHist[1])
dpHist1:=line.new(x1[lengthHist*2],deviation*dev+y1[lengthHist*2],x2[lengthHist*2],deviation*dev+y2[lengthHist*2],
xloc.bar_index,extend.none,color_up,style=line.style_dashed,width=line_thick)
line.delete(dpHist1[1])
dm:=line.new(x1,-deviation*dev+y1,x2,-deviation*dev+y2,xloc.bar_index,extend.right,
color_down,style=line.style_dashed,width=line_thick)
line.delete(dm[1])
dmHist:=line.new(x1[lengthHist],-deviation*dev+y1[lengthHist],x2[lengthHist],-deviation*dev+y2[lengthHist],
xloc.bar_index,extend.none,color_down,style=line.style_dashed,width=line_thick)
line.delete(dmHist[1])
dmHist1:=line.new(x1[lengthHist*2],-deviation*dev+y1[lengthHist*2],x2[lengthHist*2],-deviation*dev+y2[lengthHist*2],
xloc.bar_index,extend.none,color_down,style=line.style_dashed,width=line_thick)
line.delete(dmHist1[1])
//*********************************************************************************************************************************************//
//Signaux
dm_current=-deviation*dev+y2
dp_current=deviation*dev+y2
//***LinearRegressionBuy&SellSignalRegularMode***//
sell=ta.crossunder(close,dm_current)
buy=ta.crossover(close,dp_current)
//*********************************************************************************************************************************************//
plotshape(notreversal?buy:na,title='BUY',style=shape.triangleup,location=location.top,color=color.new(#00ff00,0),size=size.tiny,
text='Buy',textcolor=color.new(#87a4f1,0),show_last=signals=='All'?99999999:500)
ifnotreversalandbuy
line.new(bar_index,high,bar_index,low,xloc=xloc.bar_index,extend=extend.left,color=color.new(#00ff00,0),style=line.style_solid,width=1)
plotshape(notreversal?sell:na,title='SELL',style=shape.triangledown,location=location.top,color=color.new(#ff0000,0),size=size.tiny,
text='Sell',textcolor=color.new(#87a4f1,0),show_last=signals=='All'?99999999:500)
ifnotreversalandsell
line.new(bar_index,high,bar_index,low,xloc=xloc.bar_index,extend=extend.left,color=color.new(#ff0000,0),style=line.style_solid,width=1)
plotshape(reversal?buy:na,title='SELLRv',style=shape.triangledown,location=location.top,color=color.new(#ff0000,0),size=size.tiny,
text='Sell\nRv',textcolor=color.new(#87a4f1,0),show_last=signals=='All'?99999999:500)
ifreversalandbuy
line.new(bar_index,high,bar_index,low,xloc=xloc.bar_index,extend=extend.left,color=color.new(#ff0000,0),style=line.style_solid,width=1)
plotshape(reversal?sell:na,title='BUYRv',style=shape.triangleup,location=location.top,color=color.new(#00ff00,0),size=size.tiny,
text='Buy\nRv',textcolor=color.new(#87a4f1,0),show_last=signals=='All'?99999999:500)
ifreversalandsell
line.new(bar_index,high,bar_index,low,xloc=xloc.bar_index,extend=extend.left,color=color.new(#00ff00,0),style=line.style_solid,width=1)
//********************************************************************************//
//***DefineF_print_lastfunctionForCurrentTradeInfos***//
f_print_last(_offsetx,_offsety,_lab_styl,_bkg_color,_text,_color_text,_size)=>
//***Createlabel***//.
var_label=label(na)
label.delete(_label)
_label:=label.new(bar_index+_offsetx,_offsety,_text,xloc.bar_index,yloc.price,_bkg_color,_lab_styl,_color_text,_size,text.align_center)
_label
//********************************************************************************//
//***DefineF_print2functionForTradesInfos***//
f_print2(_offsetx,_offsety,_lab_styl,_bkg_color,_text,_color_text,_size)=>
//***Createlabel***//.
var_label=label(na)
//label.delete(_label)//permanentlabel//
_label:=label.new(bar_index+_offsetx,_offsety,_text,xloc.bar_index,yloc.price,_bkg_color,_lab_styl,_color_text,_size,text.align_center)
_label
//********************************************************************************//
//[BuyOnly]&[SellOnly]'bothcheckedornochecked=[BUY+SELL]//
if(sell_onlyandbuy_only)or(notsell_onlyandnotbuy_only)
sell_only:=false
buy_only:=false

//********************************************************************************//
//GestionDesMultiplicateursStopLoss//
//ManagingStopLossMultipliers//
sl=sl1
ifslX10andsl>0
sl:=sl1*10
ifno_sl
sl:=0
//***************************************//
stp_loss_enable=bool(na)
ifsl==0
stp_loss_enable:=false
else
stp_loss_enable:=true
//***************************************//
//GestionDesMultiplicateursTakeProfit//
//ManagingTakeProfitMultipliers//
tp=tp1
iftpX10andtp>0
tp:=tp1*10
ifno_tp
tp:=0
//***************************************//
tp_enable=bool(na)
iftp==0
tp_enable:=false
else
tp_enable:=true
//********************************************************************************************************************//
trend=-1
trend:=nz(trend[1],trend)
//************************************************LINEARREGRESSIONMETHODE*****************************************//
//Trend==1-->LongIfNotReverse//
ifnotreversal
trend:=trend==-1andbuy?1:trend==1andsell?-1:trend
else
trend:=trend==1andbuy?-1:trend==-1andsell?1:trend
changeCond=trend!=trend[1]
//*********************************************************************************************************************//
varno_bar=int(0)
varipintno_trend=0//Varip//
varlast_trend=int(na)
//-------------------------//
no_bar:=no_bar+1
last_trend:=no_bar-no_trend
variptrade=float(0)
//-------------------------//
ifchangeCond
no_trend:=no_bar

//********************************************************************************//
varbuySignal=bool(na)
ifnotreversal
buySignal:=changeCondandtrend==1
else
buySignal:=changeCondandtrend==-1
//********************************************************************************//
varsellSignal=bool(na)
ifnotreversal
sellSignal:=changeCondandtrend==-1
else
sellSignal:=changeCondandtrend==1
//********************************************************************************//
varboolsl_lg=na
varboolsl_sh=na
varboolstop_loss=na
varbooltp_lg=na
varbooltp_sh=na
varbooltake_profit=na
//**********************************************************************************************************//
//GestiondesNumerosdeTrade,EnAccordAvecLaListeDesTransactionsDutesteurDeStrategieTradindView//
//ManagementofTradeNumbers,InAccordanceWithTheTradindViewStrategytester'sTransactionsList//
//**********************************************************************************************************//
//**********************************************************************************************************//
//**************************modifyingthissectionisnotrecommended!***********************************//
//**********************************************************************************************************//
if(changeCondandnotsell_onlyandnotbuy_only)andtrade==0//************************************//
trade:=trade+1//************************************//
else
if(changeCondandnotsell_onlyandnotbuy_only)//************************************//
trade:=trade+1
iftrade==0andnotreversalandbuySignalandbuy_only//************************************//
trade:=trade+1
iftrade==0andnotreversalandsellSignalandsell_only//************************************//
trade:=trade+1

iftrade==0andreversalandbuySignalandsell_only//************************************//
trade:=trade+1
iftrade==0andreversalandsellSignalandbuy_only//************************************//
trade:=trade+1
//**********************************************************************************************************//
//********************************************************************************//
//*******************************STRATEGY***************************************//
//********************************************************************************//
varstr_lg=bool(na)
varstr_sh=bool(na)
//!!!Varip->start_price!!!
varipstart_price=float(na)//varip//
//**************************************************************************//
//Trend==1-->LongNormal
iftrend==1andchangeCondandnotreversalandnotstr_lg
str_lg:=true
str_sh:=false
start_price:=close
sl_lg:=false
sl_sh:=false
tp_lg:=false
tp_sh:=false
//Trend==-1-->ShortNormal
iftrend==-1andchangeCondandnotreversalandnotstr_sh
str_lg:=false
str_sh:=true
start_price:=close
sl_lg:=false
sl_sh:=false
tp_lg:=false
tp_sh:=false
//**************************************************************************//
//Trend==-1-->ShortReversal
iftrend==-1andchangeCondandreversalandnotstr_sh
str_lg:=false
str_sh:=true
start_price:=close
sl_lg:=false
sl_sh:=false
tp_lg:=false
tp_sh:=false
//Trend==1-->LongReversal
iftrend==1andchangeCondandreversalandnotstr_lg
str_lg:=true
str_sh:=false
start_price:=close
sl_lg:=false
sl_sh:=false
tp_lg:=false
tp_sh:=false
//****************************************************************************************************************************************************//
//************************************************StrategyEntryLG-SH-LGRev-SHRev**********************************************************//
//****************************************************************************************************************************************************//
ifnotreversalandstr_lgandnotsell_onlyandbuySignal
strategy.entry('Lg',strategy.long,comment='Lg'+str.format('{0,number,#}',trade))
stop_loss:=false
take_profit:=false
ifnotreversalandstr_shandnotbuy_onlyandsellSignal
strategy.entry('Sh',strategy.short,comment='Sh'+str.format('{0,number,#}',trade))
stop_loss:=false
take_profit:=false
ifreversalandstr_lgandnotsell_onlyandsellSignal
strategy.entry('LgRev',strategy.long,comment='LgRev'+str.format('{0,number,#}',trade))
stop_loss:=false
take_profit:=false
ifreversalandstr_shandnotbuy_onlyandbuySignal
strategy.entry('ShRev',strategy.short,comment='ShRev'+str.format('{0,number,#}',trade))
stop_loss:=false
take_profit:=false

//**************************************************************************//
//DifferenceDePrix%//
//Pricedifference%//
d_per100=(close-close[last_trend])/math.max(close,close[last_trend])
vartxt_end_trade=string(na)
total_days=string(na)
//**************************************************************************//
ifstr.tonumber(timeframe.period)<=240
total_days:='\nHist'+str.format('{0,number,#.#}',(bar_index*str.tonumber(timeframe.period)/1440))+'DAYS'
iftimeframe.period=='D'
total_days:='\nHist'+str.format('{0,number,#.#}',(bar_index))+'DAYS'

iftimeframe.period=='W'
total_days:='\nHist'+str.format('{0,number,#.#}',(bar_index*7))+'DAYS'

iftimeframe.period=='M'
total_days:='\nHist'+str.format('{0,number,#.#}',(bar_index*30.4375))+'DAYS'
iftimeframe.period!='M'andtimeframe.period!='W'andtimeframe.period!='D'and(str.tonumber(timeframe.period)>240orstr.tonumber(timeframe.period)<1)
total_days:='\nHist???'+'DAYS'

//**************************************************************************//
since_days=string(na)
since=bar_index-bar_index[last_trend]
//silescripts'exécutesurlabarreprécédantimmédiatementlabarreentempsréel
ifbarstate.islastconfirmedhistory
since:=bar_index-bar_index[last_trend]
//**************************************************************************//
ifstr.tonumber(timeframe.period)<=240
since_days:='\nSince'+str.format('{0,number,#.#}',(since*str.tonumber(timeframe.period)/1440))+'DAYS'
iftimeframe.period=='D'
since_days:='\nSince'+str.format('{0,number,#.#}',(since))+'DAYS'

iftimeframe.period=='W'
since_days:='\nSince'+str.format('{0,number,#.#}',(since*7))+'DAYS'

iftimeframe.period=='M'
since_days:='\nSince'+str.format('{0,number,#.#}',(since*30.4375))+'DAYS'
iftimeframe.period!='M'andtimeframe.period!='W'andtimeframe.period!='D'and(str.tonumber(timeframe.period)>240orstr.tonumber(timeframe.period)<1)
since_days:='\nSince???'+'DAYS'
//**************************************************************************//
SizePosUsd=string(na)
SizePosBtc=float(na)
iftrade>=1
SizePosUsd:=strategy.account_currency+str.tostring(strategy.position_size*start_price,format='#.##')
SizePosBtc:=strategy.position_size
PnlFlag=string(na)
GreenCircle=string('🟢')
RedCircle=string('🔴')
WhiteCircle=string('⚪')
ifstrategy.opentrades.profit(0)<0
PnlFlag:=RedCircle
elseifstrategy.opentrades.profit(0)>0
PnlFlag:=GreenCircle
else
PnlFlag:=WhiteCircle
ifshow_full_info
txt_end_trade:='#'+str.format('{0,number,#}',trade)+
''+PnlFlag+
'\n<last#'+str.format('{0,number,#}',trade[last_trend])+
'\n<'+syminfo.basecurrency+str.format('{0,number,#.########}',strategy.position_size)+
'\n<'+SizePosUsd+
'\nSL'+str.format('{0,number,#.###}',sl)+'%'+'TP'+str.format('{0,number,#.###}',tp)+'%'+
'\n<E'+str.format('{0,number,#.########}'+strategy.account_currency,close[last_trend])+
'\n=C'+str.format('{0,number,#.########}'+strategy.account_currency,close)+
'\nd'+str.format('{0,number,#.########}'+strategy.account_currency,close-close[last_trend])+
'\n%d'+str.format('{0,number,#.##%}',d_per100)+
'\n=PnL'+str.format('{0,number,#.##}'+strategy.account_currency,strategy.opentrades.profit(0))+
'\nCom'+str.format('{0,number,-#.##}'+strategy.account_currency,strategy.opentrades.commission(0)*2)+
total_days+
since_days
else
txt_end_trade:='#'+str.format('{0,number,#}',trade)+
''+PnlFlag+
'\n<'+syminfo.basecurrency+str.format('{0,number,#.########}',strategy.position_size)+
'\n<'+SizePosUsd+
'\n%d'+str.format('{0,number,#.##%}',d_per100)+
'\nPnL'+str.format('{0,number,#.##}'+strategy.account_currency,strategy.opentrades.profit(0))+
'\nCom'+str.format('{0,number,-#.##}'+strategy.account_currency,strategy.opentrades.commission(0)*2)+
since_days
//************************************//
//LabelHorizontalPositionSetting//
atr=ta.sma(ta.tr,loop)
high_pos=ohlc4+(y_Pos_factor*atr)
low_pos=ohlc4-(y_Pos_factor*atr)
//************************************//
varf2=label(na)
iftrade==0
label.delete(f2)
pnl_color=color(na)
ifstrategy.opentrades.profit(0)<0
pnl_color:=color.new(#080808,0)
elseifstrategy.opentrades.profit(0)>0
pnl_color:=color.new(#ffffff,0)
else
pnl_color:=color.new(#fbe78c,0)

variptrade_dir=string(na)
//****************************************************************************************************************//
//***OrdreDesParametresPourF_Print2:(_Offsetx,_Offsety,_Lab_styl,_Bkg_color,_Text,_Color_text,_Size)***//
//***OrderOfParametersForF_Print2:(_Offsetx,_Offsety,_Lab_styl,_Bkg_color,_Text,_Color_text,_Size)***//
//****************************************************************************************************************//
//----------------------------------------------------------------------------
txt_end_trade:=txt_end_trade+'\n'+str.format_time(time,"yyyy-MM-dd","UTC")+'\ntrig='+str.format_time(time,"HH:mm","UTC")+'\nUTC'
//----------------------------------------------------------------------------
//AlertIntermediatBuy/Sell
ifta.crossunder(close,dm_current)andnotreversalandshowIntermedSignal
alert('\nIntermediateBUYSignal\n'+txt_end_trade,alert.freq_all)
ifta.crossover(close,dp_current)andnotreversalandshowIntermedSignal
alert('\nIntermediateSELLSignal\n'+txt_end_trade,alert.freq_all)
ifta.crossunder(close,dm_current)andreversalandshowIntermedSignal
alert('\nIntermediateSELLSignalRev.\n'+txt_end_trade,alert.freq_all)
ifta.crossover(close,dp_current)andreversalandshowIntermedSignal
alert('\nIntermediateBUYSignalRev.\n'+txt_end_trade,alert.freq_all)
//----------------------------------------------------------------------------
ifbuySignalandshow_trade_infoandnotreversalandnotsell_only
f2:=f_print2(1,high_pos,label.style_label_down,color.new(#65ff65,40),
'Lg'+txt_end_trade,
pnl_color,size.normal)
trade_dir:='Lg'
ifbuySignalandnotreversalandnotsell_only
ifshowBuySignal
alert('\nBUYSignal\n'+txt_end_trade,alert.freq_all)
trade_dir:='Lg'
//----------------------------------------------------------------------------
ifbuySignalandshow_trade_infoandreversalandnotbuy_only
f2:=f_print2(1,low_pos,label.style_label_up,color.new(#ff6565,40),
'ShRv'+txt_end_trade,
pnl_color,size.normal)
trade_dir:='ShRv'
ifbuySignalandreversalandnotbuy_only
ifshowSellSignal
alert('\nSELLRev.SIGNAL\n'+txt_end_trade,alert.freq_all)
trade_dir:='ShRv'
//----------------------------------------------------------------------------
ifsellSignalandshow_trade_infoandnotreversalandnotbuy_only
f2:=f_print2(1,low_pos,label.style_label_up,color.new(#ff6565,40),
'Sh'+txt_end_trade,
pnl_color,size.normal)
trade_dir:='Sh'
ifsellSignalandnotreversalandnotbuy_only
ifshowSellSignal
alert('\nSELLSIGNAL\n'+txt_end_trade,alert.freq_all)
trade_dir:='Sh'
//----------------------------------------------------------------------------
ifsellSignalandshow_trade_infoandreversalandnotsell_only
f2:=f_print2(1,high_pos,label.style_label_down,color.new(#65ff65,40),
'LgRv'+txt_end_trade,
pnl_color,size.normal)
trade_dir:='LgRv'
ifsellSignalandreversalandnotsell_only
ifshowBuySignal
alert('\nBUYRev.SIGNAL\n'+txt_end_trade,alert.freq_all)
trade_dir:='LgRv'
//----------------------------------------------------------------------------
//**********************************************************************************************************************************************************//
//CALCULdesvaleursdeStopLossetTakeProfit//
//**********************************************************************************************************************************************************//
//StopLoss&TakeProfitcalculésenpourcentagedelatailledelaPosition
//FORMULEDeCALCULdu:TP_SL_usd=((E_usdxSIZE_btcxTP_SL_%/100)+-(E_usdxSIZE_btc))/SIZE_btc
//LesValeursdesCommissionsd'Entrée&deSortiesontprisesenCompte!
SLLgValUsd=(((start_price*SizePosBtc)-(start_price*SizePosBtc*sl/100))/SizePosBtc)+strategy.opentrades.commission(0)
SLShValUsd=(((start_price*SizePosBtc)+(start_price*SizePosBtc*sl/100))/SizePosBtc)-strategy.opentrades.commission(0)
TPLgValUsd=(((start_price*SizePosBtc)+(start_price*SizePosBtc*tp/100))/SizePosBtc)+strategy.opentrades.commission(0)
TPShValUsd=(((start_price*SizePosBtc)-(start_price*SizePosBtc*tp/100))/SizePosBtc)-strategy.opentrades.commission(0)
//**********************************************************************************************************************************************************//
//**********************************************************************************************************************************************************//
//*********************************************************************STOPLOSS**************************************************************************//
//**********************************************************************************************************************************************************//
//SIGNALSL
ifclose<=SLLgValUsdandstp_loss_enableandstr_lgandnotsell_only
sl_lg:=true
stop_loss:=true
ifclose>=SLShValUsdandstp_loss_enableandstr_shandnotbuy_only
sl_sh:=true
stop_loss:=true
//****************************************************************************************************************//
//***OrdreDesParametresPourF_Print2:(_Offsetx,_Offsety,_Lab_styl,_Bkg_color,_Text,_Color_text,_Size)***//
//***OrderOfParametersForF_Print2:(_Offsetx,_Offsety,_Lab_styl,_Bkg_color,_Text,_Color_text,_Size)***//
//****************************************************************************************************************//
varipsl_price=float(na)//varip//
ifsl_lgandstp_loss_enableandnotreversalandshow_trade_infoandstr_lgandnotsell_only
f2:=f_print2(0,low_pos,label.style_label_up,color.new(#00aaff,40),
'SLLG'+txt_end_trade,
pnl_color,size.normal)
trade_dir:='Null'
ifsl_lgandstp_loss_enableandnotreversalandstr_lg
strategy.close('Lg',comment='STOPLOSSLG'+str.format('{0,number,#}',trade),immediately=true)
ifshowSlSignal
alert('\nSTOPLOSSLG\n'+txt_end_trade,alert.freq_all)
str_lg:=false
str_sh:=false
sl_price:=close
trade_dir:='Null'
//********************************************************************************//
ifsl_shandstp_loss_enableandnotreversalandshow_trade_infoandstr_shandnotbuy_only
f2:=f_print2(0,high_pos,label.style_label_down,color.new(#fbea7f,40),
'SLSH'+txt_end_trade,
pnl_color,size.normal)
trade_dir:='Null'
ifsl_shandstp_loss_enableandnotreversalandstr_sh
strategy.close('Sh',comment='STOPLOSSSH'+str.format('{0,number,#}',trade),immediately=true)
ifshowSlSignal
alert('\nSTOPLOSSSH\n'+txt_end_trade,alert.freq_all)
str_lg:=false
str_sh:=false
sl_price:=close
trade_dir:='Null'
//********************************************************************************//
//********************************************************************************//
ifsl_lgandstp_loss_enableandreversalandshow_trade_infoandstr_lgandnotsell_only
f2:=f_print2(0,low_pos,label.style_label_up,color.new(#00aaff,40),
'SLLGRv'+txt_end_trade,
pnl_color,size.normal)
trade_dir:='Null'
ifsl_lgandstp_loss_enableandreversalandstr_lg
strategy.close('LgRev',comment='STOPLOSSLGRev.'+str.format('{0,number,#}',trade),immediately=true)
ifshowSlSignal
alert('\nSTOPLOSSLGRev.\n'+txt_end_trade,alert.freq_all)
str_lg:=false
str_sh:=false
sl_price:=close
trade_dir:='Null'
//********************************************************************************//
ifsl_shandstp_loss_enableandreversalandshow_trade_infoandstr_shandnotbuy_only
f2:=f_print2(0,high_pos,label.style_label_down,color.new(#fbea7f,40),
'SLSHRv'+txt_end_trade,
pnl_color,size.normal)
trade_dir:='Null'
ifsl_shandstp_loss_enableandreversalandstr_sh
strategy.close('ShRev',comment='STOPLOSSSHRev.'+str.format('{0,number,#}',trade),immediately=true)
ifshowSlSignal
alert('\nSTOPLOSSSHRev.\n'+txt_end_trade,alert.freq_all)
str_lg:=false
str_sh:=false
sl_price:=close
trade_dir:='Null'
//**********************************************************************************************************************************************************//
//*********************************************************************TAKEPROFIT************************************************************************//
//**********************************************************************************************************************************************************//
//SIGNALTP
ifclose>=TPLgValUsdandtp_enableandstr_lgandnotsell_only
tp_lg:=true
take_profit:=true
ifclose<=TPShValUsdandtp_enableandstr_shandnotbuy_only
tp_sh:=true
take_profit:=true
//****************************************************************************************************************//
//***OrdreDesParametresPourF_Print2:(_Offsetx,_Offsety,_Lab_styl,_Bkg_color,_Text,_Color_text,_Size)***//
//***OrderOfParametersForF_Print2:(_Offsetx,_Offsety,_Lab_styl,_Bkg_color,_Text,_Color_text,_Size)***//
//****************************************************************************************************************//
variptp_price=float(na)//varip//
iftp_lgandtp_enableandnotreversalandshow_trade_infoandstr_lgandnotsell_only
f2:=f_print2(0,low_pos,label.style_label_up,color.new(#00ffdd,40),
'TPLG'+txt_end_trade,
pnl_color,size.normal)
trade_dir:='Null'
iftp_lgandtp_enableandnotreversalandstr_lg
strategy.close('Lg',comment='TAKEPROFITLG'+str.format('{0,number,#}',trade),immediately=true)
ifshowTpSignal
alert('\nTAKEPROFITLG\n'+txt_end_trade,alert.freq_all)
str_lg:=false
str_sh:=false
tp_price:=close
trade_dir:='Null'
//********************************************************************************//
iftp_shandtp_enableandnotreversalandshow_trade_infoandstr_shandnotbuy_only
f2:=f_print2(0,high_pos,label.style_label_down,color.new(#ff5f00,40),
'TPSH'+txt_end_trade,
pnl_color,size.normal)
trade_dir:='Null'
iftp_shandtp_enableandnotreversalandstr_sh
strategy.close('Sh',comment='TAKEPROFITSH'+str.format('{0,number,#}',trade),immediately=true)
ifshowTpSignal
alert('\nTAKEPROFITSH\n'+txt_end_trade,alert.freq_all)
str_lg:=false
str_sh:=false
tp_price:=close
trade_dir:='Null'
//********************************************************************************//
//********************************************************************************//
iftp_lgandtp_enableandreversalandshow_trade_infoandstr_lgandnotsell_only
f2:=f_print2(0,low_pos,label.style_label_up,color.new(#00ffdd,40),
'TPLGRv'+txt_end_trade,
pnl_color,size.normal)
trade_dir:='Null'
iftp_lgandtp_enableandreversalandstr_lg
strategy.close('LgRev',comment='TAKEPROFITLGRev.'+str.format('{0,number,#}',trade),immediately=true)
ifshowTpSignal
alert('\nTAKEPROFITLGRev.\n'+txt_end_trade,alert.freq_all)
str_lg:=false
str_sh:=false
tp_price:=close
trade_dir:='Null'
//********************************************************************************//
iftp_shandtp_enableandreversalandshow_trade_infoandstr_shandnotbuy_only
f2:=f_print2(0,high_pos,label.style_label_down,color.new(#ff5f00,40),
'TPSHRv'+txt_end_trade,
pnl_color,size.normal)
trade_dir:='Null'
iftp_shandtp_enableandreversalandstr_sh
strategy.close('ShRev',comment='TAKEPROFITSHRev.'+str.format('{0,number,#}',trade),immediately=true)
ifshowTpSignal
alert('\nTAKEPROFITSHRev.\n'+txt_end_trade,alert.freq_all)
str_lg:=false
str_sh:=false
tp_price:=close
trade_dir:='Null'
//**********************************************************************************************************************************************************//
//EXIT//
//**********************************************************************************************************************************************************//
ifchangeCondandsellSignalandnotreversalandbuy_onlyandshow_trade_infoandnotstop_lossandnottake_profit
f2:=f_print2(0,low_pos,label.style_label_up,color.new(#f47ff2,40),
'ExLg'+txt_end_trade,
pnl_color,size.normal)
stop_loss:=false
take_profit:=false
trade_dir:='Null'
ifchangeCondandsellSignalandnotreversalandbuy_only
strategy.close('Lg',comment='ExitLg'+str.format('{0,number,#}',trade),immediately=true)
ifshowExitSignal
alert('\nEXITLG\n'+txt_end_trade,alert.freq_all)
stop_loss:=false
take_profit:=false
trade:=trade+1
trade_dir:='Null'
str_lg:=false
str_sh:=false
//**********************************************************************************************************************************************************//
ifchangeCondandbuySignalandnotreversalandsell_onlyandshow_trade_infoandnotstop_lossandnottake_profit
f2:=f_print2(0,high_pos,label.style_label_down,color.new(#8bfcc7,40),
'ExSh'+txt_end_trade,
pnl_color,size.normal)
stop_loss:=false
take_profit:=false
trade_dir:='Null'
ifchangeCondandbuySignalandnotreversalandsell_only
strategy.close('Sh',comment='ExitSh'+str.format('{0,number,#}',trade),immediately=true)
ifshowExitSignal
alert('\nEXITSH\n'+txt_end_trade,alert.freq_all)
stop_loss:=false
take_profit:=false
trade:=trade+1
trade_dir:='Null'
str_lg:=false
str_sh:=false
//**********************************************************************************************************************************************************//
//**********************************************************************************************************************************************************//
ifchangeCondandsellSignalandreversalandsell_onlyandshow_trade_infoandnotstop_lossandnottake_profit
f2:=f_print2(0,high_pos,label.style_label_down,color.new(#8bfcc7,40),
'ExShRv'+txt_end_trade,
pnl_color,size.normal)
stop_loss:=false
take_profit:=false
trade_dir:='Null'
ifchangeCondandsellSignalandreversalandsell_only
strategy.close('ShRev',comment='ExitShRev'+str.format('{0,number,#}',trade),immediately=true)
ifshowExitSignal
alert('\nEXITSHREV.\n'+txt_end_trade,alert.freq_all)
stop_loss:=false
take_profit:=false
trade:=trade+1
trade_dir:='Null'
str_lg:=false
str_sh:=false
//**********************************************************************************************************************************************************//
ifchangeCondandbuySignalandreversalandbuy_onlyandshow_trade_infoandnotstop_lossandnottake_profit
f2:=f_print2(0,low_pos,label.style_label_up,color.new(#f47ff2,40),
'ExLgRv'+txt_end_trade,
pnl_color,size.normal)
stop_loss:=false
take_profit:=false
trade_dir:='Null'
ifchangeCondandbuySignalandreversalandbuy_only
strategy.close('LgRev',comment='ExitLgRev'+str.format('{0,number,#}',trade),immediately=true)
ifshowExitSignal
alert('\n'+'EXITLGREV.\n'+txt_end_trade,alert.freq_all)
stop_loss:=false
take_profit:=false
trade:=trade+1
trade_dir:='Null'
str_lg:=false
str_sh:=false
//*********************************************CandleColorsAccordingToTrendDirection*****************************************************************//
barcolor(notreversalandtrend==-1andbarscolorsandnotbuy_onlyandnotstop_lossandnottake_profit?color.new(#ff0000,55):
notreversalandtrend==1andbarscolorsandnotsell_onlyandnotstop_lossandnottake_profit?color.new(#00ff00,55):
reversalandtrend==-1andbarscolorsandnotbuy_onlyandnotstop_lossandnottake_profit?color.new(#ff0000,55):
reversalandtrend==1andbarscolorsandnotsell_onlyandnotstop_lossandnottake_profit?color.new(#00ff00,55):
barscolors?color.new(#2a2a2c,55):na)
//**********************************************************************************************************************************************************//
shp_color=color.new(na,100)
ifnottake_profitandnotstop_loss
ifstr_lgand(linreg>=linreg[1])
shp_color:=notsell_only?color.new(#00ff00,0):color.new(#00ff00,80)
ifstr_lgand(linreg<linreg[1])
shp_color:=notsell_only?color.new(#eaff00,0):color.new(#eaff00,80)

//-------------------------------------------------------------------------------------------------//
ifstr_shand(linreg<linreg[1])
shp_color:=notbuy_only?color.new(#ff0000,0):color.new(#ff0000,80)
ifstr_shand(linreg>=linreg[1])
shp_color:=notbuy_only?color.new(#ff9100,0):color.new(#ff9100,80)
plot(linreg,'RegressionLine',color=shp_color,linewidth=2,style=plot.style_line)
plotshape(str_lg?linreg:na,'LgPnLLine',style=shape.square,location=location.bottom,color=str_lgand(close>=start_price)?color.new(#00ff00,20):
str_lgand(close<start_price)?color.new(#ff0000,20):na,size=size.tiny)
plotshape(str_sh?linreg:na,'ShPnLLine',style=shape.square,location=location.bottom,color=str_shand(close<start_price)?color.new(#00ff00,20):
str_shand(close>=start_price)?color.new(#ff0000,20):na,size=size.tiny)
//*********************************************************************StopLossIndicator************************************************************************************//
sl_lg_price=SLLgValUsd
ifshow_sl_lineandstp_loss_enableandnotsell_onlyandsl_lg
sl_lg_price:=sl_price
sl_sh_price=SLShValUsd
ifshow_sl_lineandstp_loss_enableandnotbuy_onlyandsl_sh
sl_sh_price:=sl_price
sl_line_lg=plot(show_sl_lineandstp_loss_enableandnotsell_onlyand(str_lgorsl_lg)andnotstop_loss?sl_lg_price:na,
title='StoplossLgLine',style=plot.style_linebr,linewidth=2,color=color.new(#ff0000,0),offset=1)

sl_line_sh=plot(show_sl_lineandstp_loss_enableandnotbuy_onlyand(str_shorsl_sh)andnotstop_loss?sl_sh_price:na,
title='StoplossShLine',style=plot.style_linebr,linewidth=2,color=color.new(#ff0000,0),offset=1)
//*********************************************************************TakeProfitIndicator************************************************************************************//
tp_lg_price=TPLgValUsd
ifshow_tp_lineandtp_enableandnotsell_onlyandtp_lg
tp_lg_price:=tp_price
tp_sh_price=TPShValUsd
ifshow_tp_lineandtp_enableandnotbuy_onlyandtp_sh
tp_sh_price:=tp_price
tp_line_lg=plot(show_tp_lineandtp_enableandnotsell_onlyand(str_lgortp_lg)andnottake_profit?tp_lg_price:na,
title='TakeProfitLgLine',style=plot.style_linebr,linewidth=2,color=color.new(#00ff00,0),offset=1)

tp_line_sh=plot(show_tp_lineandtp_enableandnotbuy_onlyand(str_shortp_sh)andnottake_profit?tp_sh_price:na,
title='TakeProfitShLine',style=plot.style_linebr,linewidth=2,color=color.new(#00ff00,0),offset=1)
//*********************************************************************EntryPriceIndicator**********************************************************************************//
start_price_lg=plot(start_price,title='StartPriceLgLine',style=plot.style_stepline_diamond,linewidth=2,
color=notchangeCondandnotsell_onlyand(str_lgorsl_lgortp_lg)andnotstop_lossandnottake_profit?color.new(color.white,0):na,trackprice=false,offset=1)

start_price_sh=plot(start_price,title='StartPriceShLine',style=plot.style_stepline_diamond,linewidth=2,
color=notchangeCondandnotbuy_onlyand(str_shorsl_shortp_sh)andnotstop_lossandnottake_profit?color.new(color.white,0):na,trackprice=false,offset=1)
//*********************************************************************StopLossBackground***********************************************************************************//
fill(start_price_lg,sl_line_lg,title='StopLongBackground',color=show_sl_lineandstp_loss_enableandnotsell_onlyandnotstop_loss?color.new(#ff4fb3,90):na)
fill(start_price_sh,sl_line_sh,title='StopShortBackground',color=show_sl_lineandstp_loss_enableandnotbuy_onlyandnotstop_loss?color.new(#ff4fb3,90):na)
//*******************************************************************TakeProfitBackground***********************************************************************************//
fill(start_price_lg,tp_line_lg,title='TPLongBackground',color=show_tp_lineandtp_enableandnotsell_onlyandnottake_profit?color.new(#00ff00,90):na)
fill(start_price_sh,tp_line_sh,title='TPShortBackground',color=show_tp_lineandtp_enableandnotbuy_onlyandnottake_profit?color.new(#00ff00,90):na)
//dmline&dpline
dmline=plot(dm_current,'dm_current',color=str_lgorstr_sh?color.new(#00ff00,0):color.new(#217d21,0),style=plot.style_line,linewidth=1)
dpline=plot(dp_current,'dp_current',color=str_lgorstr_sh?color.new(#ff0000,0):color.new(#852727,0),style=plot.style_line,linewidth=1)
//*******************************************************************TakeProfitBackground***********************************************************************************//
varf1=label(na)
iftrade==0orbarstate.ishistory
label.delete(f1)
//*******************************************************************LabelCurrentPosition***************************************************************//
//*****************************************************************************************************************//
//***OrdreDesParametresPourF_Print_last:(_Offsetx,_Offsety,_Lab_styl,_Bkg_color,_Text,_Color_text,_Size)***//
//***OrderOfParametersForF_Print_last:(_Offsetx,_Offsety,_Lab_styl,_Bkg_color,_Text,_Color_text,_Size)//
//*****************************************************************************************************************//
//
f1:=f_print_last(8,close,label.style_label_left,strategy.openprofit>=0?color.new(#aaffaa,50):strategy.openprofit<0?color.new(#ff7777,50):color.new(#cccccc,80),
trade_dir+txt_end_trade+'\n'+conf,
pnl_color,size.normal)
//**********************************************************************************************************************************************************//
//**********************************************************************************************************************************************************//
//************************************************************************ENDCODE************************************************************************//
//**********************************************************************************************************************************************************//
//**********************************************************************************************************************************************************//
Expand (1289 lines)
