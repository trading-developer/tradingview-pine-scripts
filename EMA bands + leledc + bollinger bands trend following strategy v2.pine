Script Name: EMA bands + leledc + bollinger bands trend following strategy v2
Author: readysetliqd
Description: The basics:
In its simplest form, this strategy is a positional trend following strategy which enters long when price breaks out above "middle" EMA bands and closes or flips short when price breaks down below "middle" EMA bands. The top and bottom of the middle EMA bands are calculated from the EMA of candle highs and lows, respectively.

The idea is that...
PineScript code:

Pine Script™ strategy
EMA bands + leledc + bollinger bands trend following strategy v2
//  This  source  code  is  subject  to  the  terms  of  the  Mozilla  Public  License  2.0  at  https://mozilla.org/MPL/2.0/
//  ©  danielx888
//  Credits  to  Joy_Bangla  for  the  Leledc  exhaustion  bar  code
//  Credits  to  VishvaP  for  the  34  EMA  bands  code
//  Credits  to  SlumdogTrader  for  the  BB  exhaustion  code  (edited  for  functionality)
//  Credits  to  Juanc2316  for  his  code  for  BB  Keltner  Squeeze
//
//  Update  Notes  :  added  strategy  close  conditions  before  every  entry  for  more  accurate
//  backtesting  results  when  considering  for  slippage  and  fees,    readability  adjustments
//@version=5
strategy(title='EMA  bands  +  leledc  +  bollinger  bands  trend  catching  strategy  w/  countertrend  scalp',
          shorttitle='Trend  Pooristics',  overlay=true,  initial_capital  =  1000,  commission_value=  0.036,
          pyramiding=  0,  default_qty_type=  strategy.percent_of_equity,  default_qty_value=  100,
          margin_long=0,  margin_short=0,  max_bars_back=200)
//USER  INPUTS  {
//INPUT:  OPEN
i_EMAlength                  =  input.int      (34,  'EMA  Length',  minval=1,  step=1)
s_needLong                    =  input.bool    (true,  title  =  "Enable  middle  EMA  band  breakout:  Long",  group="Open  Conditions")
s_needShort                  =  input.bool    (true,  title  =  "Enable  middle  EMA  band  breakdown:  Short",  group="Open  Conditions")
s_longBounce                =  input.bool    (false,  'Enable  middle  EMA  band  bounce  re-entry:  Long',  tooltip='Works  best  when  early  close  conditions  are  used',  group=  'Open  Conditions')
s_shortBounce              =  input.bool    (false,  'Enable  middle  EMA  band  bounce  re-entry:  Short',  tooltip='Works  best  when  early  close  conditions  are  used',  group=  'Open  Conditions')
s_alwaysLong                =  input.bool    (false,  title  =  "Enable  default  positioning:  Long",  tooltip='Does  not  work  with  "Enable  default  positioning:  Short"  also  selected.  Works  best  when  early  close  conditions  are  used',  group  =  'Open  Conditions')
s_alwaysShort              =  input.bool    (false,  title  =  "Enable  default  positioning:  Short",  tooltip='Does  not  work  with  "Enable  default  positioning:  Long"  also  selected.  Works  best  when  early  close  conditions  are  used',  group  =  'Open  Conditions')
i_topMBmult                  =  input.float  (1,  'Top  middle  band  multiplier',  0.1,3,step=0.1,group='Open  Conditions')
i_botMBmult                  =  input.float  (1,  'Bottom  middle  band  multiplier',0.1,3,step=0.1,group='Open  Conditions')
s_useSlowEMA                =  input.bool    (false,  title='Use  slow  EMA  filter',tooltip='Condition  does  not  apply  to  counter-trend  trades',  group='Open  Conditions')
i_slowEMAlen                =  input.int      (200,  title='Slow  EMA  Length',  step=1,  minval=1,  group='Open  Conditions')
//INPUT:  CLOSE
i_midClose                    =  input.string('Oppositeband','CloseoncrossesthroughmiddleEMAbands',tooltip='Selecting"Delayedbarsinside"willclosingpositionsafterspecifiedamountofcandlescloseinbetweenthemiddleEMAbandswithoutbreakingout',options=['Nearestband','Oppositeband','Delayedbarsinside'],group='CloseConditions')
i_numBars=input.int(4,'Delayedcloseno.ofbars',minval=1,maxval=10,step=1,group='CloseConditions')
s_useLele=input.bool(false,'CloseonLeledcbars',group='CloseConditions')
i_whichLele=input.string('First','WhichLeledcbar?',options=['First','Second','Third','Fourth','Fifth'],group='CloseConditions')
s_useBBExtend=input.bool(false,'CloseonBollingerBandexhaustionbars',tooltip='BollingerBandExhaustionbarsarecandlesthatclosebackinsidetheBollingerBandswhenRSIisoverboughtoroversold.Settingsforbothcanbechangedunderthe-BollingerBandsExhaustionBarSettings-header.',group='CloseConditions')
i_whichBBext=input.string('First','WhichBBexhaustionbar?',options=['First','Second','Third'],group='CloseConditions')
s_buySellClose=input.bool(false,'CloseonlossofBuy/Sellzone',group='CloseConditions')
s_whichBuySellBars=input.string('Inner','WhichBuy/Sellzone?',options=['Inner','Outer'],group='CloseConditions')
//INPUT:COUNTER-TRENDTRADES
s_needCTlong=input.bool(false,"Enablecounter-trendtrades:Long",tooltip='Doesnotworkwith"Enabledefaultpositioning:Short"selected',group="CounterTradeSettings")
i_CTlongType=input.string('Leledc',title='Trigger',options=['Leledc','BBExhaustion'],group='CounterTradeSettings')
s_needCTshort=input.bool(false,"Enablecounter-trendtrades:Short",tooltip='Doesnotworkwith"Enabledefaultpositioning:Long"selected"',group="CounterTradeSettings")
i_CTshortType=input.string('Leledc','Trigger',options=['Leledc','BBExhaustion'],group='CounterTradeSettings')
i_ctLeleBuySell=input.string('Inner','Leledc/BBmustbeoutsidewhichBuy/Sellzonetoopen',options=['Inner','Outer'],group="CounterTradeSettings")
i_CTlongCloseCond=input.string('CrossTopMiddleBand','Closingconditionsforcounter-trendlongs',tooltip='-Cross-typecloseconditionsmarketclosepositiononcandleclosesaboveselectedregion\n\n-Touch-typeenabletrailinglimitordersthatfollowtheselectedregion',options=['CrossOuterBuyZone','CrossInnerBuyZone','TouchInnerBuyZone','CrossBottomMiddleBand','TouchBottomMiddleBand','CrossTopMiddleBand','TouchTopMiddleBand','CrossInnerSellZone','TouchInnerSellZone','CrossOuterSellZone','TouchOuterSellZone','FirstLeledc','FirstBBExhaustion'],group='CounterTradeSettings')
i_CTshortCloseCond=input.string('FirstLeledc','Closingconditionsforcounter-trendshorts',tooltip='-Cross-typecloseconditionsmarketclosepositiononcandleclosesbelowselectedregion\n\n-Touch-typeenabletrailinglimitordersthatfollowtheselectedregion',options=['CrossOuterSellZone','CrossInnerSellZone','TouchInnerSellZone','CrossTopMiddleBand','TouchTopMiddleBand','CrossBottomMiddleBand','TouchBottomMiddleBand','CrossInnerBuyZone','TouchInnerBuyZone','CrossOuterBuyZone','TouchOuterBuyZone','FirstLeledc','FirstBBExhaustion'],group='CounterTradeSettings')
i_CTlongSL=input.float(10,'Flatstop-loss%forcounter-trendlongs',0,100,0.1,'Input0todisablestop-lossforcounter-trendtrades.Enablingstop-losswillnotapplytomiddlebandbreakout,bounce,ordefaultpositionaltrades',group='CounterTradeSettings')
i_CTshortSL=input.float(10,'Flatstop-loss%forcounter-trendshorts',0,100,0.1,'Input0todisablestop-lossforcounter-trendtrades.Enablingstop-losswillnotapplytomiddlebandbreakout,bounce,ordefaultpositionaltrades',group='CounterTradeSettings')
//INPUT:KELTNERBUY/SELLZONES
s_keltnerBuySell=input.bool(false,'UseKeltnerchannelmultiplesfor"Buy/SellZones"',tooltip='Enablesinputtingcustommultiplesandadifferent/smoothercalculationof"Buy/SellZones".DefaultcalculationisamultipleofEMAbandhighsandlows',group='KeltnerBuy/SellZones')
i_mult=input.float(5.0,"OuterMultiplier",tooltip='Onlyfor"Buy/SellZones"calculatedbyKeltnerchannels',group='KeltnerBuy/SellZones')
i_innerMult=input.float(3.0,"InnerMultiplier",tooltip='Onlyfor"Buy/SellZones"calculatedbyKeltnerchannels',group='KeltnerBuy/SellZones')
//INPUT:VOLATILITYSQUEEZEFILTER
s_squeezeFilter=input.bool(false,'FilterouttradesduringBB-Keltnersqueezes',group='BB-Keltnersqueze')
i_bbCondition=input.string('AtLeastOne',title='BollingerBandCrossoverCondition',options=['Both','AtLeastOne'],group='BB-Keltnersqueze')
i_bbSqueezeLength=input.int(30,minval=1,title='BBLength',group='BB-Keltnersqueze')
i_ktSqueezeLength=input.int(18,minval=1,title='KeltnerLength',group='BB-Keltnersqueze')
s_useRes=input.bool(false,'Usecurrenttimeframe',group='BB-Keltnersqueze')
res=(s_useRes?'':input.timeframe('360','ResolutionforBB-Keltnersqueeze',group='BB-Keltnersqueze'))
i_B2mult=input.float(2,minval=0.001,maxval=50,title='BBStandardDeviation',group='BB-Keltnersqueze')
i_Kmult=input.float(1.5,title='KeltnerRange',group='BB-Keltnersqueze')
//INPUT:BOLLINGERBANDSEXHAUSTIONBARS
i_BBlength=input.int(20,minval=1,title='BollingerBandsSMAPeriodLength',group='BollingerBandsExhaustionBarSettings')
i_BBmult=input.float(1.8,minval=0.001,maxval=50,title='BollingerBandsStandardDeviation',group='BollingerBandsExhaustionBarSettings')
i_RSIlength=input.int(8,minval=1,step=1,title='RSIPeriodLength',group='BollingerBandsExhaustionBarSettings')
i_RSIos=input.int(30,minval=0,maxval=50,step=1,title='RSIOversoldValue',group='BollingerBandsExhaustionBarSettings')
i_RSIob=input.int(70,minval=50,maxval=100,step=1,title='RSIOverboughtvalue',group='BollingerBandsExhaustionBarSettings')
i_srcBB=input.source(close,title='Source',group='BollingerBandsExhaustionBarSettings')
//INPUT:LELEDC
i_leleVol=input.bool(false,'RequireVolumebreakoutforLeledcbars',group='LeledcExhaustionBarSettings')
i_volMult=input.float(1.5,'VolumeMultiplier',0.1,20,0.1,group='LeledcExhaustionBarSettings')
i_majLen=input.int(30,'Highest/Lowest',group='LeledcExhaustionBarSettings')
i_majQual=input.int(6,'Barcountno',group='LeledcExhaustionBarSettings')
i_closeVal=input.int(4,'Close',group='LeledcExhaustionBarSettings')
i_bindexSindex=input.int(1,'bindexSindex',group='LeledcExhaustionBarSettings')
//INPUT:VISUALELEMENTS
s_trendColor=input.bool(false,'EnableTrendBarColor',tooltip='Colorbarsgreenwhenabovemidbands,redwhenbelow,andgraywheninside.Darkgreenanddarkredbarssignalapositioniskeptopenfromthedelayedclosesettings.',group='VisualElements')
s_showBuySell=input.bool(true,'Show"Buy/SellZones"',group='VisualElements')
s_showEMA=input.bool(false,'ShowEMA',group='VisualElements')
s_showMiddleBands=input.bool(true,'ShowmiddleEMAbands',group='VisualElements')
s_showSlowEMA=input.bool(false,'ShowSlowEMA',group='VisualElements')
s_showMaj=input.bool(true,'ShowLeledcExhausionBars',group='VisualElements')
s_switch1=input.bool(true,'EnableBollingerBandsexhaustionbarcoloring',group='VisualElements')
s_switch2=input.bool(false,'EnableBollingerbandsexhaustionbarbackgroundcoloring',tooltip='EnablingthiscanhelpvisualizewhendialinginBollingerBandsandRSIsettings',group='VisualElements')
s_colorBuySellBars=input.bool(false,'EnableBuy/Sellzonefailurebarcoloring',group='VisualElements')
s_squeezeBG=input.bool(true,'Enablevolatilitysqueeze(BB-Keltner)backgroundcoloring',group='VisualElements')
//}
//VARIABLES:EMAandslowEMACALC{
EMA=ta.ema(close,i_EMAlength)
slowEMA=ta.ema(close,i_slowEMAlen)
plot(s_showSlowEMA?slowEMA:na)
//}
//*****************************
//SlumdogTrader'sBollingerBands+RSIDoubleStrategy-ProfitTrailer
//====================================================================================================//{
//BBVARIABLES
BBbasis=ta.sma(i_srcBB,i_BBlength)
BBdev=i_BBmult*ta.stdev(i_srcBB,i_BBlength)
BBupper=BBbasis+BBdev
BBlower=BBbasis-BBdev
//RSIVARIABLES
vrsi=ta.rsi(i_srcBB,i_RSIlength)
RSIoverSold=vrsi<i_RSIos
RSIoverBought=vrsi>i_RSIob
//BBEXHAUSTIONBARCOLORVARIABLE
OSOBcolor=
RSIoverBoughtandi_srcBB[1]>BBupperandi_srcBB<BBupper?color.yellow:
RSIoverSoldandi_srcBB[1]<BBlowerandi_srcBB>BBlower?color.blue:
na
//====================================================================================================//
//}
//KELTNERSELLZONE{
rangema=s_keltnerBuySell?ta.rma(high-low,i_EMAlength):0.0
kt_outersell(_ma)=>
upper=EMA+_ma*i_mult
upper
kt_innersell(_ma)=>
inner_upper=EMA+_ma*i_innerMult
inner_upper
kt_outerbuy(_ma)=>
lower=EMA-_ma*i_mult
lower
kt_innerbuy(_ma)=>
inner_lower=EMA-_ma*i_innerMult
inner_lower
//}
//*****************************
//BB-KeltnerSqueeze-FVBO-2.0
//ModifiedbyJuanCforFVBOStrategy,somesourcecodefromTrader-Elisa
//====================================================================================================//{
//VARIABLESFORHTFSOURCES
rp_security(_sym,_res,_src)=>
request.security(_sym,_res,_src[barstate.ishistory?0:1],gaps=barmerge.gaps_on)

srcClose=rp_security(syminfo.tickerid,res,close)
srcHigh=rp_security(syminfo.tickerid,res,high)
srcLow=rp_security(syminfo.tickerid,res,low)
//SQUEEZEBOLLINGERBANDS
B2basis=ta.sma(srcClose,i_bbSqueezeLength)
B2dev=i_B2mult*ta.stdev(srcClose,i_bbSqueezeLength)
B2upper=B2basis+B2dev
B2lower=B2basis-B2dev
//SQUEEZEKELTNERCHANNELS
Kma=ta.ema(srcClose,i_ktSqueezeLength)
Krange=srcHigh-srcLow
Krangema=ta.ema(Krange,i_ktSqueezeLength)
Kupper=Kma+Krangema*i_Kmult
Klower=Kma-Krangema*i_Kmult
//DEFINESQUEEZE
varboolsqueezing=false
ifs_squeezeFilter
ifi_bbCondition=='Both'ands_useRes
squeezing:=B2upper<=KupperandB2lower>=Klower?true:false
squeezing
elseifi_bbCondition=='AtLeastOne'ands_useRes
squeezing:=B2upper<=KupperorB2lower>=Klower?true:false
squeezing
elseifi_bbCondition=='Both'
squeezing:=
B2upper[ta.barssince(notsrcClose==barstate.isrealtime)]<=Kupper[ta.barssince(notsrcClose==barstate.isrealtime)]and
B2lower[ta.barssince(notsrcClose==barstate.isrealtime)]>=Klower[ta.barssince(notsrcClose==barstate.isrealtime)]?true:false
squeezing
else
squeezing:=
B2upper[ta.barssince(notsrcClose==barstate.isrealtime)]<=Kupper[ta.barssince(notsrcClose==barstate.isrealtime)]or
B2lower[ta.barssince(notsrcClose==barstate.isrealtime)]>=Klower[ta.barssince(notsrcClose==barstate.isrealtime)]?true:false
squeezing
//VISUAL
cross_over_color=(squeezing?color.new(color.aqua,90):na)
bgcolor(s_squeezeBG?cross_over_color:na)
bgcolor(s_switch2?color.new(OSOBcolor,70):na)
//}
//*****************************
//©Joy_BanglaLeledcExhaustionV4
//====================================================================================================//{
//min=input(false,'MinorLeledcExhaustionBar::Show')
//min_qual=input(5,'MinorLeledcExhausionBar::Barcountno')
//min_len=input(5,'MinorLeledcExhausionBar::Barcountno')
leleVol=volume>ta.sma(volume,100)*i_volMult
lele(qual,len)=>
bindex=0
sindex=0
bindex:=nz(bindex[i_bindexSindex],0)
sindex:=nz(sindex[i_bindexSindex],0)
ret=0
ifclose>close[i_closeVal]
bindex+=1
bindex
ifclose<close[i_closeVal]
sindex+=1
sindex

ifi_leleVolandnotleleVol
ret:=0
ret
else
ifbindex>qualandclose<openandhigh>=ta.highest(high,len)
bindex:=0
ret:=-1
ret
ifsindex>qualandclose>openandlow<=ta.lowest(low,len)
sindex:=0
ret:=1
ret
return_1=ret
return_1
major=lele(i_majQual,i_majLen)
//minor=lele(min_qual,min_len)
plotchar(s_showMaj?major==-1?high:na:na,char='•',location=location.absolute,color=color.new(color.red,0),size=size.small)
plotchar(s_showMaj?major==1?low:na:na,char='•',location=location.absolute,color=color.new(color.lime,0),size=size.small)
//plotchar(min?minor==1?high:na:na,char='x',location=location.absolute,color=color.new(color.red,0),size=size.small)
//plotchar(min?minor==-1?low:na:na,char='x',location=location.absolute,color=color.new(color.lime,0),size=size.small)
//leledcMajorBullish=major==1?low:na
//leledcMajorBearish=major==-1?high:na
//leledcMinorBullish=minor==1?low:na
//leledcMinorBearish=minor==-1?high:na
//==============================================//
//alertcondition(leledcMajorBullish,title='MajorBullishLeledc',message='MajorBullishLeledc')
//alertcondition(leledcMajorBearish,title='MajorBearishLeledc',message='MajorBearishLeledc')
//alertcondition(leledcMinorBullish,title='MinorBullishLeledc',message='MinorBullishLeledc')
//alertcondition(leledcMinorBearish,title='MinorBearishLeledc',message='MinorBearishLeledc')
//====================================================================================================//
//}
//*****************************
//©VishvaP34EMABandsv2
//====================================================================================================//{
//BUILDEMAMIDDLEBANDS
highShortEMA=ta.ema(high,i_EMAlength)
lowShortEMA=ta.ema(low,i_EMAlength)
middleBandTop=(highShortEMA-EMA)*i_topMBmult+EMA
middleBandBot=(lowShortEMA-EMA)*i_botMBmult+EMA
//==============================================//
//1DBands[NotUsed]
//bandsHigh=highShortEMA*math.phi
//bandsLow=lowShortEMA*math.rphi
//==============================================//
//INNERBUY/SELLZONES
shortbandsHigh=s_keltnerBuySell?kt_innersell(rangema):((highShortEMA-EMA)*math.phi*i_topMBmult)*math.pi+EMA
shortbandsLow=s_keltnerBuySell?kt_innerbuy(rangema):(-(EMA-lowShortEMA)*math.phi*i_botMBmult)*math.pi+EMA
//SMOOTHINNER
shortbandsHighEMA=ta.wma(shortbandsHigh,8)
shortbandsLowEMA=ta.wma(shortbandsLow,8)
//==============================================//
//OUTERBUY/SELLZONES
phiExtensionHigh=s_keltnerBuySell?kt_outersell(rangema):((highShortEMA-EMA)*math.phi*i_topMBmult)*(math.phi+4)+EMA
phiExtensionLow=s_keltnerBuySell?kt_outerbuy(rangema):(-(EMA-lowShortEMA)*math.phi*i_botMBmult)*(math.phi+4)+EMA
//SMOOTHOUTER
phiExtensionHighEMA=ta.wma(phiExtensionHigh,8)
phiExtensionLowEMA=ta.wma(phiExtensionLow,8)
//==============================================//
//PLOTMIDDLEBANDSANDEMA
highP1=plot(s_showMiddleBands?middleBandTop:na,color=color.new(color.blue,100),title="Topmedianzone")
lowP1=plot(s_showMiddleBands?middleBandBot:na,color=color.new(color.blue,100),title="Bottommedianzone")
plot(s_showEMA?EMA:na,color=color.new(color.gray,0),title="EMA")
//1Dbands[notused]
//highP2=plot(bandsHigh)
//lowP2=plot(bandsLow)
//PLOTBUY/SELLZONES
highP3=plot(s_showBuySell?shortbandsHighEMA:na,color=color.new(color.yellow,100),title="Lowersellzone")
lowP3=plot(s_showBuySell?shortbandsLowEMA:na,color=color.new(color.teal,100),title="Higherbuyzone")
phiPlotHigh=plot(s_showBuySell?phiExtensionHighEMA:na,color=color.new(color.red,100),title="Topsellzone")
phiPlotLow=plot(s_showBuySell?phiExtensionLowEMA:na,color=color.new(color.green,100),title="Bottombuyzone")
//==============================================//
//BUY/SELLZONEANDMIDDLEBANDCOLORFILLS
fill(phiPlotHigh,highP3,color.new(color.red,85),title="Sellzone")
fill(lowP3,phiPlotLow,color.new(color.green,85),title="Buyzone")
fill(highP1,lowP1,color.new(color.gray,70),title="Medianzone")
//====================================================================================================//
//}
//ASSIGNBANDSFORCOUNTERTRENDENTRIES{
floatCTbandTop=na
floatCTbandBottom=na
ifi_ctLeleBuySell=='Inner'
CTbandTop:=shortbandsHighEMA
CTbandBottom:=shortbandsLowEMA
else
CTbandTop:=phiExtensionHighEMA
CTbandBottom:=phiExtensionLowEMA
//}
//BUILDVARIABLESFORCROSSES{
crossUpTopMB=open<middleBandTopandclose>middleBandTop
wiggleUpTopMB=open>middleBandTopandclose>middleBandTopandclose[1]<=middleBandTop[1]
crossDownTopMB=open>middleBandTopandclose<middleBandTop
wiggleDownTopMB=open<middleBandTopandclose<middleBandTopandclose[1]>=middleBandTop[1]
crossUpBotMB=open<middleBandBotandclose>middleBandBot
wiggleUpBotMB=open>middleBandBotandclose>middleBandBotandclose[1]<=middleBandBot[1]
crossDownBotMB=open>middleBandBotandclose<middleBandBot
wiggleDownBotMB=open<middleBandBotandclose<middleBandBotandclose[1]>=middleBandBot[1]
crossUpBotInnerRB=open<shortbandsLowEMAandclose>shortbandsLowEMA
wiggleUpBotInnerRB=open>shortbandsLowEMAandclose>shortbandsLowEMAandclose[1]<=shortbandsLowEMA[1]
crossUpBotOuterRB=open<phiExtensionLowEMAandclose>phiExtensionLowEMA
wiggleUpBotOuterRB=open>phiExtensionLowEMAandclose>phiExtensionLowEMAandclose[1]<=phiExtensionLowEMA[1]
crossUpTopInnerRB=open<shortbandsHighEMAandclose>shortbandsHighEMA
wiggleUpTopInnerRB=open>shortbandsHighEMAandclose>shortbandsHighEMAandclose[1]<=shortbandsHighEMA[1]
crossUpTopOuterRB=open<phiExtensionHighEMAandclose>phiExtensionHighEMA
wiggleUpTopOuterRB=open>phiExtensionHighEMAandclose>phiExtensionHighEMAandclose[1]<=phiExtensionHighEMA[1]
crossDownBotInnerRB=open>shortbandsLowEMAandclose<shortbandsLowEMA
wiggleDownBotInnerRB=open<shortbandsLowEMAandclose<shortbandsLowEMAandclose[1]>=shortbandsLowEMA[1]
crossDownBotOuterRB=open>phiExtensionLowEMAandclose<phiExtensionLowEMA
wiggleDownBotOuterRB=open<phiExtensionLowEMAandclose<phiExtensionLowEMAandclose[1]>=phiExtensionLowEMA[1]
crossDownTopInnerRB=open>shortbandsHighEMAandclose<shortbandsHighEMA
wiggleDownTopInnerRB=open<shortbandsHighEMAandclose<shortbandsHighEMAandclose[1]>=shortbandsHighEMA[1]
crossDownTopOuterRB=open>phiExtensionHighEMAandclose<phiExtensionHighEMA
wiggleDownTopOuterRB=open<phiExtensionHighEMAandclose<phiExtensionHighEMAandclose[1]>=phiExtensionHighEMA[1]
//}
//VARIABLESFORBOUNCES{
longBounce=
nots_longBounce?false:
s_squeezeFilter?open>middleBandTopandclose>middleBandTopandlow<middleBandTopandsqueezing==false:
open>middleBandTopandclose>middleBandTopandlow<middleBandTop
shortBounce=
nots_shortBounce?false:
s_squeezeFilter?open<middleBandBotandclose<middleBandBotandhigh>middleBandBotandsqueezing==false:
open<middleBandBotandclose<middleBandBotandhigh>middleBandBot
//}
//BUILDVARIABLESFORCLOSINGCONDITIONS{
CTlongCloseCond=
i_CTlongCloseCond=='CrossInnerSellZone'?(crossUpTopInnerRBorwiggleUpTopInnerRB):
i_CTlongCloseCond=='CrossOuterSellZone'?(crossUpTopOuterRBorwiggleUpTopOuterRB):
i_CTlongCloseCond=='CrossTopMiddleBand'?(crossUpTopMBorwiggleUpTopMB):
i_CTlongCloseCond=='CrossBottomMiddleBand'?(crossUpBotMBorwiggleUpBotMB):
i_CTlongCloseCond=='CrossInnerBuyZone'?(crossUpBotInnerRBorwiggleUpBotInnerRB):
i_CTlongCloseCond=='CrossOuterBuyZone'?(crossUpBotOuterRBorcrossUpBotOuterRB):
i_CTlongCloseCond=='FirstLeledc'?major==-1:
i_CTlongCloseCond=='FirstBBExhaustion'?OSOBcolor==color.yellow:
na
CTlongTP=
i_CTlongCloseCond=='TouchInnerBuyZone'?shortbandsLowEMA:
i_CTlongCloseCond=='TouchTopMiddleBand'?middleBandTop:
i_CTlongCloseCond=='TouchBottomMiddleBand'?middleBandBot:
i_CTlongCloseCond=='TouchInnerSellZone'?shortbandsHighEMA:
i_CTlongCloseCond=='TouchOuterSellZone'?phiExtensionHighEMA:
na
CTshortCloseCond=
i_CTshortCloseCond=='CrossInnerBuyZone'?(crossDownBotInnerRBorwiggleDownBotInnerRB):
i_CTshortCloseCond=='CrossOuterBuyZone'?(crossDownBotOuterRBorwiggleDownBotOuterRB):
i_CTshortCloseCond=='CrossBottomMiddleBand'?(crossDownBotMBorwiggleDownBotMB):
i_CTshortCloseCond=='CrossTopMiddleBand'?(crossDownTopMBorwiggleDownTopMB):
i_CTshortCloseCond=='CrossInnerSellZone'?(crossDownTopInnerRBorwiggleDownTopInnerRB):
i_CTshortCloseCond=='CrossOuterSellZone'?(crossDownTopOuterRBorcrossDownTopOuterRB):
i_CTshortCloseCond=='FirstLeledc'?major==1:
i_CTshortCloseCond=='FirstBBExhaustion'?OSOBcolor==color.blue:
na
CTshortTP=
i_CTshortCloseCond=='TouchInnerSellZone'?shortbandsHighEMA:
i_CTshortCloseCond=='TouchBottomMiddleBand'?middleBandBot:
i_CTshortCloseCond=='TouchTopMiddleBand'?middleBandTop:
i_CTshortCloseCond=='TouchInnerBuyZone'?shortbandsLowEMA:
i_CTshortCloseCond=='TouchOuterBuyZone'?phiExtensionLowEMA:
na
shortMidBreak=
s_squeezeFilter?(crossDownBotMBorwiggleDownBotMB)andsqueezing==false:
crossDownBotMBorwiggleDownBotMB
longMidBreak=
s_squeezeFilter?(crossUpTopMBorwiggleUpTopMB)andsqueezing==false:
crossUpTopMBorwiggleUpTopMB
//}
//BASICSTRATEGYPOSITIONSOPEN
//LONGSOPEN{
ifs_needLong
ifs_useSlowEMA
iflongMidBreakandclose>slowEMAandopen<middleBandTop
strategy.close('Short',comment='CloseShort')
strategy.close('CounterTrendShort',comment='CloseCTShort')
strategy.close('DefaultShort',comment='CloseDefaultShort')
strategy.entry('Long',strategy.long)
elseiflongMidBreak
strategy.close('Short',comment='CloseShort')
strategy.close('CounterTrendShort',comment='CloseCTShort')
strategy.close('DefaultShort',comment='CloseDefaultShort')
strategy.entry('Long',strategy.long)
ifstrategy.position_size==0andlongBounce
ifs_useSlowEMA
ifclose>slowEMA
strategy.close('Short',comment='CloseShort')
strategy.close('CounterTrendShort',comment='CloseCTShort')
strategy.close('DefaultShort',comment='CloseDefaultShort')
strategy.entry('Long',strategy.long)
else
strategy.close('Short',comment='CloseShort')
strategy.close('CounterTrendShort',comment='CloseCTShort')
strategy.close('DefaultShort',comment='CloseDefaultShort')
strategy.entry('Long',strategy.long)
//}
//SHORTSOPEN{
ifs_needShort
ifs_useSlowEMA
ifshortMidBreakandclose<slowEMAandopen>middleBandBot
strategy.close('Long',comment='CloseLong')
strategy.close('CounterTrendLong',comment='CloseCTLong')
strategy.close('DefaultLong',comment='CloseDefaultLong')
strategy.entry('Short',strategy.short)
elseifshortMidBreak
strategy.close('Long',comment='CloseLong')
strategy.close('CounterTrendLong',comment='CloseCTLong')
strategy.close('DefaultLong',comment='CloseDefaultLong')
strategy.entry('Short',strategy.short)
ifstrategy.position_size==0andshortBounce
ifs_useSlowEMA
ifclose<slowEMA
strategy.close('Long',comment='CloseLong')
strategy.close('CounterTrendLong',comment='CloseCTLong')
strategy.close('DefaultLong',comment='CloseDefaultLong')
strategy.entry('Short',strategy.short)
else
strategy.close('Long',comment='CloseLong')
strategy.close('CounterTrendLong',comment='CloseCTLong')
strategy.close('DefaultLong',comment='CloseDefaultLong')
strategy.entry('Short',strategy.short)
//}
//COUNTLELEDCBARSBETWEENCURRENTBARANDPOSITIONOPEN{
//VARIABLES
intcountLongLele=0
intcountShortLele=0
intnumLele=switchi_whichLele
'First'=>1
'Second'=>2
'Third'=>3
'Fourth'=>4
'Fifth'=>5
inti=0
//COUNTLELESFORLONGS
ifstrategy.position_size>0
ifs_useLeleandnumLele>1
whilei<=200
ifstrategy.position_size[i]<=0
break
ifbar_index[i]==0
break
ifmajor[i]==-1
countLongLele+=1
ifcountLongLele==numLele
break
i+=1
//COUNTLELESFORSHORTS
ifstrategy.position_size<0
ifs_useLeleandnumLele>1
whilei<=200
ifstrategy.position_size[i]>=0
break
ifbar_index[i]==0
break
ifmajor[i]==1
countShortLele+=1
ifcountShortLele==numLele
break
i+=1
//}
//COUNTBBEXHAUSTIONBARSBETWEENCURRENTBARANDPOSITIONOPEN{
//VARIABLES
intcountLongBBs=0
intcountShortBBs=0
intnumBBs=switchi_whichBBext
'First'=>1
'Second'=>2
'Third'=>3
intn=0
//COUNTBBBARSFORLONGS
ifstrategy.position_size>0
ifs_useBBExtendandnumBBs>1
whilen<=200
ifstrategy.position_size[n]<=0
break
ifbar_index[n]==0
break
ifOSOBcolor[n]==color.yellow
countLongBBs+=1
ifcountLongBBs==numBBs
break
n+=1
//COUNTBBBARSFORSHORTS
ifstrategy.position_size<0
ifs_useBBExtendandnumBBs>1
whilen<=200
ifstrategy.position_size[n]>=0
break
ifbar_index[n]==0
break
ifOSOBcolor[n]==color.blue
countShortBBs+=1
ifcountShortBBs==numBBs
break
n+=1
//}
//VARIABLES:CONDITIONSOFLOSSOFBUY/SELLZONES{
varboolcrossUpRB=false
varboolwiggleUpRB=false
varboolcrossDownRB=false
varboolwiggleDownRB=false
ifs_whichBuySellBars=='Inner'
crossUpRB:=crossUpBotInnerRB
wiggleUpRB:=wiggleUpBotInnerRB
crossDownRB:=crossDownTopInnerRB
wiggleDownRB:=wiggleDownTopInnerRB
else
crossUpRB:=crossUpBotOuterRB
wiggleUpRB:=wiggleUpBotOuterRB
crossDownRB:=crossDownTopOuterRB
wiggleDownRB:=wiggleDownTopOuterRB
//}
//VARIABLES:reverBarColor{
reverBarColor=crossDownRBor(wiggleDownRBandnotcrossDownRB[1])?color.orange:
crossUpRBor(wiggleUpRBandnotcrossUpRB[1])?color.purple:
na
//}
//FUNCTION:isAllMid(){
//returntrueafterspecifiednumberofbars(i_numBars)closesinsidethemidbandsbutnobreakout
inMid=close>middleBandBotandclose<middleBandTopandopen>middleBandBotandopen<middleBandTop
isAllMid()=>
AllMid=true
fort=0toi_numBarsby1
iflongMidBreak[t]orshortMidBreak[t]
AllMid:=false
AllMid
//}
//BASICSTRATEGYPOSITIONSCLOSE
//LONGSCLOSE{
ifstrategy.position_size>0
ifs_buySellClose
ifreverBarColor==color.orange
strategy.close('Long',comment='CloseLong')
ifs_useBBExtendandnumBBs==1
ifOSOBcolor==color.yellow
strategy.close('Long',comment='CloseLong')
ifs_needCTshortandi_CTshortType=='BBExhaustion'
ifopen>CTbandTop
strategy.close('Long',comment='CloseLong')
strategy.close('CounterTrendLong',comment='CloseCTLong')
strategy.close('DefaultLong',comment='CloseDefaultLong')
strategy.entry('CounterTrendShort',comment='CTShort',direction=strategy.short)
ifs_useBBExtendandnumBBs>1
ifcountLongBBs==numBBs
strategy.close('Long',comment='CloseLong')
ifs_needCTshortandi_CTshortType=='BBExhaustion'
ifopen>CTbandTop
strategy.close('Long',comment='CloseLong')
strategy.close('CounterTrendLong',comment='CloseCTLong')
strategy.close('DefaultLong',comment='CloseDefaultLong')
strategy.entry('CounterTrendShort',comment='CTShort',direction=strategy.short)
ifs_useLeleandnumLele==1
ifmajor==-1
strategy.close('Long',comment='CloseLong')
ifs_needCTshortandi_CTshortType=='Leledc'
ifhigh>CTbandTop
strategy.close('Long',comment='CloseLong')
strategy.close('CounterTrendLong',comment='CloseCTLong')
strategy.close('DefaultLong',comment='CloseDefaultLong')
strategy.entry('CounterTrendShort',comment='CTShort',direction=strategy.short)
ifs_useLeleandnumLele>1
ifcountLongLele==numLele
strategy.close('Long',comment='CloseLong')
ifs_needCTshortandi_CTshortType=='Leledc'
ifhigh>CTbandTop
strategy.close('Long',comment='CloseLong')
strategy.close('CounterTrendLong',comment='CloseCTLong')
strategy.close('DefaultLong',comment='CloseDefaultLong')
strategy.entry('CounterTrendShort',comment='CTShort',direction=strategy.short)
ifi_midClose=='Nearestband'
ifcrossDownTopMBorwiggleDownTopMB
strategy.close('Long',comment='CloseLong')
ifi_midClose=='Oppositeband'
ifcrossDownBotMBorwiggleDownBotMB
strategy.close('Long',comment='CloseLong')
ifi_midClose=='Delayedbarsinside'
ifcrossDownBotMBorwiggleDownBotMB
strategy.close('Long',comment='CloseLong')
ifisAllMid()
ifopen[i_numBars]>middleBandTopandclose[i_numBars]<middleBandTopandinMid
strategy.close('Long',comment='CloseLong')
//}
//SHORTSCLOSE{
ifstrategy.position_size<0
ifs_buySellClose
ifreverBarColor==color.purple
strategy.close('Short',comment='CloseShort')
ifs_useBBExtendandnumBBs==1
ifOSOBcolor==color.blue
strategy.close('Short',comment='CloseShort')
ifs_needCTlongandi_CTlongType=='BBExhaustion'
ifopen<CTbandBottom
strategy.close('Short',comment='CloseShort')
strategy.close('CounterTrendShort',comment='CloseCTShort')
strategy.close('DefaultShort',comment='CloseDefaultShort')
strategy.entry('CounterTrendLong',comment='CTLong',direction=strategy.long)
ifs_useBBExtendandnumBBs>1
ifcountShortBBs==numBBs
strategy.close('Short',comment='CloseShort')
ifs_needCTlongandi_CTlongType=='BBExhaustion'
ifopen<CTbandBottom
strategy.close('Short',comment='CloseShort')
strategy.close('CounterTrendShort',comment='CloseCTShort')
strategy.close('DefaultShort',comment='CloseDefaultShort')
strategy.entry(id='CounterTrendLong',comment='CTLong',direction=strategy.long)
ifs_useLeleandnumLele==1
ifmajor==1
strategy.close('Short',comment='CloseShort')
ifs_needCTlongandi_CTlongType=='Leledc'
iflow<CTbandBottom
strategy.close('Short',comment='CloseShort')
strategy.close('CounterTrendShort',comment='CloseCTShort')
strategy.close('DefaultShort',comment='CloseDefaultShort')
strategy.entry(id='CounterTrendLong',comment='CTLong',direction=strategy.long)
ifs_useLeleandnumLele>1
ifcountShortLele==numLele
strategy.close('Short',comment='CloseShort')
ifs_needCTlongandi_CTlongType=='Leledc'
iflow<CTbandBottom
strategy.close('Short',comment='CloseShort')
strategy.close('CounterTrendShort',comment='CloseCTShort')
strategy.close('DefaultShort',comment='CloseDefaultShort')
strategy.entry(id='CounterTrendLong',comment='CTLong',direction=strategy.long)
ifi_midClose=='Nearestband'
ifcrossUpBotMBorwiggleUpBotMB
strategy.close('Short',comment='CloseShort')
ifi_midClose=='Oppositeband'
ifcrossUpTopMBorwiggleUpTopMB
strategy.close('Short',comment='CloseShort')
ifi_midClose=='Delayedbarsinside'
ifcrossUpTopMBorwiggleUpTopMB
strategy.close('Short',comment='CloseShort')
ifisAllMid()
ifopen[i_numBars]<middleBandBotandclose[i_numBars]>middleBandBotandinMid
strategy.close('Short',comment='CloseShort')
//}
//COUNTERTRENDSTRATEGYPOSITIONSOPENANDCLOSE{
//VARIABLESFORCTSTOPLOSSES
CTlongSL=strategy.position_avg_price*(1-i_CTlongSL/100)
CTshortSL=strategy.position_avg_price*(1+i_CTshortSL/100)
//CTLONGSOPEN
ifs_needCTlongandstrategy.position_size==0and(nots_squeezeFilterornotsqueezing)
ifi_CTlongType=='Leledc'
ifmajor==1
iflow<CTbandBottom
strategy.close('Short',comment='CloseShort')
strategy.close('CounterTrendShort',comment='CloseCTShort')
strategy.close('DefaultShort',comment='CloseDefaultShort')
strategy.entry('CounterTrendLong',comment='CTLong',direction=strategy.long)
else
ifOSOBcolor==color.blue
strategy.close('Short',comment='CloseShort')
strategy.close('CounterTrendShort',comment='CloseCTShort')
strategy.close('DefaultShort',comment='CloseDefaultShort')
strategy.entry('CounterTrendLong',comment='CTLong',direction=strategy.long)
//CTLONGSCLOSED
ifstrategy.position_size>0andstrategy.opentrades.entry_id(strategy.opentrades-1)=='CounterTrendLong'
ifi_CTlongSL>0
ifna(CTlongTP)
strategy.exit(id='CounterTrendLong',stop=CTlongSL,comment='CTLongSL')
else
strategy.exit(id='CounterTrendLong',stop=CTlongSL,limit=CTlongTP,comment='CTLongTP/SL')
elseifi_CTlongSL==0
strategy.exit(id='CounterTrendLong',limit=CTlongTP,comment='CTLongTP')
ifCTlongCloseCond
strategy.close(id='CounterTrendLong',comment='CloseCTLong')
//CTSHORTSOPEN
ifs_needCTshortandstrategy.position_size==0and(nots_squeezeFilterornotsqueezing)
ifi_CTshortType=='Leledc'
ifmajor==-1
ifhigh>CTbandTop
strategy.close('Long',comment='CloseLong')
strategy.close('CounterTrendLong',comment='CloseCTLong')
strategy.close('DefaultLong',comment='CloseDefaultLong')
strategy.entry('CounterTrendShort',comment='CTShort',direction=strategy.short)
else
ifOSOBcolor==color.yellow
strategy.close('Long',comment='CloseLong')
strategy.close('CounterTrendLong',comment='CloseCTLong')
strategy.close('DefaultLong',comment='CloseDefaultLong')
strategy.entry('CounterTrendShort',comment='CTShort',direction=strategy.short)
//CTSHORTSCLOSE
ifstrategy.position_size<0andstrategy.opentrades.entry_id(strategy.opentrades-1)=='CounterTrendShort'
ifi_CTshortSL>0
ifna(CTshortTP)
strategy.exit(id='CounterTrendShort',stop=CTshortSL,comment='CTShortSL')
else
strategy.exit(id='CounterTrendShort',stop=CTshortSL,limit=CTshortTP,comment='CTShortTP/SL')
elseifi_CTshortSL==0
strategy.exit(id='CounterTrendShort',limit=CTshortTP,comment='CTShortTP')
ifCTshortCloseCond
strategy.close(id='CounterTrendShort',comment="CloseCTShort")
//}
//DEFAULTPOSITIONINGSTRATEGYOPENS{
ifs_alwaysLongandnots_alwaysShortandstrategy.position_size==0
ifs_useSlowEMA
ifclose>slowEMA
strategy.entry(id='DefaultLong',comment='DefaultLong',direction=strategy.long)
else
strategy.entry(id='DefaultLong',comment='DefaultLong',direction=strategy.long)
ifs_alwaysShortandnots_alwaysLongandstrategy.position_size==0
ifs_useSlowEMA
ifclose<slowEMA
strategy.entry(id='DefaultShort',comment='DefaultShort',direction=strategy.short)
else
strategy.entry(id='DefaultShort',comment='DefaultShort',direction=strategy.short)
//}
//SETBARCOLORS{
varcolorBar=color.new(color.white,50)
ifs_trendColor
ifs_switch1
ifs_colorBuySellBars
ifreverBarColor==color.purpleorreverBarColor==color.orange
colorBar:=reverBarColor
elseifOSOBcolor==color.yelloworOSOBcolor==color.blue
colorBar:=OSOBcolor
elseifclose>middleBandTop
if(s_alwaysShortors_needCTshort)andstrategy.position_size<0
colorBar:=color.new(color.red,0)
else
colorBar:=color.new(color.green,0)
elseifclose<middleBandBot
if(s_alwaysLongors_needCTlong)andstrategy.position_size>0
colorBar:=color.new(color.green,0)
else
colorBar:=color.new(color.red,0)
elseifstrategy.position_size>0and(i_midClose=='Delayedbarsinside'ori_midClose=='Oppositeband')
colorBar:=color.new(#0a6136,20)
elseifstrategy.position_size<0and(i_midClose=='Delayedbarsinside'ori_midClose=='Oppositeband')
colorBar:=color.new(#600008,20)
else
colorBar:=color.new(color.gray,0)
else
ifOSOBcolor==color.yelloworOSOBcolor==color.blue
colorBar:=OSOBcolor
elseifclose>middleBandTop
if(s_alwaysShortors_needCTshort)andstrategy.position_size<0
colorBar:=color.new(color.red,0)
else
colorBar:=color.new(color.green,0)
elseifclose<middleBandBot
if(s_alwaysLongors_needCTlong)andstrategy.position_size>0
colorBar:=color.new(color.green,0)
else
colorBar:=color.new(color.red,0)
elseifstrategy.position_size>0and(i_midClose=='Delayedbarsinside'ori_midClose=='Oppositeband')
colorBar:=color.new(#0a6136,20)
elseifstrategy.position_size<0and(i_midClose=='Delayedbarsinside'ori_midClose=='Oppositeband')
colorBar:=color.new(#600008,20)
else
colorBar:=color.new(color.gray,0)
elseifs_colorBuySellBars
ifreverBarColor==color.purpleorreverBarColor==color.orange
colorBar:=reverBarColor
elseifclose>middleBandTop
if(s_alwaysShortors_needCTshort)andstrategy.position_size<0
colorBar:=color.new(color.red,0)
else
colorBar:=color.new(color.green,0)
elseifclose<middleBandBot
if(s_alwaysLongors_needCTlong)andstrategy.position_size>0
colorBar:=color.new(color.green,0)
else
colorBar:=color.new(color.red,0)
elseifstrategy.position_size>0and(i_midClose=='Delayedbarsinside'ori_midClose=='Oppositeband')
colorBar:=color.new(#0a6136,20)
elseifstrategy.position_size<0and(i_midClose=='Delayedbarsinside'ori_midClose=='Oppositeband')
colorBar:=color.new(#600008,20)
else
colorBar:=color.new(color.gray,0)
else
ifclose>middleBandTop
if(s_alwaysShortors_needCTshort)andstrategy.position_size<0
colorBar:=color.new(color.red,0)
else
colorBar:=color.new(color.green,0)
elseifclose<middleBandBot
if(s_alwaysLongors_needCTlong)andstrategy.position_size>0
colorBar:=color.new(color.green,0)
else
colorBar:=color.new(color.red,0)
elseifstrategy.position_size>0and(i_midClose=='Delayedbarsinside'ori_midClose=='Oppositeband')
colorBar:=color.new(#0a6136,20)
elseifstrategy.position_size<0and(i_midClose=='Delayedbarsinside'ori_midClose=='Oppositeband')
colorBar:=color.new(#600008,20)
else
colorBar:=color.new(color.gray,0)
elseifs_switch1
ifs_colorBuySellBars
ifreverBarColor==color.purpleorreverBarColor==color.orange
colorBar:=reverBarColor
elseifOSOBcolor==color.yelloworOSOBcolor==color.blue
colorBar:=OSOBcolor
else
colorBar:=na
else
ifOSOBcolor==color.yelloworOSOBcolor==color.blue
colorBar:=OSOBcolor
else
colorBar:=na
elseifs_colorBuySellBars
ifreverBarColor==color.purpleorreverBarColor==color.orange
colorBar:=reverBarColor
else
colorBar:=na
else
colorBar:=na
barcolor(colorBar)
//}
Expand (846 lines)
