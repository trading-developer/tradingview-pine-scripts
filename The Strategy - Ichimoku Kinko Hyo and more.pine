Script Name: The Strategy - Ichimoku Kinko Hyo and more
Author: ramsay09
Description: The purpose of this strategy is to make the signals from my scripts available for verification by backtests. Different signal and filter combinations can be created and specific manual parameter optimization can be carried out.

In detail, this strategy includes:

23 entry signals
two entry filters with each 9 filters
two exit filters with each 9 filters
take...
PineScript code:

Pine Scriptâ„¢ strategy
The Strategy - Ichimoku Kinko Hyo and more
//  This  source  code  is  subject  to  the  terms  of  the  Mozilla  Public  License  2.0  at  https://mozilla.org/MPL/2.0/
//@version=5
strategy(title='The  Strategy  -  Ichimoku  Kinko  Hyo  and  more',  shorttitle='Strategy',  overlay=true,  initial_capital=10000,  pyramiding=1,  default_qty_type=strategy.fixed,  default_qty_value=0.05,  currency=currency.USD,
                          commission_type=strategy.commission.percent,  commission_value=0.075,  margin_long=0,  margin_short=0)
//--------------------------------------------------------------------  inputs  ---------------------------------------------------------------
general_info                =  input.bool(title='General  Description',  defval=false,
                                          tooltip='This  script  offers  you  the  opportunity  to  backtest  many  signals  and  filters  to  compare  the  results.    Make  yourself  familiar  with  the  signals  and  the  options  and  become  creative  ...
                                          At  least  you  will  be  able  to  see  what  and  on  what  circumstances  works  or  not.  Note  the  \'KISS\'  principle  and  that  \'context\'  matters.
                                          The  key  feature  of  technical  analysis  is  that  every  market  participant  is  an  interface  to  the  world  or  market-environment  and  all  market  relevant  information  is  visible  in  the  chart.
                                          The  default  values  are  suitable  for  Bitcoin  on  ByBit  (one  tick  =  0.5).  Deselect  \'Signal  Labels\'  at  strategy  properties  ->  Style  to  avoid  signal  label  strings.')
entry_type                    =  input.string('Both',  title='Position  Entry-Direction',  options=['Both',  'Long',  'Short'],
                                          tooltip='Long=  long  entries  only,  Short=  short  entries  only,  Both=  long  and  short  entries  are  possible.')
repaint                          =  input.string('Allowed',  title='Repainting',  options=['Not  allowed',  'Allowed'],
                                          tooltip='If  repainting  "Not  allowed"  is  selected,  then  signals  from  higher  time  frames  have  a  lag  of  an  additional  bar  from  the  higher  time  frame  but  you  trade  what  you  have  backtested.
                                          Otherwise  singals  can  occure  multiple  times  as  long  as  the  higher  time  frame  bar  is  not  closed  but  the  first  signal  of  these  possible  multiple  signals  is  much  earlier.')
panel                              =  input.bool(true,  title='Plot  Info  Panel',  tooltip='Info  panel  for  current  unrealized  profit  or  loss  for  the  open  position')
plot_avg_price            =  input.bool(true,  title='Plot  Position  Avarage  Price  Line.',
                                          tooltip='This  plots  the  position  avarage  price  line.')
one_side_pyr                =  input.bool(title='Pyramiding  Mode',  defval=false,
                                          tooltip='If  disabled:  as  long  as  the  signal  is  valid  a  new  trade  can  be  opened  on  each  bar  (more  filter  sensitive).  If  not  \'Both\'  as  direction  is  selected,
                                          the  opposite  signal  closes  the  current  position.  If  enabled:  a  new  trade  is  opened  with  every  signal.  Use  Properties  ->  Pyramiding  to  increase  the  maximum  amount  of  orders.')
htf_entr_opt_1            =  input.string('Current',  title='Time  Frame  -  1st  ENTRY  SIGNAL',  options=['Current',  '5m',  '10m',  '15m',  '30m',  '1H',  '2H',  '3H',  '4H',  '6H',  '12H',  'D',  '3D',  'W',  'M'],
                                          tooltip='Choose  always  a  higher  time  frame  than  the  current.  Lower  time  frames  than  the  current  may  result  in  false  values.',  group='entry  signals:')
htf_entr_opt_2            =  input.string('Current',  title='Time  Frame  -  2nd  ENTRY  SIGNAL',  options=['Current',  '5m',  '10m',  '15m',  '30m',  '1H',  '2H',  '3H',  '4H',  '6H',  '12H',  'D',  '3D',  'W',  'M'],
                                          tooltip='Choose  always  a  higher  time  frame  than  the  current.  Lower  time  frames  than  the  current  may  result  in  false  values.',  group='entry  signals:')
X_opt                              =  input.string('Price  X  Kumo  sig',  title='---  1st  ENTRY  SIGNAL  ---',  options=['---',  'Fractals  trend  lines  sig  (no  tf  filter)',  'Segments  sig  (no  tf  filter)',
                                          'DMI  ADX  classic  sig',  'DMI  ADX  mod  sig',  'DMI  ADX-slope  sig',  'EMA1  x  EMA2  sig',  'TRIX  slope  sig',  'ALMA  slope  sig',  'MACD(fast)  slope  sig',  'HMA  slope  sig',
                                          'Grid  -  reentry  sig  (no  tf  filter)',  'Grid  -  counter  trend  sig  (no  tf  filter)',  'Pin  bar  sig',  'Inside  bar  sig',  'Outside  bar  sig',  'Sandwich  bar  sig',  'Bar  breakout  1  sig',  'Bar  breakout  2  sig',
                                          'Higher-low/lower-high  bar  sig',  'Entry  on  every  bar-open  sig',  'Fractals  sig',  'Reverse  fractal  sig',  'SMA  sig',
                                          'RSI50  sig',  'Parabolic  SAR  sig',  'SuperTrend  sig',  'Price  X  Kijun  sig',  'Price  X  Kumo  sig',  'Kumo  flip  sig',
                                          'Chikou  X  price  sig',  'Chikou  X  Kumo  sig',  'Price  X  Tenkan  sig',  'Tenkan  X  Kumo  sig',  'Tenkan  X  Kijun  sig',  'CB/CS  sig  (no  tf  filter)',  'IB/IS  sig  (no  tf  filter)',  'B1/S1  sig',  'B2/S2  sig'],
                                          tooltip='Various  entry  signals.  1st  ENTRY  SIGNAL  and  2nd  ENTRY  SIGNAL  are  OR  connected.',  group='entry  signals:')
X_opt_2  =input.string('---',title='---2ndENTRYSIGNAL---(EnablePyramidingMode)',options=['---','Fractalstrendlinessig(notffilter)','Segmentssig(notffilter)',
'DMIADXclassicsig','DMIADXmodsig','DMIADX-slopesig','EMA1xEMA2sig','TRIXslopesig','ALMAslopesig','MACD(fast)slopesig','HMAslopesig',
'Grid-reentrysig(notffilter)','Grid-countertrendsig(notffilter)','Pinbarsig','Insidebarsig','Outsidebarsig','Sandwichbarsig','Barbreakout1sig','Barbreakout2sig',
'Higher-low/lower-highbarsig','Entryoneverybar-opensig','Fractalssig','Reversefractalsig','SMAsig',
'RSI50sig','ParabolicSARsig','SuperTrendsig','PriceXKijunsig','PriceXKumosig','Kumoflipsig',
'ChikouXpricesig','ChikouXKumosig','PriceXTenkansig','TenkanXKumosig','TenkanXKijunsig','CB/CSsig(notffilter)','IB/ISsig(notffilter)','B1/S1sig','B2/S2sig'],
tooltip='Variousentrysignals.Signal1andsignal2areORconnected.Workswithpyramidingmodeonly',group='entrysignals:')
htf_filt_opt_1=input.string('Current',title='TimeFrame-EntryFilter1',options=['Current','5m','10m','15m','30m','1H','2H','3H','4H','6H','12H','D','3D','W','M'],
tooltip='Thetimeframeforthe1stENTRYSIGNALfilter.Choosealwaysahighertimeframethanthecurrent.Lowertimeframesthanthecurrentmayresultinfalsevalues.',group='Entryfilters:')
htf_filt_opt_2=input.string('Current',title='TimeFrame-EntryFilter2',options=['Current','5m','10m','15m','30m','1H','2H','3H','4H','6H','12H','D','3D','W','M'],
tooltip='Thetimeframeforthe2stENTRYSIGNALfilter.Choosealwaysahighertimeframethanthecurrent.Lowertimeframesthanthecurrentmayresultinfalsevalues.',group='Entryfilters:')
entry_f_1=input.string('---',title='EntryFilter1',options=['---','Fractalstrendlinesfilter(notffilter)','Barbreakout1filter','Barbreakout2filter','SMAfilter','MACDfilter',
'EMA1xEMA2filter','RSIStochasticfilter','TRIXslopefilter','ALMAslopefilter','HMAslopefilter',
'MACD(fast)slopefilter','RSI50filter','Segmentsfilter(notffilter)','Reversefractalfilter','Fractalsfilter',
'SuperTrendfilter','ParabolicSARfilter','ADXThresholdfilter','DMIfilter','PriceXKumofilter','PriceXKijunfilter','Kumoflipfilter','PricefilteredKumoflipfilter(notffilter)',
'ChikouXpricefilter','ChikouXKumofilter','PriceXTenkanfilter','TenkanXKumofilter','TenkanXKijunfilter','B1/S1sig','B2/S2sig','IB/ISsig(notffilter)'],group='Entryfilters:',
tooltip='Variousentryfiltersignals.Entryfilter1andEntryfilter2areANDconnected.')
entry_f_2=input.string('---',title='EntryFilter2',options=['---','Fractalstrendlinesfilter(notffilter)','Barbreakout1filter','Barbreakout2filter','SMAfilter','MACDfilter',
'EMA1xEMA2filter','RSIStochasticfilter','TRIXslopefilter','ALMAslopefilter','HMAslopefilter',
'MACD(fast)slopefilter','RSI50filter','Segmentsfilter(notffilter)','Reversefractalfilter','Fractalsfilter',
'SuperTrendfilter','ParabolicSARfilter','ADXThresholdfilter','DMIfilter','PriceXKumofilter','PriceXKijunfilter','Kumoflipfilter','PricefilteredKumoflipfilter(notffilter)',
'ChikouXpricefilter','ChikouXKumofilter','PriceXTenkanfilter','TenkanXKumofilter','TenkanXKijunfilter','B1/S1sig','B2/S2sig','IB/ISsig(notffilter)'],group='Entryfilters:',
tooltip='Variousentryfiltersignals.Filter1andfilter2areANDconnected.')
htf_exit_opt_1=input.string('Current',title='TimeFrame-ExitFilter1',options=['Current','5m','10m','15m','30m','1H','2H','3H','4H','6H','12H','D','3D','W','M'],
tooltip='Choosealwaysahighertimeframethanthecurrent.Lowertimeframesthanthecurrentmayresultinfalsevalues.',group='exitfilters:')
htf_exit_opt_2=input.string('Current',title='TimeFrame-ExitFilter2',options=['Current','5m','10m','15m','30m','1H','2H','3H','4H','6H','12H','D','3D','W','M'],
tooltip='Choosealwaysahighertimeframethanthecurrent.Lowertimeframesthanthecurrentmayresultinfalsevalues.',group='exitfilters:')
exit_f_1=input.string('---',title='ExitFilter1',options=['---','Reversebarexit','Reversefractalexit','Barbreakout2exit','SMAexit','MACDexit','MACD(fast)slopeexit','RSI50exit',
'RSIStochasticexit','TRIXslopeexit',
'HMAslopeexit','EMA1xEMA2exit','Fractalsexit','SuperTrendexit','ParabolicSARexit','ADXThresholdexit','Cloudexit','Kijunexit','IB/ISexit(notffilter)'],group='exitfilters:',
tooltip='Someexitfiltersignals.Exitfilter1andExitfilter2areORconnected.')
exit_f_2=input.string('---',title='ExitFilter2',options=['---','Reversebarexit','Reversefractalexit','Barbreakout2exit','SMAexit','MACDexit','MACD(fast)slopeexit','RSI50exit',
'RSIStochasticexit','TRIXslopeexit',
'HMAslopeexit','EMA1xEMA2exit','Fractalsexit','SuperTrendexit','ParabolicSARexit','ADXThresholdexit','Cloudexit','Kijunexit','IB/ISexit(notffilter)'],group='exitfilters:',
tooltip='Someexitfiltersignals.Exitfilter1andExitfilter2areORconnected.')
//------------------------lotsizeforlivetrading--------------------------
//AlertatronlotsizeonBybit
lot_size=input.int(300,title='LotSize',minval=1,step=100,
tooltip='AlertatronlotsizestringforBybitexchange.Affectslivetradingonly.',group='LivetradingParameter(doesnotaffectbacktesting):')
grid_gap=input.float(500,title='GridGap-BaseCurrency',minval=1,step=50,group='Gridparameter:',tooltip='Theminimumtrigger-gapbetweentwotradesincaseofaselectedgridsignal.')
//------------------------Backtestperiodeinputs----------------------------
period_start=input.time(title='',inline='start_timestamp',defval=timestamp('13Mar202000:00+0000'),group='Definethebacktestperiodorstartoftrend:',tooltip='Backtestperiodstart.')
period_stop=input.time(title='',inline='end_timestamp',defval=timestamp('31Dec212000:00+0000'),group='Definethebacktestperiodorstartoftrend:',tooltip='Backtestperiodend.')
//----------------------takeprofitinputs-----------------------------
av_tp_en=input.bool(title='EnabletakeProfit-AveragePositionPriceProfit',defval=true,group='Takeprofitbasedonaveragepositionprice:',tooltip='Profittakingcondition:
currentprice>=averagepositionpriceofpositions+ATR')
av_tp_qty=input.float(10,title='TakeAveragePositionPriceProfit-QuantityOfPosition(Percent)',minval=1,step=5,maxval=100,group='Takeprofitbasedonaveragepositionprice:',
tooltip='Reductionofthecurrentpositioninpercent.')
atr_l=input.int(50,title='ATRLength',minval=0,step=5,group='Takeprofitbasedonaveragepositionprice:',
tooltip='ATRlengthforprofitandstepcalculation')
atr_tf=input.string('W',title='ATRTimeFrame',options=['60','120','240','480','960','D','3D','W','M'],group='Takeprofitbasedonaveragepositionprice:',
tooltip='ATRtimeframeforprofitandstepcalculation')
atr_fact=input.float(1,title='ATRFactor',minval=0,step=0.1,group='Takeprofitbasedonaveragepositionprice:',
tooltip='ATRfactortoincrease/decreaseATRforprofitandstepcalculation')
//----------------------stoplossinputs--------------------------
sl_en=input.bool(title='EnableStopLoss-AveragePositionPriceLoss',defval=true,group='Stoplossbasedonaveragepositionprice:',
tooltip='Stoplosscondition:currentprice<=averagepositionpriceofpositions-\'Stopaverage-entryloss...\'ANDcurrentprice<=averagepositionpriceofpositions-
\'Stoplossstep...\'')
av_sl_qty=input.float(50,title='StopAveragePositionPriceLoss-QuantityOfPosition(Percent)',minval=0,step=5,maxval=100,group='Stoplossbasedonaveragepositionprice:',
tooltip='Reductionofthecurrentpositioninpercent.')
atr_l_l=input.int(50,title='ATRLength',minval=0,step=5,group='Stoplossbasedonaveragepositionprice:',tooltip='ATRlengthforlossandstepcalculation')
atr_tf_l=input.string('W',title='ATRTimeFrame',options=['60','120','240','480','960','D','3D','W','M'],group='Stoplossbasedonaveragepositionprice:',
tooltip='ATRtimeframeforlossandstepcalculation')
atr_fact_l=input.float(1,title='ATRFactor',minval=0,step=0.1,group='Stoplossbasedonaveragepositionprice:',tooltip='ATRfactortoincrease/decreaseATRforlossandstepcalculation')
//------------------------SignalinputsCB/CSandIB/IS---------------------------
trig_gap_cbcs=input.float(2,title='CB/CSSignalOffset',minval=-6,maxval=9,step=1,group='Confluencesignaloffsets:',tooltip='Decreasingthisparameterincreasesthesensitivityofthesignal.')
trig_gap_ibis=input.float(0,title='IB/ISSignalOffset',minval=-5,maxval=4,step=1,group='Confluencesignaloffsets:',tooltip='Decreasingthisparameterincreasesthesensitivityofthesignal.')
//-----------------------entrysignalsandfilters-----------------------
sb=input.int(10,title='SegmentMaxBars',minval=0,step=1,group='Sharedfilterandentrysignalparameters:')
p_bar_sens_1=input.float(0.6,title='PinBarSensitivity1',step=0.02,tooltip='Condition:candlewick>candlebody*\'Pinbarsensitivity\'.
Thesmallerthefactor,themorewicksaredetectedaspartofapinbar.',group='Sharedfilterandentrysignalparameters:')
p_bar_sens_2=input.int(1,title='PinBarSensitivity2',step=1,minval=1,tooltip='Condition:high/low><lasttwohigh/low\'.',group='Sharedfilterandentrysignalparameters:')
fr_period=input.int(2,title='FractalsPeriod',minval=1,group='Sharedfilterandentrysignalparameters:')
rsi_period=input.int(14,title='RSIPeriod',minval=1,group='Sharedfilterandentrysignalparameters:')
ma_period=input.int(50,title='SMAPeriod',minval=1,step=5,group='Sharedfilterandentrysignalparameters:')
mult=input.float(3,title='SuperTrendMultiplier',minval=1,step=0.2,group='Sharedfilterandentrysignalparameters:')
len=input.int(6,title='SuperTrendLength',minval=1,group='Sharedfilterandentrysignalparameters:')
start=0.02//input(0.02,title="PSARStart(Filter/Entry)",minval=0)
inc=0.02//input(0.02,title="PSARIncrement(Filter/Entry)",minval=0)
max=0.2//input(.2,title="PSARMaximum(Filter/Entry)",minval=0)
di_length_s=input.int(10,title='ADXDILength',minval=1,group='Sharedfilterandentrysignalparameters:')
adx_smooth_s=input.int(10,title='ADXSmooth',minval=1,group='Sharedfilterandentrysignalparameters:')
adx_thres_s=input.int(25,title='ADXThreshold',step=2,minval=1,group='Sharedfilterandentrysignalparameters:')
windowsize=input.int(9,title="ALMAWindowSize",minval=1,step=1,group='Sharedfilterandentrysignalparameters:',tooltip='')
offset=input.float(0.85,title="ALMAOffset",minval=0,step=0.05,group='Sharedfilterandentrysignalparameters:',tooltip='')
sigma=input.float(6,title="ALMASigma",minval=1,step=1,group='Sharedfilterandentrysignalparameters:',tooltip='')
slope_len=input.int(1,minval=1,title='MACDMacdlLineSlopeLenth',tooltip='MACD\'sfastline',group='Sharedfilterandentrysignalparameters:')
hma_len_f=input.int(100,minval=1,step=5,title='HMALength',group='Sharedfilterandentrysignalparameters:')
ema1_len_f=input.int(10,minval=1,step=2,title='EMA1Length',group='Sharedfilterandentrysignalparameters:')
ema2_len_f=input.int(20,minval=1,step=2,title='EMA2Length',group='Sharedfilterandentrysignalparameters:')
k_smoo_f=input.int(3,title='RSI-StochK-line',minval=1,tooltip='RSIStochastic\'sfastline',group='Sharedfilterandentrysignalparameters:')
d_smoo_f=input.int(3,title='RSI-StochD-line',minval=1,tooltip='RSIStochastic\'sslowline',group='Sharedfilterandentrysignalparameters:')
stoch_length_f=input.int(14,title='RSI-StochStochasticLength',minval=1,group='Sharedfilterandentrysignalparameters:')
rsi_length_sto_f=input.int(14,title='RSI-StochRSILength',minval=1,group='Sharedfilterandentrysignalparameters:')
trix_len_f=input.int(10,title="TRIXLength",minval=1,group='Sharedfilterandentrysignalparameters:')
//exitfilters
fr_period_x=input.int(2,title='ExitFractals-Period',minval=1,group='ExitfilterParameters:')
fr_past_x=input.int(0,title='ExitFractals-PastFractal',minval=0,group='ExitfilterParameters:')
rsi_period_x=input.int(14,title='ExitRSIPeriod',minval=1,group='ExitfilterParameters:')
ma_period_x=input.int(50,title='ExitSMAPeriod',step=5,minval=1,group='ExitfilterParameters:')
mult_x=input.float(2,title='ExitSuperTrendMultiplier',minval=1,group='ExitfilterParameters:')
len_x=input.int(5,title='ExitSuperTrendLength',minval=1,group='ExitfilterParameters:')
di_length_x=input.int(10,title='ExitADXPeriod',minval=1,group='ExitfilterParameters:')
adx_smooth_x=input.int(10,title='ExitADXSmooth',minval=1,group='ExitfilterParameters:')
adx_thres_x=input.int(25,title='ExitADXThreshold',step=2,minval=1,group='ExitfilterParameters:')
slope_len_x=input.int(1,title='ExitMACDMacdlLineSlopeLenth',minval=1,tooltip='MACD\'sfastline',group='ExitfilterParameters:')
hma_len_x=input.int(100,minval=1,step=5,title='ExitHMALength',group='ExitfilterParameters:')
ema1_len_x=input.int(10,title='ExitEMA1Length',minval=1,step=2,group='ExitfilterParameters:')
ema2_len_x=input.int(20,title='ExitEMA2Length',minval=1,step=2,group='ExitfilterParameters:')
k_smoo_x=input.int(3,title='ExitRSI-StochK-line',minval=1,tooltip='RSIStochastic\'sfastline',group='ExitfilterParameters:')
d_smoo_x=input.int(3,title='ExitRSI-StochD-line',minval=1,tooltip='RSIStochastic\'sslowline',group='ExitfilterParameters:')
stoch_length_x=input.int(14,title='ExitRSI-StochStochasticLength',minval=1,group='ExitfilterParameters:')
rsi_length_sto_x=input.int(14,title='ExitRSI-StochRSILength',minval=1,group='ExitfilterParameters:')
trix_len_x=input.int(10,title="ExitTRIXLength",minval=1,group='ExitfilterParameters:')
//---------------Currentunrealizedprofitorlossfortheopenposition-------------------
ifpanel
varinfo_panel=table.new(position=position.bottom_left,columns=1,rows=1,bgcolor=color.new(color.blue,92),frame_width=1,border_width=1)
text1="UnrealizedProfit/Loss:\n"+str.tostring(strategy.openprofit,"#.00")
table.cell(table_id=info_panel,column=0,row=0,text=text1,text_size=size.normal,text_color=color.new(color.silver,0))
//-----------------------Backtestperiode--------------------------------
backtest_period()=>
time>=period_startandtime<=period_stop?true:false
//--------------------Ichimoku--------------------
TKlength=9//input(9,"Tenkan-senlength",minval=1)
KJlength=26//input(26,"Kijun-senlength",minval=1)
CSHSlength=26//input(26,"Chikouspanlength/horizontalshift",minval=1)
SBlength=52//input(52,"SenkouspanBlength",minval=1)
SAlength=26//input(26,"SenkouspanAlength",minval=1)
//calculation
TK=math.avg(ta.lowest(TKlength),ta.highest(TKlength))
KJ=math.avg(ta.lowest(KJlength),ta.highest(KJlength))
CS=close
SB=math.avg(ta.lowest(SBlength),ta.highest(SBlength))
SA=math.avg(TK,KJ)
kumo_high=math.max(SA[CSHSlength-1],SB[CSHSlength-1])
kumo_low=math.min(SA[CSHSlength-1],SB[CSHSlength-1])
//---------------------------------------------------------------------------------Filtersandentrysignals-----------------------------------------------------------------------------------
//----------------------Ichimokufilter------------------------
varbooltkkj_x=true
ifta.crossover(TK,KJ)andTK>kumo_highandKJ>kumo_high
tkkj_x:=true
tkkj_x
ifta.crossunder(TK,KJ)andTK<kumo_lowandKJ<kumo_low
tkkj_x:=false
tkkj_x
//Ichimokuentrysignals
kijun_buy=one_side_pyr?ta.crossover(close,KJ):close>KJ
kumo_buy=one_side_pyr?ta.crossover(close,kumo_high):close>kumo_high
kumo_flip_buy=one_side_pyr?ta.crossover(SA,SB):SA>SB
chikou_X_price_buy=one_side_pyr?ta.crossover(CS,high[26-1]):CS>high[26-1]
chikou_X_kumo_buy=one_side_pyr?ta.crossover(CS,kumo_high[26-1]):CS>kumo_high[26-1]
price_X_tenkan_buy=one_side_pyr?ta.crossover(close,TK):close>TK
tenkan_X_kumo_buy=one_side_pyr?ta.crossover(TK,kumo_high):TK>kumo_high
tenkan_X_kijun_buy=one_side_pyr?ta.crossover(TK,KJ):TK>KJ
kijun_sell=one_side_pyr?ta.crossunder(close,KJ):close<KJ
kumo_sell=one_side_pyr?ta.crossunder(close,kumo_low):close<kumo_low
kumo_flip_sell=one_side_pyr?ta.crossunder(SA,SB):SA<SB
chikou_X_price_sell=one_side_pyr?ta.crossunder(CS,low[26-1]):CS<low[26-1]
chikou_X_kumo_sell=one_side_pyr?ta.crossunder(CS,kumo_low[26-1]):CS<kumo_low[26-1]
price_X_tenkan_sell=one_side_pyr?ta.crossunder(close,TK):close<TK
tenkan_X_kumo_sell=one_side_pyr?ta.crossunder(TK,kumo_low):TK<kumo_low
tenkan_X_kijun_sell=one_side_pyr?ta.crossunder(TK,KJ):TK<KJ
//Ichimokufilters
kijun_buy_f=close>KJ
kumo_buy_f=close>kumo_high
kumo_flip_buy_f=SA>SB
chikou_X_price_buy_f=CS>high[26-1]
chikou_X_kumo_buy_f=CS>kumo_high[26-1]
price_X_tenkan_buy_f=close>TK
tenkan_X_kumo_buy_f=TK>kumo_high
tenkan_X_kijun_buy_f=TK>KJ
kumo_filtered_tenkan_X_kijun_buy_f=tkkj_xandTK>kumo_highandKJ>kumo_highandTK>KJ
kijun_sell_f=close<KJ
kumo_sell_f=close<kumo_low
kumo_flip_sell_f=SA<SB
chikou_X_price_sell_f=CS<low[26-1]
chikou_X_kumo_sell_f=CS<kumo_low[26-1]
price_X_tenkan_sell_f=close<TK
tenkan_X_kumo_sell_f=TK<kumo_low
tenkan_X_kijun_sell_f=TK<KJ
kumo_filtered_tenkan_X_kijun_sell_f=nottkkj_xandTK<kumo_lowandKJ<kumo_lowandTK<KJ
//Ichimokuexits
kijun_buy_x=ta.crossover(high,KJ)
kijun_sell_x=ta.crossunder(low,KJ)
kumo_buy_x=ta.crossover(high,kumo_high)
kumo_sell_x=ta.crossunder(low,kumo_low)
//-----------------------barsignals-----------------------
//entrysignal
bar_sig_1_buy=close>high[1]//barbreakoutsignal1
bar_sig_1_sell=close<low[1]
//filter
bar_sig_1_buy_f=close>high[1]//barbreakoutsignal1-filter
bar_sig_1_sell_f=close<low[1]
//entry
bar_sig_2_buy=high>high[1]//barbreakoutsignal2
bar_sig_2_sell=low<low[1]
//filter
bar_sig_2_buy_f=high>high[1]//barbreakoutsignal2-filter
bar_sig_2_sell_f=low<low[1]
rev_bar_sig_buy=close>open//reversebarexit
rev_bar_sig_sell=close<open
hllh_buy=low>low[1]//higher-low/lower-highbarsig
hllh_sell=high<high[1]
open_buy=close!=0//entryoneveryopenbarsig
open_sell=close!=0
//--------------------------trix--------------------------
f_trix(_trix_len)=>10000*ta.change(ta.ema(ta.ema(ta.ema(math.log(close),_trix_len),_trix_len),_trix_len))
trix_f=f_trix(trix_len_f)
trix_x=f_trix(trix_len_x)
trix_buy_s=ta.rising(trix_f,1)andnotta.rising(trix_f,1)[1]//one_side_pyr?ta.rising(trix_f,1)andnotta.rising(trix_f,1)[1]:ta.rising(trix_f,1)
trix_sell_s=ta.falling(trix_f,1)andnotta.falling(trix_f,1)[1]//one_side_pyr?ta.falling(trix_f,1)andnotta.falling(trix_f,1)[1]:ta.falling(trix_f,1)
trix_slo_up_f=ta.rising(trix_f,1)
trix_slo_up_x=ta.rising(trix_x,1)andnotta.rising(trix_x,1)[1]
trix_slo_dn_x=ta.falling(trix_x,1)andnotta.falling(trix_x,1)[1]
//-----------------------rsistochastic----------------------------
//filter
rsi_rs_f=ta.rsi(close,rsi_length_sto_f)
k_f=ta.sma(ta.stoch(rsi_rs_f,rsi_rs_f,rsi_rs_f,stoch_length_f),k_smoo_f)
d_f=ta.sma(k_f,d_smoo_f)
//signal
kd_mom_up_f=k_f>20andd_f>20andnot(k_f<d_fandk_f<80andd_f<80)
kd_mom_dn_f=k_f<80andd_f<80andnot(k_f>d_fandk_f>80andd_f>80)
//exit
rsi_rs_x=ta.rsi(close,rsi_length_sto_x)
k_x=ta.sma(ta.stoch(rsi_rs_x,rsi_rs_x,rsi_rs_x,stoch_length_x),k_smoo_x)
d_x=ta.sma(k_x,d_smoo_x)
//signal
kd_mom_up_x=k_x>20andd_x>20andnot(k_x<d_xandk_x<80andd_x<80)
kd_mom_dn_x=k_x<80andd_x<80andnot(k_x>d_xandk_x>80andd_x>80)
//-------------------------hma----------------------------
f_hma(_hma_len)=>ta.hma(close,_hma_len)
hma_f=f_hma(hma_len_f)//entryfilter
hma_x=f_hma(hma_len_x)//exit
hma_up_e=ta.rising(hma_f,1)andnotta.rising(hma_f,1)[1]//one_side_pyr?ta.rising(hma_f,1)andnotta.rising(hma_f,1)[1]:ta.rising(hma_f,1)//entrysignal
hma_dn_e=ta.falling(hma_f,1)andnotta.falling(hma_f,1)[1]//one_side_pyr?ta.falling(hma_f,1)andnotta.falling(hma_f,1)[1]:ta.falling(hma_f,1)
hma_up_f=ta.rising(hma_f,1)//entryfilter
hma_up_x=ta.rising(hma_x,1)andnotta.rising(hma_x,1)[1]//exit
hma_dn_x=ta.falling(hma_x,1)andnotta.falling(hma_x,1)[1]
//------------------------grid--------------------------
re_grid=0.
re_grid:=nz(high>re_grid[1]+grid_gaporlow<re_grid[1]-grid_gap?close:re_grid[1])
grid_ct_buy=re_grid<re_grid[1]
grid_ct_sell=re_grid>re_grid[1]
grid_re_buy=re_grid>re_grid[1]
grid_re_sell=re_grid<re_grid[1]
//plot(re_grid,"Plot",color=color.yellow,linewidth=2)
//----------------------reversefractalsignalandfilter--------------------------
up_bar=close[0]>open[0]
dn_bar=close[0]<open[0]
hl=low[0]>low[1]
lh=high[0]<high[1]
rev_up_fr_sell=ta.pivothigh(high,3,0)anddn_barandup_bar[1]orta.pivothigh(high,4,1)anddn_barandup_bar[1]orta.pivothigh(high,4,1)andlhandup_barandup_bar[1]
rev_dn_fr_buy=ta.pivotlow(low,3,0)andup_baranddn_bar[1]orta.pivotlow(low,4,1)andup_baranddn_bar[1]orta.pivotlow(low,4,1)andhlanddn_baranddn_bar[1]
//-------------------------ema1xema2------------------------
f_ema(_ema_len)=>ta.ema(close,_ema_len)//mafunctiondefinition
f_sma(_sma_len)=>ta.sma(close,_sma_len)//mafunctiondefinition
ema1_f=f_ema(ema1_len_f)
ema2_f=f_ema(ema2_len_f)
ema1_x=f_ema(ema1_len_x)
ema2_x=f_ema(ema2_len_x)
ema_1x2_buy_s=ta.crossover(ema1_f,ema2_f)
ema_1x2_sell_s=ta.crossunder(ema1_f,ema2_f)
ema_1x2_buy_f=ema1_f>ema2_f
ema_1x2_buy_x=ta.crossover(ema1_x,ema2_x)
ema_1x2_sell_x=ta.crossunder(ema1_x,ema2_x)
//---------------------ALMA------------------------
alma=ta.alma(close,windowsize,offset,sigma)
//entrysignals
alma_slo_up_e=ta.rising(alma,1)andnotta.rising(alma,1)[1]//one_side_pyr?ta.rising(alma,1)andnotta.rising(alma,1)[1]:ta.rising(alma,1)
alma_slo_dn_e=ta.falling(alma,1)andnotta.falling(alma,1)[1]//one_side_pyr?ta.falling(alma,1)andnotta.falling(alma,1)[1]:ta.falling(alma,1)
//filters
alma_slo_up_f=ta.rising(alma,1)
//-----------------------macdfilterandmacdslope-----------------------
[macdLine_f,signalLine_f,histLine_f]=ta.macd(close,12,26,9)
//filters
macd_buy=macdLine_f>signalLine_f
macd_sell=macdLine_f<signalLine_f
//exit
macd_buy_x=ta.crossover(macdLine_f,signalLine_f)
macd_sell_x=ta.crossunder(macdLine_f,signalLine_f)
//macdfastlineslope
macd_slope_up_e=ta.rising(macdLine_f,slope_len)andnotta.rising(macdLine_f,slope_len)[1]
//one_side_pyr?ta.rising(macdLine_f,slope_len)andnotta.rising(macdLine_f,slope_len)[1]:ta.rising(macdLine_f,slope_len)//entry
macd_slope_dn_e=ta.falling(macdLine_f,slope_len)andnotta.falling(macdLine_f,slope_len)[1]
//one_side_pyr?ta.falling(macdLine_f,slope_len)andnotta.falling(macdLine_f,slope_len)[1]:ta.falling(macdLine_f,slope_len)
macd_slope_up_f=ta.rising(macdLine_f,slope_len)//filter
macd_slope_up_x=ta.rising(macdLine_f,slope_len_x)andnotta.rising(macdLine_f,slope_len_x)[1]//exit
macd_slope_dn_x=ta.falling(macdLine_f,slope_len_x)andnotta.falling(macdLine_f,slope_len_x)[1]
//----------------------rsifilterandentrysignal------------------------
f_rsi(_rsi_period)=>ta.rsi(close,_rsi_period)
//entry
rsi_f=f_rsi(rsi_period)
rsi_f_buy=one_side_pyr?ta.crossover(rsi_f,50):rsi_f>50
rsi_f_sell=one_side_pyr?ta.crossunder(rsi_f,50):rsi_f<50
//filters
rsi_f_buy_f=rsi_f>50
rsi_f_sell_f=rsi_f<50
//exit
rsi_f_x=f_rsi(rsi_period_x)
rsi_f_buy_x=ta.crossover(rsi_f_x,50)
rsi_f_sell_x=ta.crossunder(rsi_f_x,50)
//----------------BillWilliamsFractals(filterandentrysignal)-----------------
up_fr=ta.pivothigh(fr_period,fr_period)
dn_fr=ta.pivotlow(fr_period,fr_period)
fractal_up_v=ta.valuewhen(up_fr,high[fr_period],0)
fractal_dn_v=ta.valuewhen(dn_fr,low[fr_period],0)
//entrysignal
fr_upx=one_side_pyr?ta.crossover(high,fractal_up_v):high>fractal_up_v
fr_dnx=one_side_pyr?ta.crossunder(low,fractal_dn_v):low<fractal_dn_v
//filters
fr_upx_f=high>fractal_up_v
fr_dnx_f=low<fractal_dn_v
//exit
up_fr_x=ta.pivothigh(fr_period_x,fr_period_x)
dn_fr_x=ta.pivotlow(fr_period_x,fr_period_x)
fractal_up_v_x=ta.valuewhen(up_fr_x,high[fr_period_x],fr_past_x)
fractal_dn_v_x=ta.valuewhen(dn_fr_x,low[fr_period_x],fr_past_x)
fr_upx_x=ta.crossover(high,fractal_up_v_x)
fr_dnx_x=ta.crossunder(low,fractal_dn_v_x)
//--------------------SuperTrendfilterandentrysignal---------------------
//entry
[SuperTrend,Dir]=ta.supertrend(mult,len)
sup_buy=one_side_pyr?ta.crossover(high,SuperTrend):high>SuperTrend
sup_sell=one_side_pyr?ta.crossunder(low,SuperTrend):low<SuperTrend
//filters
sup_buy_f=high>SuperTrend
sup_sell_f=low<SuperTrend
//exit
[SuperTrend_x,Dir_x]=ta.supertrend(mult_x,len_x)
sup_buy_x=ta.crossover(high,SuperTrend_x)
sup_sell_x=ta.crossunder(low,SuperTrend_x)
//-----------------ParabolicSARSignal(pb/ps)andfilter-------------------
psar_buy=one_side_pyr?ta.crossover(high,ta.sar(start,inc,max)[0]):high>ta.sar(start,inc,max)[0]
psar_sell=one_side_pyr?ta.crossunder(low,ta.sar(start,inc,max)[0]):low<ta.sar(start,inc,max)[0]
//filters
psar_buy_f=high>ta.sar(start,inc,max)[0]
psar_sell_f=low<ta.sar(start,inc,max)[0]
psar_buy_x=ta.crossover(high,ta.sar(start,inc,max)[0])
psar_sell_x=ta.crossunder(low,ta.sar(start,inc,max)[0])
//--------------------------DMIADXentrysigandfilter---------------------------
//exit
[diplus_f_x,diminus_f_X,adx_f_x]=ta.dmi(di_length_x,adx_smooth_x)
adx_thres_f_x=ta.crossunder(adx_f_x,adx_thres_x)
//dmiandadxsignal1/2/3andfilters
[diplus_s,diminus_s,adx_s]=ta.dmi(di_length_s,adx_smooth_s)
adx_above_thres=adx_s>adx_thres_s
adx_slope_up=ta.rising(adx_s,1)
//entryfilter
long_e=diplus_s>diminus_s
short_e=diplus_s<diminus_s
//entry
long_1=one_side_pyr?ta.crossover(diplus_s,diminus_s)andadx_s<diplus_sandadx_s>diminus_s:diplus_s>diminus_sandadx_s<diplus_sandadx_s>diminus_s
short_1=one_side_pyr?ta.crossunder(diplus_s,diminus_s)andadx_s>diplus_sandadx_s<diminus_s:diplus_s<diminus_sandadx_s>diplus_sandadx_s<diminus_s
long_2=one_side_pyr?ta.crossover(diplus_s,diminus_s)andadx_s>adx_thres_s:diplus_s>diminus_sandadx_above_thres
short_2=one_side_pyr?ta.crossunder(diplus_s,diminus_s)andadx_s>adx_thres_s:diplus_s<diminus_sandadx_above_thres
//dmiadx-slopesignal
adx_up_c=adx_slope_upanddiplus_s>diminus_sandnot(adx_slope_upanddiplus_s>diminus_s)[1]
adx_dn_c=adx_slope_upanddiplus_s<diminus_sandnot(adx_slope_upanddiplus_s<diminus_s)[1]
//--------------------------SMA50filterandentry---------------------------
//entry
sma_buy=one_side_pyr?ta.crossover(close[1],f_sma(ma_period)):close[2]>f_sma(ma_period)
sma_sell=one_side_pyr?ta.crossunder(close[1],f_sma(ma_period)):close[2]<f_sma(ma_period)
//filters
sma_buy_f=close[2]>f_sma(ma_period)
sma_sell_f=close[2]<f_sma(ma_period)
//exit
sma_buy_x=ta.crossover(close[1],f_sma(ma_period_x))
sma_sell_x=ta.crossunder(close[1],f_sma(ma_period_x))
//----------------williamsfractalstrendlines-----------------
up_w_fr=ta.pivothigh(2,2)
dn_w_fr=ta.pivotlow(2,2)
y1_frup_1=ta.valuewhen(up_w_fr,high[2],1)
y0_frup_0=ta.valuewhen(up_w_fr,high[2],0)
y1_frdn_1=ta.valuewhen(dn_w_fr,low[2],1)
y0_frdn_0=ta.valuewhen(dn_w_fr,low[2],0)
//bar-idloopstogetx1andx2forline.new()
xup0=2
fori=1to35by1
ifhigh[i+2]>=high[i+3]andhigh[i+2]>high[i+4]andhigh[i+2]>high[i+1]andhigh[i+2]>=high[i+0]
break
xup0:=xup0+1
xup0
xup1=xup0
fori=xup1to50by1
ifhigh[i+2]>=high[i+3]andhigh[i+2]>high[i+4]andhigh[i+2]>high[i+1]andhigh[i+2]>=high[i+0]
break
xup1:=xup1+1
xup1
xdn0=2
fori=1to35by1
iflow[i+2]<=low[i+3]andlow[i+2]<low[i+4]andlow[i+2]<low[i+1]andlow[i+2]<=low[i+0]
break
xdn0:=xdn0+1
xdn0
xdn1=xdn0
fori=xdn1to50by1
iflow[i+2]<=low[i+3]andlow[i+2]<low[i+4]andlow[i+2]<low[i+1]andlow[i+2]<=low[i+0]
break
xdn1:=xdn1+1
xdn1
//y-linebreakvaluesforupper_lineandlower_line
y_up_lvl=(y0_frup_0-y1_frup_1)/(xup1+2-xup0)*xup0+y0_frup_0//y=slope*x0+y0
y_dn_lvl=(y0_frdn_0-y1_frdn_1)/(xdn1+2-xdn0)*xdn0+y0_frdn_0
//entry
//frup_buy=ta.crossover(high,y0_frup_0)
//frdn_sell=ta.crossunder(low,y0_frdn_0)
buy_up_line=one_side_pyr?ta.crossover(high,y_up_lvl):high>y_up_lvl//orfrup_buy
sell_dn_line=one_side_pyr?ta.crossunder(low,y_dn_lvl):low<y_dn_lvl//orfrdn_sell
//---------------------------Segmentssignal----------------------------
count1_l=0
count2_l=0
segment_1_stat_l=false
segment_2_stat_l=false
segment_3_stat_l=false
higher_low=low>low[1]
varlinesegment_low_1_l=na
varlinesegment_low_2_l=na
varlinesegment_low_3_l=na
//longsegments
fori=0tosbby1
count1_l:=count1_l+1
iflow[1]>low[i+2]andhigher_low
segment_1_stat_l:=true
break
fori=count1_ltosb+count1_lby1
count2_l:=count2_l+1
iflow[1+count1_l]>low[i+2]andsegment_1_stat_l
segment_2_stat_l:=true
break
fori=count2_ltosb+count2_lby1
iflow[1+count1_l+count2_l]>low[i+2+count1_l]andsegment_2_stat_l
segment_3_stat_l:=true
break
//shortsegments
count1_s=0
count2_s=0
segment_1_stat_s=false
segment_2_stat_s=false
segment_3_stat_s=false
lower_high=high<high[1]
varlinesegment_high_1=na
varlinesegment_high_2=na
varlinesegment_high_3=na
fori=0tosbby1
count1_s:=count1_s+1
ifhigh[1]<high[i+2]andlower_high
segment_1_stat_s:=true
break
fori=count1_stosb+count1_sby1
count2_s:=count2_s+1
ifhigh[1+count1_s]<high[i+2]andsegment_1_stat_s
segment_2_stat_s:=true
break
fori=count2_stosb+count2_sby1
ifhigh[1+count1_s+count2_s]<high[i+2+count1_s]andsegment_2_stat_s
segment_3_stat_s:=true
break
//segmentssignals
seg_stat_l=segment_1_stat_landsegment_2_stat_landsegment_3_stat_l
seg_stat_s=segment_1_stat_sandsegment_2_stat_sandsegment_3_stat_s
//entry
segments_buy=high>high[1]andseg_stat_l[1]
segments_sell=low<low[1]andseg_stat_s[1]
//filters
segments_buy_f=high>high[1]andseg_stat_l[1]
segments_sell_f=low<low[1]andseg_stat_s[1]
//-----------------------i-o-s-psignals------------------------
i_bar_buy=high[1]<high[2]andlow[1]>low[2]andclose>high[1]
i_bar_sell=high[1]<high[2]andlow[1]>low[2]andclose<low[1]
o_bar_buy=high[1]>high[2]andlow[1]<low[2]andhigh>high[1]
o_bar_sell=high[1]>high[2]andlow[1]<low[2]andlow<low[1]
s_bar_buy=high[2]<high[3]andlow[2]>low[3]andhigh[1]>high[2]andlow[1]<low[2]andhigh>high[1]
s_bar_sell=high[2]<high[3]andlow[2]>low[3]andhigh[1]>high[2]andlow[1]<low[2]andlow<low[1]
//pinbar
candle_body=math.abs(open-close)
pivot_up=ta.pivothigh(high,p_bar_sens_2,0)
pivot_dn=ta.pivotlow(low,p_bar_sens_2,0)
up_wick=close>open?high-close:high-open
dn_wick=close>open?open-low:close-low
pin_up_def=high-open>p_bar_sens_1*candle_bodyandclose<openorhigh-close>p_bar_sens_1*candle_bodyandclose>open
pin_dn_def=open-low>p_bar_sens_1*candle_bodyandclose>openorclose-low>p_bar_sens_1*candle_bodyandclose<open
p_bar_sell=pin_up_defandpivot_upandup_wick>dn_wick
p_bar_buy=pin_dn_defandpivot_dnandup_wick<dn_wick
//-----------------IchimokuSignalB1/S1-----------------
buy_strong_B1=TK>=KJandhigh>kumo_highandCS>high[26-1]andCS>kumo_high[26-1]andSA>SB
sell_strong_S1=TK<=KJandlow<kumo_lowandCS<low[26-1]andCS<kumo_low[26-1]andSA<SB
//-----------------IchimokuSignalB2/S2-----------------
buy_strong_B2=TK>=KJandhigh>kumo_highandCS>high[26-1]
sell_strong_S2=TK<=KJandlow<kumo_lowandCS<low[26-1]
//----------------------------ConfluenceSignalCB/CS----------------------------
long_short_trig=10//input(9,type=input.float,title="ConfluencesignaltriggerLevel",step=0.2)
//Indicators
//ma
sma1=f_sma(50)
sma2=f_sma(200)
ema1=f_ema(50)
ema2=f_ema(200)
ema_c=f_ema(21)
sma_c=f_sma(20)
[macdLine,signalLine,histLine]=ta.macd(close,12,26,9)
rsi=f_rsi(14)
[diplus,diminus,adx]=ta.dmi(7,7)
[superTrend,dir]=ta.supertrend(2,5)
//KlingerOszillator
sv=ta.change(hlc3)>=0?volume:-volume
kvo=ta.ema(sv,34)-ta.ema(sv,55)
sig=ta.ema(kvo,13)
//VortexIndicator
VMP=math.sum(math.abs(high-low[1]),14)
VMM=math.sum(math.abs(low-high[1]),14)
STR=math.sum(ta.atr(1),14)
VIP=VMP/STR
VIM=VMM/STR
//HMAslope
hma_slo_up=ta.rising(f_hma(15),1)
//ALMAslope
alma_slo_up=ta.rising(ta.alma(close,9,0.85,6),1)
//MACDslope
macd_slo_up=ta.rising(macdLine,1)
//Signals
varfloatsem_sig_w=na
varfloatsma_sig_w=na
varfloatema_sig_w=na
varfloatp_kj_sig_w=na
varfloattk_kj_sig_w=na
varfloatB1_S1_sig_w=na
varfloatB2_S2_sig_w=na
varfloatpsar_sig_w=na
varfloatfrac_sig_w=na
varfloatmacd_sig_w=na
varfloatrsi_sig_w=na
varfloatp_tk_sig_w=na
varfloatdmi_sig_w=na
varfloatklin_sig_w=na
varfloatvort_sig_w=na
varfloatsup_sig_w=na
varfloathma_sig_w=na
varfloatalma_sig_w=na
varfloatmacd_s_sig_w=na
ifema_c>sma_c
sem_sig_w:=1
elseifema_c<sma_c
sem_sig_w:=0
ifsma1>sma2
sma_sig_w:=1
elseifsma1<sma2
sma_sig_w:=0
ifema1>ema2
ema_sig_w:=1
elseifema1<ema2
ema_sig_w:=0
ifhigh>KJ
p_kj_sig_w:=1
elseiflow<KJ
p_kj_sig_w:=0
ifTK>KJ
tk_kj_sig_w:=1
elseifTK<KJ
tk_kj_sig_w:=0
ifbuy_strong_B1
B1_S1_sig_w:=1
elseifsell_strong_S1
B1_S1_sig_w:=0
ifbuy_strong_B2
B2_S2_sig_w:=1
elseifsell_strong_S2
B2_S2_sig_w:=0
ifhigh>=ta.sar(start,inc,max)[0]
psar_sig_w:=1
elseiflow<=ta.sar(start,inc,max)[0]
psar_sig_w:=0
ifhigh>fractal_up_v
frac_sig_w:=1
elseiflow<fractal_dn_v
frac_sig_w:=0
ifmacdLine>signalLine
macd_sig_w:=1
elseifmacdLine<signalLine
macd_sig_w:=0
ifrsi>50
rsi_sig_w:=1
elseifrsi<50
rsi_sig_w:=0
ifhigh>TK
p_tk_sig_w:=1
elseiflow<TK
p_tk_sig_w:=0
ifdiplus>diminus
dmi_sig_w:=1
elseifdiplus<diminus
dmi_sig_w:=0
ifsig>0
klin_sig_w:=1
elseifsig<0
klin_sig_w:=0
ifVIP>VIM
vort_sig_w:=1
elseifVIP<VIM
vort_sig_w:=0
ifhigh>superTrend
sup_sig_w:=1
elseiflow<superTrend
sup_sig_w:=0
ifhma_slo_up
hma_sig_w:=2
elseifnothma_slo_up
hma_sig_w:=-1
ifalma_slo_up
alma_sig_w:=2
elseifnotalma_slo_up
alma_sig_w:=-1
ifmacd_slo_up
macd_s_sig_w:=1
elseifnotmacd_slo_up
macd_s_sig_w:=0
bs_conf_sig=sma_sig_w+ema_sig_w+p_kj_sig_w+tk_kj_sig_w+B1_S1_sig_w+B2_S2_sig_w+psar_sig_w+frac_sig_w+macd_sig_w+rsi_sig_w+dmi_sig_w+klin_sig_w+vort_sig_w+sup_sig_w+
p_tk_sig_w+sem_sig_w+hma_sig_w+alma_sig_w+macd_s_sig_w
long_c=one_side_pyr?ta.crossover(bs_conf_sig,(long_short_trig+trig_gap_cbcs)):bs_conf_sig>(long_short_trig+trig_gap_cbcs)//with+-signalismorestable
short_c=one_side_pyr?ta.crossunder(bs_conf_sig,(long_short_trig-trig_gap_cbcs)):bs_conf_sig<(long_short_trig-trig_gap_cbcs)
//----------------------------PureIchimokuConfluenceSignalIB/IS----------------------------
pic_l_s_trig=5//input(4,type=input.float,title="IchimokuconfluencesignaltriggerLevel",step=0.1)
//Signals
varfloattkkh_sig_w=na
varfloatcsh_sig_w=na
varfloatcskh_sig_w=na
varfloatpkj_sig_w=na
varfloatptk_sig_w=na
varfloattkkj_sig_w=na
varfloatsasb_sig_w=na
varfloatckh_sig_w=na
varfloatcskj_sig_w=na
varfloatcstk_sig_w=na
varfloatkjcl_sig_w=na
ifTK>kumo_high
tkkh_sig_w:=1
elseifTK<kumo_low
tkkh_sig_w:=0
ifCS>high[26-1]
csh_sig_w:=1
elseifCS<low[26-1]
csh_sig_w:=0
ifCS>kumo_high[26-1]
cskh_sig_w:=1
elseifCS<kumo_low[26-1]
cskh_sig_w:=0
ifhigh>TK
ptk_sig_w:=1
elseiflow<TK
ptk_sig_w:=0
ifhigh>KJ
pkj_sig_w:=1
elseiflow<KJ
pkj_sig_w:=0
ifTK>KJ
tkkj_sig_w:=1
elseifTK<KJ
tkkj_sig_w:=0
ifSA>SB
sasb_sig_w:=1
elseifSA<SB
sasb_sig_w:=0
ifhigh>kumo_high
ckh_sig_w:=1
elseiflow<kumo_low
ckh_sig_w:=0
ifCS>KJ[26-1]
cskj_sig_w:=1
elseifCS<KJ[26-1]
cskj_sig_w:=0
ifCS>TK[26-1]
cstk_sig_w:=1
elseifCS<TK[26-1]
cstk_sig_w:=0
ifKJ>kumo_high
kjcl_sig_w:=1
elseifKJ<kumo_high
kjcl_sig_w:=0
bs_pic_sig=tkkh_sig_w+csh_sig_w+cskh_sig_w+ptk_sig_w+pkj_sig_w+tkkj_sig_w+sasb_sig_w+ckh_sig_w+cskj_sig_w+cstk_sig_w+kjcl_sig_w
long_pic=one_side_pyr?ta.crossover(bs_pic_sig,pic_l_s_trig+trig_gap_ibis):bs_pic_sig>pic_l_s_trig+trig_gap_ibis
short_pic=one_side_pyr?ta.crossunder(bs_pic_sig,pic_l_s_trig-trig_gap_ibis):bs_pic_sig<pic_l_s_trig-trig_gap_ibis
long_pic_x=long_picandnotlong_pic[1]
short_pic_x=short_picandnotshort_pic[1]
//--------------------------------------------------------------------entryfilters-------------------------------------------------------------------
f_secureSecurity(_symbol,_res,_src)=>request.security(_symbol,_res,_src[repaint=='Allowed'?0:1])//norepainting-takenfromPineCoders

entry_filter_sig_buy_1=entry_f_1=='---'?true:
entry_f_1=='TRIXslopefilter'?trix_slo_up_f:
entry_f_1=='RSIStochasticfilter'?kd_mom_up_f:
entry_f_1=='EMA1xEMA2filter'?ema_1x2_buy_f:
entry_f_1=='HMAslopefilter'?hma_up_f:
entry_f_1=='MACD(fast)slopefilter'?macd_slope_up_f:
entry_f_1=='MACDfilter'?macd_buy:
entry_f_1=='RSI50filter'?rsi_f_buy_f:
entry_f_1=='Fractalsfilter'?fr_upx_f:
entry_f_1=='SuperTrendfilter'?sup_buy_f:
entry_f_1=='ParabolicSARfilter'?psar_buy_f:
entry_f_1=='SMAfilter'?sma_buy_f:
entry_f_1=='ADXThresholdfilter'?adx_above_thres:
entry_f_1=='DMIfilter'?long_e:
entry_f_1=='Barbreakout1filter'?bar_sig_1_buy_f:
entry_f_1=='Barbreakout2filter'?bar_sig_2_buy_f:
entry_f_1=='Reversefractalfilter'?rev_dn_fr_buy:
entry_f_1=='ALMAslopefilter'?alma_slo_up_f:
entry_f_1=='PriceXKumofilter'?kumo_buy_f:
entry_f_1=='PriceXKijunfilter'?kijun_buy_f:
entry_f_1=='Kumoflipfilter'?kumo_flip_buy_f:
entry_f_1=='ChikouXpricefilter'?chikou_X_price_buy_f:
entry_f_1=='ChikouXKumofilter'?chikou_X_kumo_buy_f:
entry_f_1=='PriceXTenkanfilter'?price_X_tenkan_buy_f:
entry_f_1=='TenkanXKumofilter'?tenkan_X_kumo_buy_f:
entry_f_1=='TenkanXKijunfilter'?tenkan_X_kijun_buy_f:
entry_f_1=='B1/S1sig'?buy_strong_B1:
entry_f_1=='B2/S2sig'?buy_strong_B2:true
entry_filter_sig_sell_1=entry_f_1=='---'?true:
entry_f_1=='TRIXslopefilter'?nottrix_slo_up_f:
entry_f_1=='RSIStochasticfilter'?kd_mom_dn_f:
entry_f_1=='EMA1xEMA2filter'?notema_1x2_buy_f:
entry_f_1=='HMAslopefilter'?nothma_up_f:
entry_f_1=='MACD(fast)slopefilter'?notmacd_slope_up_f:
entry_f_1=='MACDfilter'?macd_sell:
entry_f_1=='RSI50filter'?rsi_f_sell_f:
entry_f_1=='Fractalsfilter'?fr_dnx_f:
entry_f_1=='SuperTrendfilter'?sup_sell_f:
entry_f_1=='ParabolicSARfilter'?psar_sell_f:
entry_f_1=='SMAfilter'?sma_sell_f:
entry_f_1=='ADXThresholdfilter'?adx_above_thres:
entry_f_1=='DMIfilter'?short_e:
entry_f_1=='Barbreakout1filter'?bar_sig_1_sell_f:
entry_f_1=='Barbreakout2filter'?bar_sig_2_sell_f:
entry_f_1=='Reversefractalfilter'?rev_up_fr_sell:
entry_f_1=='ALMAslopefilter'?notalma_slo_up_f:
entry_f_1=='PriceXKumofilter'?kumo_sell_f:
entry_f_1=='PriceXKijunfilter'?kijun_sell_f:
entry_f_1=='Kumoflipfilter'?kumo_flip_sell_f:
entry_f_1=='ChikouXpricefilter'?chikou_X_price_sell_f:
entry_f_1=='ChikouXKumofilter'?chikou_X_kumo_sell_f:
entry_f_1=='PriceXTenkanfilter'?price_X_tenkan_sell_f:
entry_f_1=='TenkanXKumofilter'?tenkan_X_kumo_sell_f:
entry_f_1=='TenkanXKijunfilter'?tenkan_X_kijun_sell_f:
entry_f_1=='B1/S1sig'?sell_strong_S1:
entry_f_1=='B2/S2sig'?sell_strong_S2:true
entry_filter_sig_buy_2=entry_f_2=='---'?true:
entry_f_2=='TRIXslopefilter'?trix_slo_up_f:
entry_f_2=='RSIStochasticfilter'?kd_mom_up_f:
entry_f_2=='EMA1xEMA2filter'?ema_1x2_buy_f:
entry_f_2=='HMAslopefilter'?hma_up_f:
entry_f_2=='MACD(fast)slopefilter'?macd_slope_up_f:
entry_f_2=='MACDfilter'?macd_buy:
entry_f_2=='RSI50filter'?rsi_f_buy_f:
entry_f_2=='Fractalsfilter'?fr_upx_f:
entry_f_2=='SuperTrendfilter'?sup_buy_f:
entry_f_2=='ParabolicSARfilter'?psar_buy_f:
entry_f_2=='SMAfilter'?sma_buy_f:
entry_f_2=='ADXThresholdfilter'?adx_above_thres:
entry_f_2=='DMIfilter'?long_e:
entry_f_2=='Barbreakout1filter'?bar_sig_1_buy_f:
entry_f_2=='Barbreakout2filter'?bar_sig_2_buy_f:
entry_f_2=='Reversefractalfilter'?rev_dn_fr_buy:
entry_f_2=='ALMAslopefilter'?alma_slo_up_f:
entry_f_2=='PriceXKumofilter'?kumo_buy_f:
entry_f_2=='PriceXKijunfilter'?kijun_buy_f:
entry_f_2=='Kumoflipfilter'?kumo_flip_buy_f:
entry_f_2=='ChikouXpricefilter'?chikou_X_price_buy_f:
entry_f_2=='ChikouXKumofilter'?chikou_X_kumo_buy_f:
entry_f_2=='PriceXTenkanfilter'?price_X_tenkan_buy_f:
entry_f_2=='TenkanXKumofilter'?tenkan_X_kumo_buy_f:
entry_f_2=='TenkanXKijunfilter'?tenkan_X_kijun_buy_f:
entry_f_2=='B1/S1sig'?buy_strong_B1:
entry_f_2=='B2/S2sig'?buy_strong_B2:true
entry_filter_sig_sell_2=entry_f_2=='---'?true:
entry_f_2=='TRIXslopefilter'?nottrix_slo_up_f:
entry_f_2=='RSIStochasticfilter'?kd_mom_dn_f:
entry_f_2=='EMA1xEMA2filter'?notema_1x2_buy_f:
entry_f_2=='HMAslopefilter'?nothma_up_f:
entry_f_2=='MACD(fast)slopefilter'?notmacd_slope_up_f:
entry_f_2=='MACDfilter'?macd_sell:
entry_f_2=='RSI50filter'?rsi_f_sell_f:
entry_f_2=='Fractalsfilter'?fr_dnx_f:
entry_f_2=='SuperTrendfilter'?sup_sell_f:
entry_f_2=='ParabolicSARfilter'?psar_sell_f:
entry_f_2=='SMAfilter'?sma_sell_f:
entry_f_2=='ADXThresholdfilter'?adx_above_thres:
entry_f_2=='DMIfilter'?long_e:
entry_f_2=='Barbreakout1filter'?bar_sig_1_sell_f:
entry_f_2=='Barbreakout2filter'?bar_sig_2_sell_f:
entry_f_2=='Reversefractalfilter'?rev_up_fr_sell:
entry_f_2=='ALMAslopefilter'?notalma_slo_up_f:
entry_f_2=='PriceXKumofilter'?kumo_sell_f:
entry_f_2=='PriceXKijunfilter'?kijun_sell_f:
entry_f_2=='Kumoflipfilter'?kumo_flip_sell_f:
entry_f_2=='ChikouXpricefilter'?chikou_X_price_sell_f:
entry_f_2=='ChikouXKumofilter'?chikou_X_kumo_sell_f:
entry_f_2=='PriceXTenkanfilter'?price_X_tenkan_sell_f:
entry_f_2=='TenkanXKumofilter'?tenkan_X_kumo_sell_f:
entry_f_2=='TenkanXKijunfilter'?tenkan_X_kijun_sell_f:
entry_f_2=='B1/S1sig'?sell_strong_S1:
entry_f_2=='B2/S2sig'?sell_strong_S2:true
//entrybuyfilter1options
entry_filter_buy_1=htf_filt_opt_1=='Current'?entry_filter_sig_buy_1[repaint=='Allowed'?0:1]:
f_secureSecurity(syminfo.tickerid,
htf_filt_opt_1=='5m'?'5':htf_filt_opt_1=='10m'?'10':htf_filt_opt_1=='15m'?'15':
htf_filt_opt_1=='30m'?'30':htf_filt_opt_1=='1H'?'60':htf_filt_opt_1=='2H'?'120':htf_filt_opt_1=='3H'?'180':htf_filt_opt_1=='4H'?'240':
htf_filt_opt_1=='6H'?'360':htf_filt_opt_1=='12H'?'720':htf_filt_opt_1=='D'?'D':htf_filt_opt_1=='3D'?'3D':htf_filt_opt_1=='W'?'W':htf_filt_opt_1=='M'?'M':na,
entry_filter_sig_buy_1)
entry_filter_buy_11=entry_f_1=='Segmentsfilter(notffilter)'?segments_buy:
entry_f_1=='IB/ISsig(notffilter)'?long_pic[repaint=='Allowed'?0:1]:
entry_f_1=='Fractalstrendlinesfilter(notffilter)'?buy_up_line:true
//entrysellfilter1options
entry_filter_sell_1=htf_filt_opt_1=='Current'?entry_filter_sig_sell_1[repaint=='Allowed'?0:1]:
f_secureSecurity(syminfo.tickerid,
htf_filt_opt_1=='5m'?'5':htf_filt_opt_1=='10m'?'10':htf_filt_opt_1=='15m'?'15':
htf_filt_opt_1=='30m'?'30':htf_filt_opt_1=='1H'?'60':htf_filt_opt_1=='2H'?'120':htf_filt_opt_1=='3H'?'180':htf_filt_opt_1=='4H'?'240':
htf_filt_opt_1=='6H'?'360':htf_filt_opt_1=='12H'?'720':htf_filt_opt_1=='D'?'D':htf_filt_opt_1=='3D'?'3D':htf_filt_opt_1=='W'?'W':htf_filt_opt_1=='M'?'M':na,
entry_filter_sig_sell_1)
entry_filter_sell_11=entry_f_1=='Segmentsfilter(notffilter)'?segments_sell:
entry_f_1=='IB/ISsig(notffilter)'?short_pic[repaint=='Allowed'?0:1]:
entry_f_1=='Fractalstrendlinesfilter(notffilter)'?sell_dn_line:true
//entrybuyfilter2options
entry_filter_buy_2=htf_filt_opt_2=='Current'?entry_filter_sig_buy_2[repaint=='Allowed'?0:1]:
f_secureSecurity(syminfo.tickerid,
htf_filt_opt_2=='5m'?'5':htf_filt_opt_2=='10m'?'10':htf_filt_opt_2=='15m'?'15':
htf_filt_opt_2=='30m'?'30':htf_filt_opt_2=='1H'?'60':htf_filt_opt_2=='2H'?'120':htf_filt_opt_2=='3H'?'180':htf_filt_opt_2=='4H'?'240':
htf_filt_opt_2=='6H'?'360':htf_filt_opt_2=='12H'?'720':htf_filt_opt_2=='D'?'D':htf_filt_opt_2=='3D'?'3D':htf_filt_opt_2=='W'?'W':htf_filt_opt_2=='M'?'M':na,
entry_filter_sig_buy_2)
entry_filter_buy_22=entry_f_2=='Fractalstrendlinesfilter(notffilter)'?buy_up_line:
entry_f_2=='Segmentsfilter(notffilter)'?segments_buy:
entry_f_2=='IB/ISsig(notffilter)'?long_pic[repaint=='Allowed'?0:1]:true
//entrysellfilter2options
entry_filter_sell_2=htf_filt_opt_2=='Current'?entry_filter_sig_sell_2[repaint=='Allowed'?0:1]:
f_secureSecurity(syminfo.tickerid,
htf_filt_opt_2=='5m'?'5':htf_filt_opt_2=='10m'?'10':htf_filt_opt_2=='15m'?'15':
htf_filt_opt_2=='30m'?'30':htf_filt_opt_2=='1H'?'60':htf_filt_opt_2=='2H'?'120':htf_filt_opt_2=='3H'?'180':htf_filt_opt_2=='4H'?'240':
htf_filt_opt_2=='6H'?'360':htf_filt_opt_2=='12H'?'720':htf_filt_opt_2=='D'?'D':htf_filt_opt_2=='3D'?'3D':htf_filt_opt_2=='W'?'W':htf_filt_opt_2=='M'?'M':na,
entry_filter_sig_sell_2)
entry_filter_sell_22=entry_f_2=='Fractalstrendlinesfilter(notffilter)'?sell_dn_line:
entry_f_2=='Segmentsfilter(notffilter)'?segments_sell:
entry_f_2=='IB/ISsig(notffilter)'?short_pic[repaint=='Allowed'?0:1]:true
//--------------------------------------------------------------------exitfilters-----------------------------------------------------------------------
exit_filter_sig_buy_1=exit_f_1=='---'?false:
exit_f_1=='TRIXslopeexit'?trix_slo_up_x:
exit_f_1=='RSIStochasticexit'?kd_mom_up_x:
exit_f_1=='EMA1xEMA2exit'?ema_1x2_buy_x:
exit_f_1=='HMAslopeexit'?hma_up_x:
exit_f_1=='Reversebarexit'?rev_bar_sig_buy:
exit_f_1=='Reversefractalexit'?rev_dn_fr_buy:
exit_f_1=='Barbreakout2exit'?bar_sig_2_buy:
exit_f_1=='MACD(fast)slopeexit'?macd_slope_up_x:
exit_f_1=='MACDexit'?macd_buy_x:
exit_f_1=='RSI50exit'?rsi_f_buy_x:
exit_f_1=='Fractalsexit'?fr_upx_x:
exit_f_1=='SuperTrendexit'?sup_buy_x:
exit_f_1=='ParabolicSARexit'?psar_buy_x:
exit_f_1=='SMAexit'?sma_buy_x:
exit_f_1=='ADXThresholdexit'?adx_thres_f_x:
exit_f_1=='Cloudexit'?kumo_buy_x:
exit_f_1=='Kijunexit'?kijun_buy_x:false
exit_filter_sig_sell_1=exit_f_1=='---'?false:
exit_f_1=='TRIXslopeexit'?trix_slo_dn_x:
exit_f_1=='RSIStochasticexit'?kd_mom_dn_x:
exit_f_1=='EMA1xEMA2exit'?ema_1x2_sell_x:
exit_f_1=='HMAslopeexit'?hma_dn_x:
exit_f_1=='Reversebarexit'?rev_bar_sig_sell:
exit_f_1=='Reversefractalexit'?rev_up_fr_sell:
exit_f_1=='Barbreakout2exit'?bar_sig_2_sell:
exit_f_1=='MACD(fast)slopeexit'?macd_slope_dn_x:
exit_f_1=='MACDexit'?macd_sell_x:
exit_f_1=='RSI50exit'?rsi_f_sell_x:
exit_f_1=='Fractalsexit'?fr_dnx_x:
exit_f_1=='SuperTrendexit'?sup_sell_x:
exit_f_1=='ParabolicSARexit'?psar_sell_x:
exit_f_1=='SMAexit'?sma_sell_x:
exit_f_1=='ADXThresholdexit'?adx_thres_f_x:
exit_f_1=='Cloudexit'?kumo_sell_x:
exit_f_1=='Kijunexit'?kijun_sell_x:false
exit_filter_sig_buy_2=exit_f_2=='---'?false:
exit_f_2=='TRIXslopeexit'?trix_slo_up_x:
exit_f_2=='RSIStochasticexit'?kd_mom_up_x:
exit_f_2=='EMA1xEMA2exit'?ema_1x2_buy_x:
exit_f_2=='HMAslopeexit'?hma_up_x:
exit_f_2=='Reversebarexit'?rev_bar_sig_buy:
exit_f_2=='Reversefractalexit'?rev_dn_fr_buy:
exit_f_2=='Barbreakout2exit'?bar_sig_2_buy:
exit_f_2=='MACD(fast)slopeexit'?macd_slope_up_x:
exit_f_2=='MACDexit'?macd_buy_x:
exit_f_2=='RSI50exit'?rsi_f_buy_x:
exit_f_2=='Fractalsexit'?fr_upx_x:
exit_f_2=='SuperTrendexit'?sup_buy_x:
exit_f_2=='ParabolicSARexit'?psar_buy_x:
exit_f_2=='SMAexit'?sma_buy_x:
exit_f_2=='ADXThresholdexit'?adx_thres_f_x:
exit_f_2=='Cloudexit'?kumo_buy_x:
exit_f_2=='Kijunexit'?kijun_buy_x:false
exit_filter_sig_sell_2=exit_f_2=='---'?false:
exit_f_2=='TRIXslopeexit'?trix_slo_dn_x:
exit_f_2=='RSIStochasticexit'?kd_mom_dn_x:
exit_f_2=='EMA1xEMA2exit'?ema_1x2_sell_x:
exit_f_2=='HMAslopeexit'?hma_dn_x:
exit_f_2=='Reversebarexit'?rev_bar_sig_sell:
exit_f_2=='Reversefractalexit'?rev_up_fr_sell:
exit_f_2=='Barbreakout2exit'?bar_sig_2_sell:
exit_f_2=='MACD(fast)slopeexit'?macd_slope_dn_x:
exit_f_2=='MACDexit'?macd_sell_x:
exit_f_2=='RSI50exit'?rsi_f_sell_x:
exit_f_2=='Fractalsexit'?fr_dnx_x:
exit_f_2=='SuperTrendexit'?sup_sell_x:
exit_f_2=='ParabolicSARexit'?psar_sell_x:
exit_f_2=='SMAexit'?sma_sell_x:
exit_f_2=='ADXThresholdexit'?adx_thres_f_x:
exit_f_2=='Cloudexit'?kumo_sell_x:
exit_f_2=='Kijunexit'?kijun_sell_x:false
//shortexitbuyfilter1options
exit_filter_buy_1=htf_exit_opt_1=='Current'?exit_filter_sig_buy_1[repaint=='Allowed'?0:1]:
f_secureSecurity(syminfo.tickerid,
htf_exit_opt_1=='5m'?'5':htf_exit_opt_1=='10m'?'10':htf_exit_opt_1=='15m'?'15':
htf_exit_opt_1=='30m'?'30':htf_exit_opt_1=='1H'?'60':htf_exit_opt_1=='2H'?'120':htf_exit_opt_1=='3H'?'180':htf_exit_opt_1=='4H'?'240':
htf_exit_opt_1=='6H'?'360':htf_exit_opt_1=='12H'?'720':htf_exit_opt_1=='D'?'D':htf_exit_opt_1=='3D'?'3D':htf_exit_opt_1=='W'?'W':
htf_exit_opt_1=='M'?'M':na,exit_filter_sig_buy_1)
exit_filter_sig_buy_11=exit_f_1=='IB/ISexit(notffilter)'?long_pic_x[repaint=='Allowed'?0:1]:false
//longexitsellfilter1options
exit_filter_sell_1=htf_exit_opt_1=='Current'?exit_filter_sig_sell_1[repaint=='Allowed'?0:1]:
f_secureSecurity(syminfo.tickerid,
htf_exit_opt_1=='5m'?'5':htf_exit_opt_1=='10m'?'10':htf_exit_opt_1=='15m'?'15':
htf_exit_opt_1=='30m'?'30':htf_exit_opt_1=='1H'?'60':htf_exit_opt_1=='2H'?'120':htf_exit_opt_1=='3H'?'180':htf_exit_opt_1=='4H'?'240':
htf_exit_opt_1=='6H'?'360':htf_exit_opt_1=='12H'?'720':htf_exit_opt_1=='D'?'D':htf_exit_opt_1=='3D'?'3D':htf_exit_opt_1=='W'?'W':
htf_exit_opt_1=='M'?'M':na,exit_filter_sig_sell_1)
exit_filter_sig_sell_11=exit_f_1=='IB/ISexit(notffilter)'?short_pic_x[repaint=='Allowed'?0:1]:false
//shortexitbuyfilter2options
exit_filter_buy_2=htf_exit_opt_2=='Current'?exit_filter_sig_buy_2[repaint=='Allowed'?0:1]:
f_secureSecurity(syminfo.tickerid,
htf_exit_opt_2=='5m'?'5':htf_exit_opt_2=='10m'?'10':htf_exit_opt_2=='15m'?'15':
htf_exit_opt_2=='30m'?'30':htf_exit_opt_2=='1H'?'60':htf_exit_opt_2=='2H'?'120':htf_exit_opt_2=='3H'?'180':htf_exit_opt_2=='4H'?'240':
htf_exit_opt_2=='6H'?'360':htf_exit_opt_2=='12H'?'720':htf_exit_opt_2=='D'?'D':htf_exit_opt_2=='3D'?'3D':htf_exit_opt_2=='W'?'W':
htf_exit_opt_2=='M'?'M':na,exit_filter_sig_buy_2)
exit_filter_sig_buy_22=exit_f_2=='IB/ISexit(notffilter)'?long_pic_x[repaint=='Allowed'?0:1]:false
//longexitsellfilter2options
exit_filter_sell_2=htf_exit_opt_2=='Current'?exit_filter_sig_sell_2[repaint=='Allowed'?0:1]:
f_secureSecurity(syminfo.tickerid,
htf_exit_opt_2=='5m'?'5':htf_exit_opt_2=='10m'?'10':htf_exit_opt_2=='15m'?'15':
htf_exit_opt_2=='30m'?'30':htf_exit_opt_2=='1H'?'60':htf_exit_opt_2=='2H'?'120':htf_exit_opt_2=='3H'?'180':htf_exit_opt_2=='4H'?'240':
htf_exit_opt_2=='6H'?'360':htf_exit_opt_2=='12H'?'720':htf_exit_opt_2=='D'?'D':htf_exit_opt_2=='3D'?'3D':htf_exit_opt_2=='W'?'W':
htf_exit_opt_2=='M'?'M':na,exit_filter_sig_sell_2)
exit_filter_sig_sell_22=exit_f_2=='IB/ISexit(notffilter)'?short_pic_x[repaint=='Allowed'?0:1]:false
//----------------------------------------------------------------------entrysignals-------------------------------------------------------------------
entry_opt_sig_buy_1=X_opt=='---'?na:
X_opt=='TRIXslopesig'?trix_buy_s:
X_opt=='EMA1xEMA2sig'?ema_1x2_buy_s:
X_opt=='HMAslopesig'?hma_up_e:
X_opt=='DMIADX-slopesig'?adx_up_c:
X_opt=='DMIADXmodsig'?long_1:
X_opt=='DMIADXclassicsig'?long_2:
X_opt=='Pinbarsig'?p_bar_buy:
X_opt=='Insidebarsig'?i_bar_buy:
X_opt=='Outsidebarsig'?o_bar_buy:
X_opt=='Sandwichbarsig'?s_bar_buy:
X_opt=='Barbreakout1sig'?bar_sig_1_buy:
X_opt=='Barbreakout2sig'?bar_sig_2_buy:
X_opt=='Higher-low/lower-highbarsig'?hllh_buy:
X_opt=='Entryoneverybar-opensig'?open_buy:
X_opt=='SMAsig'?sma_buy:
X_opt=='Fractalssig'?fr_upx:
X_opt=='Reversefractalsig'?rev_dn_fr_buy:
X_opt=='MACD(fast)slopesig'?macd_slope_up_e:
X_opt=='RSI50sig'?rsi_f_buy:
X_opt=='ParabolicSARsig'?psar_buy:
X_opt=='ALMAslopesig'?alma_slo_up_e:
X_opt=='SuperTrendsig'?sup_buy:
X_opt=='PriceXKijunsig'?kijun_buy:
X_opt=='PriceXKumosig'?kumo_buy:
X_opt=='Kumoflipsig'?kumo_flip_buy:
X_opt=='ChikouXpricesig'?chikou_X_price_buy:
X_opt=='ChikouXKumosig'?chikou_X_kumo_buy:
X_opt=='PriceXTenkansig'?price_X_tenkan_buy:
X_opt=='TenkanXKumosig'?tenkan_X_kumo_buy:
X_opt=='TenkanXKijunsig'?tenkan_X_kijun_buy:
X_opt=='B1/S1sig'?buy_strong_B1:
X_opt=='B2/S2sig'?buy_strong_B2:na
entry_opt_sig_sell_1=X_opt=='---'?na:
X_opt=='TRIXslopesig'?trix_sell_s:
X_opt=='EMA1xEMA2sig'?ema_1x2_sell_s:
X_opt=='HMAslopesig'?hma_dn_e:
X_opt=='DMIADX-slopesig'?adx_dn_c:
X_opt=='DMIADXmodsig'?short_1:
X_opt=='DMIADXclassicsig'?short_2:
X_opt=='Pinbarsig'?p_bar_sell:
X_opt=='Insidebarsig'?i_bar_sell:
X_opt=='Outsidebarsig'?o_bar_sell:
X_opt=='Sandwichbarsig'?s_bar_sell:
X_opt=='Barbreakout1sig'?bar_sig_1_sell:
X_opt=='Barbreakout2sig'?bar_sig_2_sell:
X_opt=='Higher-low/lower-highbarsig'?hllh_sell:
X_opt=='Entryoneverybar-opensig'?open_sell:
X_opt=='SMAsig'?sma_sell:
X_opt=='Fractalssig'?fr_dnx:
X_opt=='Reversefractalsig'?rev_up_fr_sell:
X_opt=='MACD(fast)slopesig'?macd_slope_dn_e:
X_opt=='RSI50sig'?rsi_f_sell:
X_opt=='ParabolicSARsig'?psar_sell:
X_opt=='ALMAslopesig'?alma_slo_dn_e:
X_opt=='SuperTrendsig'?sup_sell:
X_opt=='PriceXKijunsig'?kijun_sell:
X_opt=='PriceXKumosig'?kumo_sell:
X_opt=='Kumoflipsig'?kumo_flip_sell:
X_opt=='ChikouXpricesig'?chikou_X_price_sell:
X_opt=='ChikouXKumosig'?chikou_X_kumo_sell:
X_opt=='PriceXTenkansig'?price_X_tenkan_sell:
X_opt=='TenkanXKumosig'?tenkan_X_kumo_sell:
X_opt=='TenkanXKijunsig'?tenkan_X_kijun_sell:
X_opt=='B1/S1sig'?sell_strong_S1:
X_opt=='B2/S2sig'?sell_strong_S2:na
entry_opt_sig_buy_2=X_opt_2=='---'?na:
X_opt_2=='TRIXslopesig'?trix_buy_s:
X_opt_2=='EMA1xEMA2sig'?ema_1x2_buy_s:
X_opt_2=='HMAslopesig'?hma_up_e:
X_opt_2=='DMIADX-slopesig'?adx_up_c:
X_opt_2=='DMIADXmodsig'?long_1:
X_opt_2=='DMIADXclassicsig'?long_2:
X_opt_2=='Pinbarsig'?p_bar_buy:
X_opt_2=='Insidebarsig'?i_bar_buy:
X_opt_2=='Outsidebarsig'?o_bar_buy:
X_opt_2=='Sandwichbarsig'?s_bar_buy:
X_opt_2=='Barbreakout1sig'?bar_sig_1_buy:
X_opt_2=='Barbreakout2sig'?bar_sig_2_buy:
X_opt_2=='Higher-low/lower-highbarsig'?hllh_buy:
X_opt_2=='Entryoneverybar-opensig'?open_buy:
X_opt_2=='SMAsig'?sma_buy:
X_opt_2=='Fractalssig'?fr_upx:
X_opt_2=='Reversefractalsig'?rev_dn_fr_buy:
X_opt_2=='MACD(fast)slopesig'?macd_slope_up_e:
X_opt_2=='RSI50sig'?rsi_f_buy:
X_opt_2=='ParabolicSARsig'?psar_buy:
X_opt_2=='ALMAslopesig'?alma_slo_up_e:
X_opt_2=='SuperTrendsig'?sup_buy:
X_opt_2=='PriceXKijunsig'?kijun_buy:
X_opt_2=='PriceXKumosig'?kumo_buy:
X_opt_2=='Kumoflipsig'?kumo_flip_buy:
X_opt_2=='ChikouXpricesig'?chikou_X_price_buy:
X_opt_2=='ChikouXKumosig'?chikou_X_kumo_buy:
X_opt_2=='PriceXTenkansig'?price_X_tenkan_buy:
X_opt_2=='TenkanXKumosig'?tenkan_X_kumo_buy:
X_opt_2=='TenkanXKijunsig'?tenkan_X_kijun_buy:
X_opt_2=='B1/S1sig'?buy_strong_B1:
X_opt_2=='B2/S2sig'?buy_strong_B2:na
entry_opt_sig_sell_2=X_opt_2=='---'?na:
X_opt_2=='TRIXslopesig'?trix_sell_s:
X_opt_2=='EMA1xEMA2sig'?ema_1x2_sell_s:
X_opt_2=='HMAslopesig'?hma_dn_e:
X_opt_2=='DMIADX-slopesig'?adx_dn_c:
X_opt_2=='DMIADXmodsig'?short_1:
X_opt_2=='DMIADXclassicsig'?short_2:
X_opt_2=='Pinbarsig'?p_bar_sell:
X_opt_2=='Insidebarsig'?i_bar_sell:
X_opt_2=='Outsidebarsig'?o_bar_sell:
X_opt_2=='Sandwichbarsig'?s_bar_sell:
X_opt_2=='Barbreakout1sig'?bar_sig_1_sell:
X_opt_2=='Barbreakout2sig'?bar_sig_2_sell:
X_opt_2=='Higher-low/lower-highbarsig'?hllh_sell:
X_opt_2=='Entryoneverybar-opensig'?open_sell:
X_opt_2=='SMAsig'?sma_sell:
X_opt_2=='Fractalssig'?fr_dnx:
X_opt_2=='Reversefractalsig'?rev_up_fr_sell:
X_opt_2=='MACD(fast)slopesig'?macd_slope_dn_e:
X_opt_2=='RSI50sig'?rsi_f_sell:
X_opt_2=='ParabolicSARsig'?psar_sell:
X_opt_2=='ALMAslopesig'?alma_slo_dn_e:
X_opt_2=='SuperTrendsig'?sup_sell:
X_opt_2=='PriceXKijunsig'?kijun_sell:
X_opt_2=='PriceXKumosig'?kumo_sell:
X_opt_2=='Kumoflipsig'?kumo_flip_sell:
X_opt_2=='ChikouXpricesig'?chikou_X_price_sell:
X_opt_2=='ChikouXKumosig'?chikou_X_kumo_sell:
X_opt_2=='PriceXTenkansig'?price_X_tenkan_sell:
X_opt_2=='TenkanXKumosig'?tenkan_X_kumo_sell:
X_opt_2=='TenkanXKijunsig'?tenkan_X_kijun_sell:
X_opt_2=='B1/S1sig'?sell_strong_S1:
X_opt_2=='B2/S2sig'?sell_strong_S2:na
//buysignaloptions1
opt_sig_buy_1=htf_entr_opt_1=='Current'?entry_opt_sig_buy_1[repaint=='Allowed'?0:1]:
f_secureSecurity(syminfo.tickerid,
htf_entr_opt_1=='5m'?'5':htf_entr_opt_1=='10m'?'10':htf_entr_opt_1=='15m'?'15':
htf_entr_opt_1=='30m'?'30':htf_entr_opt_1=='1H'?'60':htf_entr_opt_1=='2H'?'120':htf_entr_opt_1=='3H'?'180':htf_entr_opt_1=='4H'?'240':
htf_entr_opt_1=='6H'?'360':htf_entr_opt_1=='12H'?'720':htf_entr_opt_1=='D'?'D':htf_entr_opt_1=='3D'?'3D':htf_entr_opt_1=='W'?'W':
htf_entr_opt_1=='M'?'M':na,entry_opt_sig_buy_1)
opt_sig_buy_11=X_opt=='Grid-countertrendsig(notffilter)'?grid_ct_buy:
X_opt=='Grid-reentrysig(notffilter)'?grid_re_buy:
X_opt=='Fractalstrendlinessig(notffilter)'?buy_up_line:
X_opt=='Segmentssig(notffilter)'?segments_buy:
X_opt=='CB/CSsig(notffilter)'?long_c[repaint=='Allowed'?0:1]:
X_opt=='IB/ISsig(notffilter)'?long_pic[repaint=='Allowed'?0:1]:na
//sellsignaloptions1
opt_sig_sell_1=htf_entr_opt_1=='Current'?entry_opt_sig_sell_1[repaint=='Allowed'?0:1]:
f_secureSecurity(syminfo.tickerid,
htf_entr_opt_1=='5m'?'5':htf_entr_opt_1=='10m'?'10':htf_entr_opt_1=='15m'?'15':
htf_entr_opt_1=='30m'?'30':htf_entr_opt_1=='1H'?'60':htf_entr_opt_1=='2H'?'120':htf_entr_opt_1=='3H'?'180':htf_entr_opt_1=='4H'?'240':
htf_entr_opt_1=='6H'?'360':htf_entr_opt_1=='12H'?'720':htf_entr_opt_1=='D'?'D':htf_entr_opt_1=='3D'?'3D':htf_entr_opt_1=='W'?'W':
htf_entr_opt_1=='M'?'M':na,entry_opt_sig_sell_1)
opt_sig_sell_11=X_opt=='Grid-countertrendsig(notffilter)'?grid_ct_sell:
X_opt=='Grid-reentrysig(notffilter)'?grid_re_sell:
X_opt=='Fractalstrendlinessig(notffilter)'?sell_dn_line:
X_opt=='Segmentssig(notffilter)'?segments_sell:
X_opt=='CB/CSsig(notffilter)'?short_c[repaint=='Allowed'?0:1]:
X_opt=='IB/ISsig(notffilter)'?short_pic[repaint=='Allowed'?0:1]:na
//buysignaloptions2
opt_sig_buy_2=htf_entr_opt_2=='Current'?entry_opt_sig_buy_2[repaint=='Allowed'?0:1]:
f_secureSecurity(syminfo.tickerid,
htf_entr_opt_2=='5m'?'5':htf_entr_opt_2=='10m'?'10':htf_entr_opt_2=='15m'?'15':
htf_entr_opt_2=='30m'?'30':htf_entr_opt_2=='1H'?'60':htf_entr_opt_2=='2H'?'120':htf_entr_opt_2=='3H'?'180':htf_entr_opt_2=='4H'?'240':
htf_entr_opt_2=='6H'?'360':htf_entr_opt_2=='12H'?'720':htf_entr_opt_2=='D'?'D':htf_entr_opt_2=='3D'?'3D':htf_entr_opt_2=='W'?'W':
htf_entr_opt_2=='M'?'M':na,entry_opt_sig_buy_2)
opt_sig_buy_22=X_opt_2=='Grid-countertrendsig(notffilter)'?grid_ct_buy:
X_opt_2=='Grid-reentrysig(notffilter)'?grid_re_buy:
X_opt_2=='Fractalstrendlinessig(notffilter)'?buy_up_line:
X_opt_2=='Segmentssig(notffilter)'?segments_buy:
X_opt_2=='CB/CSsig(nopyr,notffilter)'?long_c[repaint=='Allowed'?0:1]:
X_opt_2=='IB/ISsig(nopyr,notffilter)'?long_pic[repaint=='Allowed'?0:1]:na
//sellsignaloptions2
opt_sig_sell_2=htf_entr_opt_2=='Current'?entry_opt_sig_sell_2[repaint=='Allowed'?0:1]:
f_secureSecurity(syminfo.tickerid,
htf_entr_opt_2=='5m'?'5':htf_entr_opt_2=='10m'?'10':htf_entr_opt_2=='15m'?'15':
htf_entr_opt_2=='30m'?'30':htf_entr_opt_2=='1H'?'60':htf_entr_opt_2=='2H'?'120':htf_entr_opt_2=='3H'?'180':htf_entr_opt_2=='4H'?'240':
htf_entr_opt_2=='6H'?'360':htf_entr_opt_2=='12H'?'720':htf_entr_opt_2=='D'?'D':htf_entr_opt_2=='3D'?'3D':htf_entr_opt_2=='W'?'W':
htf_entr_opt_2=='M'?'M':na,entry_opt_sig_sell_2)
opt_sig_sell_22=X_opt_2=='Grid-countertrendsig(notffilter)'?grid_ct_sell:
X_opt_2=='Grid-reentrysig(notffilter)'?grid_re_sell:
X_opt_2=='Fractalstrendlinessig(notffilter)'?sell_dn_line:
X_opt_2=='Segmentssig(notffilter)'?segments_sell:
X_opt_2=='CB/CSsig(notffilter)'?short_c[repaint=='Allowed'?0:1]:
X_opt_2=='IB/ISsig(notffilter)'?short_pic[repaint=='Allowed'?0:1]:na
//----------------------------------------------------Takeprofit,stoplossandtrailingprice--------------------------------------------------------
//takeprofitofaveragepositionprice
atr_sec=request.security(syminfo.tickerid,atr_tf,ta.atr(atr_l))
atr_calc=atr_sec*atr_fact
tp_step=0.
tp_step:=nz(high>tp_step[1]+atr_calcorlow<tp_step[1]-atr_calc?close:tp_step[1])
tp_step_l=tp_step>tp_step[1]
tp_step_s=tp_step<tp_step[1]
av_profit_l=close-strategy.position_avg_price>atr_calcandtp_step_l
av_profit_s=strategy.position_avg_price-close>atr_calcandtp_step_s
//stoplossofaveragepositionprice
atr_sec_l=request.security(syminfo.tickerid,atr_tf_l,ta.atr(atr_l_l))
atr_calc_l=atr_sec_l*atr_fact_l
sl_step=0.
sl_step:=nz(high>sl_step[1]+atr_calc_lorlow<sl_step[1]-atr_calc_l?close:sl_step[1])
sl_step_l=sl_step<sl_step[1]
sl_step_s=sl_step>sl_step[1]
sl_t_l=strategy.position_avg_price-close>atr_calc_landsl_step_l
sl_t_s=close-strategy.position_avg_price>atr_calc_landsl_step_s
//averagepositionpriceline
plot(plot_avg_price?strategy.position_avg_price:na,linewidth=1,color=color.new(color.blue,30),title='position_avg_price')
//----------------------------------------------------------------strategyentry/exit-----------------------------------------------------------------
long=entry_type!='Short'//longorboth
short=entry_type!='Long'//shortorboth
both=entry_type=='Both'//both
//exitfilter
exit_long_1=exit_filter_sell_1orexit_filter_sell_2orexit_filter_sig_sell_11orexit_filter_sig_sell_22
exit_short_1=exit_filter_buy_1orexit_filter_buy_2orexit_filter_sig_buy_11orexit_filter_sig_buy_22
//oppositesignalasexitsignal
exit_long_2=opt_sig_sell_1oropt_sig_sell_2oropt_sig_sell_11oropt_sig_sell_22
exit_short_2=opt_sig_buy_1oropt_sig_buy_2oropt_sig_buy_11oropt_sig_buy_22
//longentryconditionsforthe1standthe2ndentrysignal
entry_long_1=(opt_sig_buy_11oropt_sig_buy_1)andentry_filter_buy_1andentry_filter_buy_2andentry_filter_buy_11andentry_filter_buy_22andnotexit_long_1
entry_long_2=(opt_sig_buy_22oropt_sig_buy_2)andentry_filter_buy_1andentry_filter_buy_2andentry_filter_buy_11andentry_filter_buy_22andnotexit_long_1
//shortentryconditionsforthe1standthe2ndentrysignal
entry_short_1=(opt_sig_sell_11oropt_sig_sell_1)andentry_filter_sell_1andentry_filter_sell_2andentry_filter_sell_11andentry_filter_sell_22andnotexit_short_1
entry_short_2=(opt_sig_sell_22oropt_sig_sell_2)andentry_filter_sell_1andentry_filter_sell_2andentry_filter_sell_11andentry_filter_sell_22andnotexit_short_1
ifbacktest_period()
iflong
ifentry_long_1
strategy.entry('os_b',strategy.long)//1stentrysignal
ifone_side_pyrandentry_long_2
strategy.entry('os_b',strategy.long)//2ndentrysignalwheninpyramidingmode


ifnotbothandnotone_side_pyr?exit_long_2:exit_long_1
strategy.close('os_b')//oppositesignalorexit-filtersignalexit

ifnotbothandone_side_pyr?exit_long_1andnotexit_long_1[1]:na
strategy.close('os_b')//exit-filterexit
ifav_tp_enandav_profit_l
strategy.close('os_b',qty_percent=av_tp_qty)//averagetakeprofit

ifsl_enandsl_t_l
strategy.close('os_b',qty_percent=av_sl_qty)//averagestoploss
ifshort
ifentry_short_1
strategy.entry('os_s',strategy.short)
ifone_side_pyrandentry_short_2
strategy.entry('os_s',strategy.short)
ifnotbothandnotone_side_pyr?exit_short_2:exit_short_1
strategy.close('os_s')
ifnotbothandone_side_pyr?exit_short_1andnotexit_short_1[1]:na
strategy.close('os_s')
ifav_tp_enandav_profit_s
strategy.close('os_s',qty_percent=av_tp_qty)
ifsl_enandsl_t_s
strategy.close('os_s',qty_percent=av_sl_qty)
//alertmessages-sameconditionslikestrategy....()-livetrading
iflongandentry_long_1or
longand(one_side_pyr?entry_long_2:na)
alert(message='BybitAPI(BTCUSD){continue(if=positionShort);market(position=0);}BybitAPI(BTCUSD){wait(0.5s);market(side=buy,amount='+str.tostring(lot_size)+');}\n#bot',
freq=alert.freq_once_per_bar)
ifshortandentry_short_1or
shortand(one_side_pyr?entry_short_2:na)
alert(message='BybitAPI(BTCUSD){continue(if=positionLong);market(position=0);}BybitAPI(BTCUSD){wait(0.5s);market(side=sell,amount='+str.tostring(lot_size)+');}\n#bot',
freq=alert.freq_once_per_bar)
iflongand(notbothandnotone_side_pyr?exit_long_2:exit_long_1)or
longand(notbothandone_side_pyr?exit_long_1andnotexit_long_1[1]:na)or

shortand(notbothandnotone_side_pyr?exit_short_2:exit_short_1)or
shortand(notbothandone_side_pyr?exit_short_1andnotexit_short_1[1]:na)

alert(message='BybitAPI(BTCUSD){market(position=0%p);}\n#bot',freq=alert.freq_once_per_bar)
varfloatav_tp_qty_var=100-av_tp_qty//calcbecauseofalertatronsyntaxstring
varfloatav_sl_qty_var=100-av_sl_qty
iflongand(av_tp_en?av_profit_l:na)or
shortand(av_tp_en?av_profit_s:na)

alert(message='BybitAPI(BTCUSD){market(position='+str.tostring(av_tp_qty_var)+'%p);}\n#bot',freq=alert.freq_once_per_bar)
iflongand(sl_en?sl_t_l:na)or
shortand(sl_en?sl_t_s:na)

alert(message='BybitAPI(BTCUSD){market(position='+str.tostring(av_sl_qty_var)+'%p);}\n#bot',freq=alert.freq_once_per_bar)
Expand (1711 lines)
