Script Name: Strategy for UT Bot Alerts indicator
Author: StrategiesForEveryone
Description: Using the UT Bot alerts indicator by @QuantNomad, this strategy was designed for showing an example of how this indicator could be used, also, it has the goal to help some people from a group that use to use this indicator for their trading.  Under any circumstance I recommend to use it without testing it before in real time.

 Backtesting context: 2020-02-05...
PineScript code:

Pine Scriptâ„¢ strategy
Strategy for UT Bot Alerts indicator
//  This  source  code  is  subject  to  the  terms  of  the  Mozilla  Public  License  2.0  at  https://mozilla.org/MPL/2.0/
//@version=5
//Developed  by  StrategiesForEveryone
strategy("UT  Bot  alerts  strategy",  overlay=true,  process_orders_on_close  =  true,  initial_capital  =  1000000,  default_qty_type=strategy.cash,  precision  =  2,  calc_on_every_tick  =  true,  commission_value  =  0.03)
//  ------  Inputs  for  calculating  position  --------
initial_actual_capital  =  input.float(defval=10000,  title  =  "Enter  initial/current  capital",  group  =  "============  Calculate  amount  position  ============")
risk_c  =  input.float(2.5,  '%  account  risk  per  trade',  step=1,  group  ="============Calculateamountposition============",tooltip="Percentageoftotalaccounttoriskpertrade.TheUSDvaluethatshouldbeusedtorisktheinsertedpercentageoftheaccount.Appearsgreenintheupperleftcorner")
//------Datefilter(obtainedfromZenAndTheArtOfTrading)---------
initial_date=input.time(title="Initialdate",defval=timestamp("10Feb201413:30+0000"),group="============Timefilter============",tooltip="Enterthestartdateandtimeofthestrategy")
final_date=input.time(title="Finaldate",defval=timestamp("01Jan203019:30+0000"),group="============Timefilter============",tooltip="Entertheenddateandtimeofthestrategy")
dateFilter(intst,intet)=>time>=standtime<=et
colorDate=input.bool(defval=false,title="Datebackground",tooltip="Addcolortotheperiodoftimeofthestrategytester")
bgcolor(colorDateanddateFilter(initial_date,final_date)?color.new(color.blue,transp=90):na)
//------Sessionlimits(obtainedfromZenAndTheArtOfTrading)-------
timeSession=input.session(title="Timesession",defval="0000-2400",group="============Timefilter============",tooltip="Sessiontimetooperate.Itmaybedifferentdependingonyourtimezone,youhavetofindthecorrecthoursmanually.")
colorBG=input.bool(title="Sessionbackground",defval=false,tooltip="Addcolortosessiontimebackground")
inSession(sess)=>na(time(timeframe.period,sess+':1234567'))==false
bgcolor(inSession(timeSession)andcolorBG?color.rgb(0,38,255,84):na)
//-----------Ema----------------------
ema=input.int(200,title='Emalength',minval=1,maxval=500,group="============Trend============")
ema200=ta.ema(close,ema)
bullish=close>ema200
bearish=close<ema200
show_ema=input.bool(defval=false,title="Showema?",group="============Appearance============")
plot(show_ema?ema200:na,title="Ema",color=color.white,linewidth=2,display=display.all-display.status_line-display.price_scale)
//--------------UTBOTALERTSINDICATORby@QuantNomad-------------------------
//Inputs
a=input(3,title='KeyVaule',group="============UTBOTALERTS============",tooltip="Higheramount,lesstrades.Changingthiscouldbeusefulinsomeassetsortimeframes")
c=input(1,title='ATRPeriod',group="============UTBOTALERTS============",tooltip="Higheramount,lesstrades.Changingthiscouldbeusefulinsomeassetsortimeframes")
h=input(false,title='SignalsfromHeikinAshiCandles',group="============UTBOTALERTS============")
xATR=ta.atr(c)
nLoss=a*xATR
src=h?request.security(ticker.heikinashi(syminfo.tickerid),timeframe.period,close,lookahead=barmerge.lookahead_off):close
xATRTrailingStop=0.0
iff_1=src>nz(xATRTrailingStop[1],0)?src-nLoss:src+nLoss
iff_2=src<nz(xATRTrailingStop[1],0)andsrc[1]<nz(xATRTrailingStop[1],0)?math.min(nz(xATRTrailingStop[1]),src+nLoss):iff_1
xATRTrailingStop:=src>nz(xATRTrailingStop[1],0)andsrc[1]>nz(xATRTrailingStop[1],0)?math.max(nz(xATRTrailingStop[1]),src-nLoss):iff_2
show_atr_ut=input.bool(defval=false,title="Showatrfromutbotalerts?",group="============Appearance============")
plot(show_atr_ut?xATRTrailingStop:na,color=color.orange,linewidth=2,display=display.all-display.price_scale-display.status_line)
pos=0
iff_3=src[1]>nz(xATRTrailingStop[1],0)andsrc<nz(xATRTrailingStop[1],0)?-1:nz(pos[1],0)
pos:=src[1]<nz(xATRTrailingStop[1],0)andsrc>nz(xATRTrailingStop[1],0)?1:iff_3
xcolor=pos==-1?color.red:pos==1?color.green:color.blue
ema_ut=ta.ema(src,1)
show_ema_ut=input.bool(defval=false,title="Showemafromutbotalerts?",group="============Appearance============")
plot(show_ema_ut?ema_ut:na,color=color.white,linewidth=2,display=display.all-display.price_scale-display.status_line)
above=ta.crossover(ema_ut,xATRTrailingStop)
below=ta.crossover(xATRTrailingStop,ema_ut)
buy=src>xATRTrailingStopandabove
sell=src<xATRTrailingStopandbelow
close_buy=src<xATRTrailingStopandbelow
close_sell=src>xATRTrailingStopandabove
barbuy=src>xATRTrailingStop
barsell=src<xATRTrailingStop
show_signals=input.bool(true,title="Showsignals?",group="============Appearance============")
paint_candles=input.bool(false,title="Paintcandles?",group="============Appearance============")
plotshape(bullishandshow_signals?buy:na,title='Buy',text='Buy',style=shape.labelup,location=location.belowbar,color=color.new(color.green,0),textcolor=color.new(color.white,0),size=size.tiny,display=display.all-display.price_scale-display.status_line)
plotshape(bearishandshow_signals?sell:na,title='Sell',text='Sell',style=shape.labeldown,location=location.abovebar,color=color.new(color.red,0),textcolor=color.new(color.white,0),size=size.tiny,display=display.all-display.price_scale-display.status_line)
plotshape(bullishandshow_signals?close_buy:na,title='CloseBuy',text='ClBuy',style=shape.labelup,location=location.belowbar,color=color.new(color.green,80),textcolor=color.new(color.white,0),size=size.tiny,display=display.all-display.price_scale-display.status_line)
plotshape(bearishandshow_signals?close_sell:na,title='CloseSell',text='ClSell',style=shape.labeldown,location=location.abovebar,color=color.new(color.red,80),textcolor=color.new(color.white,0),size=size.tiny,display=display.all-display.price_scale-display.status_line)
barcolor(barbuyandpaint_candles?color.green:na)
barcolor(barsellandpaint_candles?color.red:na)
//--------------Atrstoplossbygarethyeo(modified)-----------------
long_condition_atr=src>xATRTrailingStopandabove
short_condition_atr=src<xATRTrailingStopandbelow
source_atr=input(close,title='Source',group="============Atrstoploss============",inline="A")
length_atr=input.int(14,minval=1,title='Period',group="============Atrstoploss============",inline="A")
multiplier=input.float(1.5,minval=0.1,step=0.1,title='Atrmultiplier',group="============Atrstoploss============",inline="A",tooltip="DefinesthestoplossdistancebasedontheAtrstoplossindicator")
show_stoploss=input.bool(defval=true,title="Showstoploss?",group="============Appearance============")
varfloatshortStopLoss=na
varfloatlongStopLoss=na
varfloatatr_past_candle_long=na
varfloatatr_past_candle_short=na
//shortStopLoss=source_atr+ta.atr(length_atr)*multiplier
//longStopLoss=source_atr-ta.atr(length_atr)*multiplier
//atr_past_candle_short=close[1]+ta.atr(length_atr)[1]*multiplier[1]
//atr_past_candle_long=close[1]-ta.atr(length_atr)[1]*multiplier[1]
candle_of_stoploss=input.string(defval="Currentcandle",title="Stoplosssourceforatrstoploss",group="============Riskmanagementfortrades============",options=["Currentcandle","Pastcandle"])
ifcandle_of_stoploss=="Currentcandle"
shortStopLoss:=source_atr+ta.atr(length_atr)*multiplier
longStopLoss:=source_atr-ta.atr(length_atr)*multiplier
ifcandle_of_stoploss=="Pastcandle"
shortStopLoss:=close[1]+ta.atr(length_atr)[1]*multiplier[1]
longStopLoss:=close[1]-ta.atr(length_atr)[1]*multiplier[1]
//---------Stoplossbasedinlastswinghigh/low--------
high_bars=input.int(defval=10,title="Highestpricebars:",group="============Swinghighs/lowsstoplosses============")
low_bars=input.int(defval=10,title="Lowestpricebars:",group="============Swinghighs/lowsstoplosses============")
stop_high=ta.highest(high,high_bars)
stop_low=ta.lowest(low,low_bars)
//---------Stoplosssourceselection---------------
stoploss_type=input.string(defval="Atrstoploss",title="Generalstoplosssource",group="============Riskmanagementfortrades============",options=["Atrstoploss","Swinghigh/low"])
ifstoploss_type=="Atrstoploss"
shortStopLoss:=source_atr+ta.atr(length_atr)*multiplier
longStopLoss:=source_atr-ta.atr(length_atr)*multiplier
ifcandle_of_stoploss=="Pastcandle"andstoploss_type=="Atrstoploss"
shortStopLoss:=close[1]+ta.atr(length_atr)[1]*multiplier[1]
longStopLoss:=close[1]-ta.atr(length_atr)[1]*multiplier[1]
ifstoploss_type=="Swinghigh/low"
shortStopLoss:=stop_high
longStopLoss:=stop_low
//Plotingstoplosses
plot(show_stoplossandlong_condition_atrandbullish?longStopLoss:na,color=color.white,style=plot.style_circles,linewidth=2)
plot(show_stoplossandshort_condition_atrandbearish?shortStopLoss:na,color=color.white,style=plot.style_circles,linewidth=2)
//-------------Moneymanagement--------------
strategy_contracts=strategy.equity/close
distance_sl_atr_long=-1*(longStopLoss-close)/close
distance_sl_atr_short=(shortStopLoss-close)/close
risk=input.float(2.5,'%Accountriskpertradeforbacktesting',step=1,group="============Riskmanagementfortrades============",tooltip="Percentageoftotalaccounttoriskpertrade")
long_amount=strategy_contracts*(risk/100)/distance_sl_atr_long
short_amount=strategy_contracts*(risk/100)/distance_sl_atr_short
//----Fixedamounts----
//fixed_amounts=input.bool(defval=false,title="Fixedamounts?",group="============Riskmanagementfortrades============")
//fixed_amount_input=input.float(defval=1000,title="Fixedamountinusd",group="============Riskmanagementfortrades============")
//iffixed_amounts
//long_amount:=fixed_amount_input/close
//iffixed_amounts
//short_amount:=fixed_amount_input/close
//
leverage=input.bool(defval=true,title="Useleverageforbacktesting?",group="============Riskmanagementfortrades============",tooltip="Ifitisactivated,therewillbenomonetaryunitsoramountofassetslimitforeachoperation(Thatis,eachoperationwillnotbeaffectedbytheinitial/currentcapitalsinceitwouldbeusingleverage).Ifitisdeactivated,themonetaryunitsortheamountofassetstouseforeachoperationwillbelimitedbytheinitial/currentcapital.")
ifnotleverageandlong_amount>strategy_contracts
long_amount:=strategy.equity/close
ifnotleverageandshort_amount>strategy_contracts
short_amount:=strategy.equity/close
//----------Riskmanagement---------------
risk_reward_breakeven_long=input.float(title="Risk/rewardforbreakevenlong",defval=0.75,step=0.1,group="============Riskmanagementfortrades============")
risk_reward_take_profit_long=input.float(title="Risk/rewardfortakeprofitlong",defval=3.0,step=0.1,group="============Riskmanagementfortrades============")
risk_reward_breakeven_short=input.float(title="Risk/rewardforbreakevenshort",defval=0.75,step=0.1,group="============Riskmanagementfortrades============")
risk_reward_take_profit_short=input.float(title="Risk/rewardfortakeprofitshort",defval=3.0,step=0.1,group="============Riskmanagementfortrades============")
tp_percent=input.float(title="%oftradeforfirsttakeprofit",defval=50,step=5,group="============Riskmanagementfortrades============",tooltip="Closingpercentageofthecurrentpositionwhenthefirsttakeprofitisreached.")
//------------Tradeconditions---------------
bullish:=close>ema200
bearish:=close<ema200
bought=strategy.position_size>0
sold=strategy.position_size<0
buy:=src>xATRTrailingStopandabove
sell:=src<xATRTrailingStopandbelow
varfloatsl_long=na
varfloatsl_short=na
varfloatbe_long=na
varfloatbe_short=na
varfloattp_long=na
varfloattp_short=na
ifnotbought
be_long:=na
sl_long:=na
tp_long:=na
ifnotsold
be_short:=na
sl_short:=na
tp_short:=na
long_positions=input.bool(defval=true,title="Longpositions?",group="============Positionsmanagement============")
short_positions=input.bool(defval=true,title="Shortpositions?",group="============Positionsmanagement============")
use_takeprofit=input.bool(defval=true,title="Usetakeprofit?",group="============Riskmanagementfortrades============")
//=======================Strategy===================================================================================================================
//Longpositionwithtakeprofit
ifnotboughtandbuyanddateFilter(initial_date,final_date)andlong_positionsandbullishandinSession(timeSession)anduse_takeprofit
sl_long:=longStopLoss
long_stoploss_distance=close-longStopLoss
be_long:=close+long_stoploss_distance*risk_reward_breakeven_long
tp_long:=close+(long_stoploss_distance*risk_reward_take_profit_long)
strategy.entry('L',strategy.long,long_amount,alert_message="Long")
strategy.exit("Tp","L",stop=sl_long,limit=tp_long,qty_percent=tp_percent)
strategy.exit('Exit','L',stop=sl_long)
ifboughtandhigh>be_long
sl_long:=strategy.position_avg_price
strategy.exit("Tp","L",stop=sl_long,limit=tp_long,qty_percent=tp_percent)
strategy.exit('Exit','L',stop=sl_long)
ifboughtandsellandstrategy.openprofit>0
strategy.close("L",comment="CL")
//Longpositionwithouttakeprofit
ifnotboughtandbuyanddateFilter(initial_date,final_date)andlong_positionsandbullishandinSession(timeSession)
sl_long:=longStopLoss
long_stoploss_distance=close-longStopLoss
be_long:=close+long_stoploss_distance*risk_reward_breakeven_long
strategy.entry('L',strategy.long,long_amount,alert_message="Long")
strategy.exit("Tp","L",stop=sl_long,qty_percent=tp_percent)
strategy.exit('Exit','L',stop=sl_long)
ifboughtandhigh>be_long
sl_long:=strategy.position_avg_price
strategy.exit("Tp","L",stop=sl_long,qty_percent=tp_percent)
strategy.exit('Exit','L',stop=sl_long)
ifboughtandsellandstrategy.openprofit>0
strategy.close("L",comment="CL")
//Shortpositionwithtakeprofit
ifnotsoldandsellanddateFilter(initial_date,final_date)andshort_positionsandbearishandinSession(timeSession)anduse_takeprofit
sl_short:=shortStopLoss
short_stoploss_distance=shortStopLoss-close
be_short:=((short_stoploss_distance*risk_reward_breakeven_short)-close)*-1
tp_short:=((short_stoploss_distance*risk_reward_take_profit_short)-close)*-1
strategy.entry("S",strategy.short,short_amount,alert_message="Short")
strategy.exit("Tp","S",stop=sl_short,limit=tp_short,qty_percent=tp_percent)
strategy.exit("Exit","S",stop=sl_short)
ifsoldandlow<be_short
sl_short:=strategy.position_avg_price
strategy.exit("Tp","S",stop=sl_short,limit=tp_short,qty_percent=tp_percent)
strategy.exit("Exit","S",stop=sl_short)
ifsoldandbuyandstrategy.openprofit>0
strategy.close("S",comment="CS")
//Shortpositionwithouttakeprofit
ifnotsoldandsellanddateFilter(initial_date,final_date)andshort_positionsandbearishandinSession(timeSession)
sl_short:=shortStopLoss
short_stoploss_distance=shortStopLoss-close
be_short:=((short_stoploss_distance*risk_reward_breakeven_short)-close)*-1
strategy.entry("S",strategy.short,short_amount,alert_message="Short")
strategy.exit("Tp","S",stop=sl_short,qty_percent=tp_percent)
strategy.exit("Exit","S",stop=sl_short)
ifsoldandlow<be_short
sl_short:=strategy.position_avg_price
strategy.exit("Tp","S",stop=sl_short,qty_percent=tp_percent)
strategy.exit("Exit","S",stop=sl_short)
ifsoldandbuyandstrategy.openprofit>0
strategy.close("S",comment="CS")
//===============================================================================================================================================
//----------Drawpositionsandsignalsonchart(strategyasanindicator)-------------
ifhigh>tp_long
tp_long:=na
iflow<tp_short
tp_short:=na
ifhigh>be_long
be_long:=na
iflow<be_short
be_short:=na
show_position_on_chart=input.bool(defval=true,title="Drawpositiononchart?",group="============Appearance============",tooltip="Activatetographicallydisplayprofit,stoplossandbreakeven")
position_price=plot(show_position_on_chart?strategy.position_avg_price:na,style=plot.style_linebr,color=color.new(#ffffff,10),linewidth=1,display=display.all-display.status_line-display.price_scale)
sl_long_price=plot(show_position_on_chartandbought?sl_long:na,style=plot.style_linebr,color=color.new(color.red,10),linewidth=1,display=display.all-display.status_line-display.price_scale)
sl_short_price=plot(show_position_on_chartandsold?sl_short:na,style=plot.style_linebr,color=color.new(color.red,10),linewidth=1,display=display.all-display.status_line-display.price_scale)
tp_long_price=plot(strategy.position_size>0andshow_position_on_chartanduse_takeprofit?tp_long:na,style=plot.style_linebr,color=color.new(#4cd350,10),linewidth=1,display=display.all-display.status_line-display.price_scale)
tp_short_price=plot(strategy.position_size<0andshow_position_on_chartanduse_takeprofit?tp_short:na,style=plot.style_linebr,color=color.new(#4cd350,10),linewidth=1,display=display.all-display.status_line-display.price_scale)
breakeven_long=plot(strategy.position_size>0andhigh<be_longandshow_position_on_chart?be_long:na,style=plot.style_linebr,color=color.new(#1fc9fd,60),linewidth=1,display=display.all-display.status_line-display.price_scale)
breakeven_short=plot(strategy.position_size<0andlow>be_shortandshow_position_on_chart?be_short:na,style=plot.style_linebr,color=color.new(#1fc9fd,60),linewidth=1,display=display.all-display.status_line-display.price_scale)
show_break_even_on_chart=input.bool(defval=true,title="Drawfirsttakeprofit/breakevenpriceonchart?",group="============Appearance============",tooltip="Activatetodisplaytakeprofitandbreakevenprice.Itappearsasagreenpointinthechart")
long_stoploss_distance=close-longStopLoss
short_stoploss_distance=shortStopLoss-close
be_long_plot=close+long_stoploss_distance*risk_reward_breakeven_long
be_short_plot=((short_stoploss_distance*risk_reward_breakeven_short)-close)*-1
plot(show_break_even_on_chartandbuyandbullish?be_long_plot:na,color=color.new(#1fc9fd,10),style=plot.style_circles,linewidth=2,display=display.all-display.price_scale)
plot(show_break_even_on_chartandsellandbearish?be_short_plot:na,color=color.new(#1fc9fd,10),style=plot.style_circles,linewidth=2,display=display.all-display.price_scale)
position_profit_long=plot(boughtandshow_position_on_chartandstrategy.openprofit>0?close:na,style=plot.style_linebr,color=color.new(#4cd350,10),linewidth=1,display=display.all-display.status_line-display.price_scale)
position_profit_short=plot(soldandshow_position_on_chartandstrategy.openprofit>0?close:na,style=plot.style_linebr,color=color.new(#4cd350,10),linewidth=1,display=display.all-display.status_line-display.price_scale)
fill(plot1=position_price,plot2=position_profit_long,color=color.new(#4cd350,90))
fill(plot1=position_price,plot2=position_profit_short,color=color.new(#4cd350,90))
fill(plot1=position_price,plot2=sl_long_price,color=color.new(color.red,90))
fill(plot1=position_price,plot2=sl_short_price,color=color.new(color.red,90))
fill(plot1=position_price,plot2=tp_long_price,color=color.new(color.green,90))
fill(plot1=position_price,plot2=tp_short_price,color=color.new(color.green,90))
//---------------Positionsamountcalculator-------------
contracts_amount_c=initial_actual_capital/close
distance_sl_long_c=-1*(longStopLoss-close)/close
distance_sl_short_c=(shortStopLoss-close)/close
long_amount_c=close*(contracts_amount_c*(risk_c/100)/distance_sl_long_c)
short_amount_c=close*(contracts_amount_c*(risk_c/100)/distance_sl_short_c)
long_amount_lev=close*(contracts_amount_c*(risk_c/100)/distance_sl_long_c)
short_amount_lev=close*(contracts_amount_c*(risk_c/100)/distance_sl_short_c)
leverage_for_calculator=input.bool(defval=true,title="Useleverage?",group="============Calculateamountposition============",tooltip="Ifitisactivated,therewillbenomonetaryunitsoramountofassetslimitforeachoperation(Thatis,eachoperationwillnotbeaffectedbytheinitial/currentcapitalsinceitwouldbeusingleverage).Ifitisdeactivated,themonetaryunitsortheamountofassetstouseforeachoperationwillbelimitedbytheinitial/currentcapital.")
ifnotleverage_for_calculatorandlong_amount_lev>initial_actual_capital
long_amount_lev:=initial_actual_capital
ifnotleverage_for_calculatorandshort_amount_lev>initial_actual_capital
short_amount_lev:=initial_actual_capital
plot(buyandleverage_for_calculator?long_amount_c:na,color=color.rgb(136,255,0),display=display.all-display.pane-display.price_scale)
plot(sellandleverage_for_calculator?short_amount_c:na,color=color.rgb(136,255,0),display=display.all-display.pane-display.price_scale)
plot(buyandnotleverage_for_calculator?long_amount_lev:na,color=color.rgb(136,255,0),display=display.all-display.pane-display.price_scale)
plot(sellandnotleverage_for_calculator?short_amount_lev:na,color=color.rgb(136,255,0),display=display.all-display.pane-display.price_scale)
Expand (329 lines)
